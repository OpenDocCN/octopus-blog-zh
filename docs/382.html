<html>
<head>
<title>Role Based Access Control demo - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>基于角色的访问控制演示- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/k8s-training/14-rbac-demo#2022-09-06">https://octopus.com/blog/k8s-training/14-rbac-demo#2022-09-06</a></blockquote>
                        <p>这篇文章是我们Kubernetes培训系列的第14篇，为DevOps工程师提供了关于Docker、Kubernetes和Octopus的介绍。</p>

<p>此视频演示了如何创建一个Octopus目标，该目标使用服务帐户令牌向集群进行身份验证。</p>

<p>如果您还没有八达通帐户，您可以开始免费试用。</p>

<p/>

<p>您可以使用下面的链接完成该系列。</p>



<h2 id="example-code">示例代码</h2>

<h3 id="rbac-resources">RBAC资源公司</h3>

<p>这是复合YAML文档，包含用于将服务帐户限制到单个名称空间的RBAC资源:</p>

<pre><code class="language-yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: octopub-deployer
---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: octopub-deployer-role
rules:
- apiGroups: ["", "extensions", "apps", "networking.k8s.io"]
  resources: ["deployments", "replicasets", "pods", "services", "ingresses", "secrets", "configmaps"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
- apiGroups: [""]
  resources: ["namespaces"]
  verbs: ["get"]
---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: octopub-deployer-rolebinding
subjects:
- kind: ServiceAccount
  name: octopub-deployer
  apiGroup: ""
roleRef:
  kind: Role
  name: octopub-deployer-role
  apiGroup: ""
---
apiVersion: v1
kind: Secret
type: kubernetes.io/service-account-token
metadata:
  name: octopub-deployer-secret
  annotations:
    kubernetes.io/service-account.name: "octopub-deployer"
</code></pre>

<h3 id="target-creation-script">目标创建脚本</h3>

<p>该脚本通过从当前Kubernetes上下文中提取密码和Kubernetes URL来创建新的Octopus令牌帐户和目标:</p>

<pre><code class="language-bash">SERVER=$(kubectl config view -o json | jq -r '.clusters[0].cluster.server')
TOKEN=$(kubectl get secret octopub-deployer-secret -n octopub -o json | jq -r '.data.token' | base64 -d)

echo "##octopus[create-tokenaccount \
  name=\"$(encode_servicemessagevalue "Octopub #{Octopus.Environment.Name}")\" \
  token=\"$(encode_servicemessagevalue "${TOKEN}")\" \
  updateIfExisting=\"$(encode_servicemessagevalue 'True')\"]"

echo "##octopus[create-kubernetestarget \
  name=\"$(encode_servicemessagevalue "Octopub #{Octopus.Environment.Name}")\" \
  octopusRoles=\"$(encode_servicemessagevalue 'Octopub')\" \
  clusterUrl=\"$(encode_servicemessagevalue "${SERVER}")\" \
  octopusAccountIdOrName=\"$(encode_servicemessagevalue "Octopub #{Octopus.Environment.Name}")\" \
  namespace=\"$(encode_servicemessagevalue "octopub")\" \
  octopusDefaultWorkerPoolIdOrName=\"$(encode_servicemessagevalue "Laptop")\" \
  updateIfExisting=\"$(encode_servicemessagevalue 'True')\" \
  skipTlsVerification=\"$(encode_servicemessagevalue 'True')\"]"
</code></pre>

<h2 id="resources">资源</h2>



<h2 id="learn-more">了解更多信息</h2>

<p>如果您想在AWS平台(如EKS和ECS)上构建和部署容器化的应用程序，请尝试使用<a href="https://octopusworkflowbuilder.octopus.com/#/" rel="nofollow"> Octopus Workflow Builder </a>。构建器使用GitHub Actions工作流构建的示例应用程序填充GitHub存储库，并使用示例部署项目配置托管的Octopus实例，这些项目展示了最佳实践，如漏洞扫描和基础架构代码(IaC)。</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>