<html>
<head>
<title>How to deploy to MuleSoft Runtime using Octopus Deploy - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用Octopus Deploy部署到MuleSoft运行时</h1>
<blockquote>原文：<a href="https://octopus.com/blog/deploying-to-mulesoft-runtime#2022-10-17">https://octopus.com/blog/deploying-to-mulesoft-runtime#2022-10-17</a></blockquote>
                        <p>MuleSoft开发了独特的软件，允许您创建自定义API来从内部或基于云的系统中检索或操作信息。</p>

<p>在这篇文章中，我将向您展示如何使用Octopus Deploy将MuleSoft API部署到运行<a href="https://docs.mulesoft.com/mule-runtime/4.4/" rel="nofollow"> Mule Runtime </a>的服务器上。</p>

<h2 id="getting-started">入门指南</h2>

<p>要阅读这篇文章，你需要下载以下软件:</p>



<h3 id="installing-anypoint-studio">安装Anypoint Studio</h3>

<p>Anypoint Studio可从MuleSoft获得，试用期为30天。填写完表格后，下载ZIP文件并解压到您的磁盘。AnyPoint Studio并没有“安装”在您的机器上，所以您可以在提取之后执行AnyPoint Studio。</p>

<h3 id="configuring-mulesoft-runtime">配置MuleSoft运行时</h3>

<p>要配置Mule Community Edition运行时，首先要安装和配置Java。MuleSoft文档推荐<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" rel="nofollow"> Java 8 </a>，然而我成功使用了<a href="https://docs.microsoft.com/en-us/java/openjdk/download#openjdk-11" rel="nofollow">微软OpenJDK 11 </a>。</p>

<p>安装Java和Mule运行时之后，创建以下系统环境变量:</p>

<ul>
<li><code>JAVA_HOME</code>:设置为你的Java文件夹的位置</li>
<li><code>MULE_HOME</code>:将此设置为您的Mule运行时文件夹的位置</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/environment-variables.png" class="zoom" data-title=""><img src="../Images/25c78ce8b65968a531d27a0f48402ec9.png" class="img-fluid center" alt="Environment variables for mule" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/environment-variables.png"/>T2】</a></p>

<p>默认情况下，Mule Community运行时在前台运行。要将其配置为作为服务运行，请遵循MuleSoft文档:</p>



<h3 id="installing-maven">安装Maven</h3>

<p>安装Maven是可选的，因为Anypoint Studio软件将Maven内置于产品中。如果您希望构建服务器构建Anypoint Studio项目，那么您的构建服务器需要Maven功能。如果Maven安装在构建代理上，大多数(如果不是全部的话)现代构建服务器都包含这样的步骤或任务。</p>

<p>安装Maven非常简单，只需提取ZIP文件，然后将文件夹添加到<code>PATH</code>系统环境变量中。</p>

<h3 id="testing-with-postman">邮递员测试</h3>

<p>创建API后，您需要测试它以确保它正常运行。任何能够处理POST请求的工具都可以工作，然而，最流行的API测试工具是<a href="https://www.postman.com/downloads/" rel="nofollow"> Postman </a>。</p>

<p><a href="https://identity.getpostman.com/signup" rel="nofollow"> Postman是免费的</a>，可用于Windows、Mac和Linux操作系统。</p>

<h2 id="creating-the-api">创建API</h2>

<p>在这篇文章中，我创建了一个简单的“Hello World”API。顾名思义，调用这个API得到的响应是<code>Hello world!</code>。</p>

<p>真实世界的API更加复杂，但是在本文中，我将向您展示如何使用Octopus Deploy部署API。</p>

<h3 id="creating-the-project">创建项目</h3>

<ol>
<li>在Anypoint Studio中，点击<strong>文件</strong>，然后<strong>新建</strong>，然后<strong>骡子项目</strong>。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-new-project.png" class="zoom" data-title=""><img src="../Images/ba8330693790e5d6311a925908367890.png" class="img-fluid center" alt="Create new Anypoint project" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-new-project.png"/>T2】</a></p>

<ol start="2">
<li>给项目命名，点击<strong>完成</strong>。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-project-name.png" class="zoom" data-title=""><img src="../Images/291639b323acf10123c8339a5f181ddb.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-project-name.png"/>T2】</a></p>

<ol start="3">
<li>从<strong> Mule Palette </strong>中，选择<strong> HTTP </strong>类别，并将<strong>监听器</strong>拖到画布上。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-add-listener.png" class="zoom" data-title=""><img src="../Images/426a21a6a6c3a205578001d422570a63.png" class="img-fluid center" alt="Add an HTTP listener object" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-add-listener.png"/>T2】</a></p>

<ol start="4">
<li>点击绿色加号按钮配置监听器<strong>连接器配置</strong>。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-new-connector-configuration.png" class="zoom" data-title=""><img src="../Images/71115692f1dbac1cee25ae50017c061c.png" class="img-fluid center" alt="Create new connector configuration" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-new-connector-configuration.png"/>T2】</a></p>

<ol start="5">
<li>配置连接器配置的设置。在这篇文章中，我保留了默认值。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-connector-configuration.png" class="zoom" data-title=""> T32 </a></p>

<p>点击<strong>测试连接...</strong>按钮，以确保此操作有效。</p>

<ol start="6">
<li>为API定义一个路径。对于这个帖子，我选择了<code>/hello-world</code>。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-general-path.png" class="zoom" data-title=""><img src="../Images/688e3d91920031f26d9de77efb714bbc.png" class="img-fluid center" alt="Add a path" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-general-path.png"/>T2】</a></p>

<ol start="7">
<li>从<strong> Mule Palette </strong>的<strong> Core </strong>类别中添加一个<strong> Set Payload </strong>对象，并将其拖动到消息流的<strong> Process </strong>部分。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-add-payload.png" class="zoom" data-title=""><img src="../Images/72b3240682b2b2909d46c6cb742eacc2.png" class="img-fluid center" alt="Add a payload object to listener" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-add-payload.png"/>T2】</a></p>

<ol start="8">
<li>点击<strong> fx </strong>按钮使其失效，并为<strong>值</strong>设置静态信息。对于这个帖子，我使用了<code>Hello World!</code>。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-hello-world-payload.png" class="zoom" data-title=""><img src="../Images/165cae1fcefca8909bf241628b8562da.png" class="img-fluid center" alt="Define payload return message" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-hello-world-payload.png"/>T2】</a></p>

<ol start="9">
<li>单击绿色的play按钮测试您的API。当<strong>控制台</strong>窗口显示<strong>部署</strong>的状态时，您的API就准备好了。切换到Postman(或您选择的工具)来测试您的API。向<code>http://localhost:8081/hello-world</code>发送帖子请求。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/postman-test-api.png" class="zoom" data-title=""><img src="../Images/c37c2b7f96da089268324b6435b48d44.png" class="img-fluid center" alt="Test local API with postman" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/postman-test-api.png"/>T2】</a></p>

<h2 id="creating-a-deployable-file">创建可部署文件</h2>

<p>Anypoint Studio软件包含内置于产品中的Maven版本。这意味着您可以在Anypoint Studio本身中创建一个可部署的工件。或者，您可以从构建服务器(或命令行)使用Maven来生成可部署文件。</p>

<h3 id="anypoint-studio">任意点工作室</h3>

<p>您可以通过执行以下操作从Anypoint Studio中<strong>导出</strong>您的项目:</p>

<ol>
<li>点击<strong>文件</strong>，然后<strong>导出</strong>。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-export-project.png" class="zoom" data-title=""><img src="../Images/7d548f7f0ff73f413a8d2f220a5a0375.png" class="img-fluid center" alt="Export Anypoint project" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-export-project.png"/>T2】</a></p>

<ol start="2">
<li>选择一个导出向导。对于这篇文章，我选择了<strong> Anypoint Studio项目来Mule Deployable Archive(包括Studio元数据)</strong>。点击下一个的<strong>。</strong></li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-export-wizard.png" class="zoom" data-title=""><img src="../Images/ef0e18cc482ae56b69263e09febc2ba7.png" class="img-fluid center" alt="Choose an export wizard" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-export-wizard.png"/>T2】</a></p>

<ol start="3">
<li><p>选择要导出的项目。这个项目是我唯一创建的项目。点击下一个的<strong>。</strong></p>
</li>
<li><p>选择保存文件的位置，点击<strong>完成</strong>。</p>
</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-export-wizard-finish.png" class="zoom" data-title=""><img src="../Images/e35f177985754a83418067b34bd45f22.png" class="img-fluid center" alt="Finish the wizard" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-export-wizard-finish.png"/>T2】</a></p>

<p>保存操作完成后，它会显示文件的保存位置和名称。在我的例子中，它被保存到<code>C:\Users\Shawn.Sesna\hello-world.jar</code>。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-export-saved.png" class="zoom" data-title=""><img src="../Images/4b649a43f78b283fbe6b8e98c187482e.png" class="img-fluid center" alt="Display saved file location" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/anypoint-export-saved.png"/>T2】</a></p>

<h3 id="maven">专家</h3>

<p>您还可以从构建服务器或命令行使用Maven来构建项目。</p>

<p>在本文中，我将向您展示命令行方法，但是构建服务器的方法几乎是相同的。</p>

<ol>
<li><p>导航到项目文件夹。这个文件夹已经包含了一个您在Maven中使用的<code>pom.xml</code>文件。</p>
</li>
<li><p>使用以下命令/目标运行Maven:</p>
</li>
</ol>

<pre><code>mvn clean package
</code></pre>

<ol start="3">
<li>构建完成后，导航到<strong>目标</strong>子文件夹。构建产生了一个名为<code>hello-world-1.0.0-SNAPSHOT-mule-application.jar</code>的文件。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/maven-build-success.png" class="zoom" data-title=""><img src="../Images/3cb3d05a11a9bf85bb991a9308387281.png" class="img-fluid center" alt="Successful maven build with generated .jar file" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/maven-build-success.png"/>T2】</a></p>

<h2 id="deploying-the-api">部署API</h2>

<p>如您所见，Anypoint Studio项目被编译成JAR文件。Octopus Deploy没有部署到Mule Community Edition运行时的具体步骤，但是，它包含一个<strong>部署Java归档</strong>步骤。</p>

<p>将JAR文件放入内置存储库或外部存储库之后，就可以继续配置部署了。</p>

<h3 id="configuring-the-deploy-java-archive-step">配置部署Java归档文件步骤</h3>

<p>这篇文章假设你知道如何在Octopus Deploy中创建项目。</p>

<p>要配置Octopus部署项目，请使用以下步骤:</p>

<ol>
<li><p>向您的流程添加一个<strong>部署Java归档</strong>步骤。</p>
</li>
<li><p>选择要部署到的角色。这篇文章使用了角色<strong> Hello-World-API </strong>。</p>
</li>
<li><p>选择要部署的包。这篇文章使用了由导出方法<code>hello-world-1.0.0-SNAPSHOT-mule-application.jar</code>创建的包。我重命名了文件<code>hello-world.1.0.0.jar</code>,这样Octopus就可以确定包的SemVer版本。</p>
</li>
<li><p>Mule Community Edition运行时希望将API部署到特定的文件夹中。在<strong>部署Java归档</strong>步骤的<strong>部署</strong>部分，勾选<strong>使用定制部署目录</strong>。输入Mule Community Edition运行时应用程序文件夹的位置。</p>
</li>
<li><p>为部署的JAR文件选择最终文件名。如果你不填写这个，Octopus会创建一个类似下面格式的文件<code>hello-world@S1.0.0@673BE843C229AA40AC1698CC82104BD0</code>。在此部署和运行的同时，下一个版本(如1.0.1)被部署为<code>hello-world@S1.0.1@673BE843C229AA40AC1698CC82104BD0</code>。Mule会认为这是一个新的API，并试图部署它，这与第一个相冲突。如果<code>1.0.1</code>和<code>1.0.0</code>有相同的文件名，Mule会发现一个变化，并使用新的API。</p>
</li>
</ol>

<p>不要勾选<strong>净化</strong>选项。如果部署了其他API，这会将它们全部删除。</p>


<p>完成后，它应该看起来像这样:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-deploy-java-archive.png" class="zoom" data-title=""><img src="../Images/39c341fad7d85cb1b3bb940ffce58b41.png" class="img-fluid center" alt="Configured Deploy Java Archive step" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-deploy-java-archive.png"/>T2】</a></p>

<ol start="6">
<li>创建一个版本并部署。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-deployment-complete.png" class="zoom" data-title=""><img src="../Images/c918181720c45655a7cb552ab14fb6f6.png" class="img-fluid center" alt="Deployment successfully completed" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-deployment-complete.png"/>T2】</a></p>

<ol start="7">
<li>使用Postman测试API。</li>
</ol>

<p>【T2 <img src="../Images/8710f606fc3e5f685091c59fd67f4a98.png" class="img-fluid center" alt="Use postman to test the deployed API" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/postman-octopus-test.png"/></p>

<h2 id="manipulating-the-api-with-structured-configuration-variables">使用结构化配置变量操作API</h2>

<p>您成功地部署了一个简单的API，但是，这并不太现实。随着API在您的环境中的发展，它更有可能需要更新。</p>

<p>使用<a href="https://octopus.com/docs/projects/steps/configuration-features/structured-configuration-variables-feature">结构化配置变量</a>，您可以将显示的消息从<code>Hello World!</code>更改为其他内容。</p>

<h3 id="updating-the-api-message">更新API消息</h3>

<p>API消息存储在JAR包中的XML文件中。通过确定消息的XPath，可以为部署的API更新消息。</p>

<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;mule xmlns:http="http://www.mulesoft.org/schema/mule/http" 
    xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd"&gt;
    &lt;http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="1bcf8768-d2f4-449e-ace0-4a86472cc4e1" &gt;
        &lt;http:listener-connection host="0.0.0.0" port="8081" /&gt;
    &lt;/http:listener-config&gt;
    &lt;flow name="hello-worldFlow" doc:id="5b6f81da-ecf0-4a71-8299-c9918ed2ca69" &gt;
        &lt;http:listener doc:name="Listener" doc:id="433558cb-1dcc-4385-8126-5b2801575a29" config-ref="HTTP_Listener_config" path="/hello-world"/&gt;
        &lt;set-payload value="Hello World!" doc:name="Set Payload" doc:id="638c8080-540b-4fce-8539-a5e74350ab80" /&gt;
    &lt;/flow&gt;
&lt;/mule&gt;
</code></pre>

<ol>
<li><p>编辑<strong>部署Java归档</strong>步骤。</p>
</li>
<li><p>点击<strong>配置功能</strong>按钮。</p>
</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-configure-features.png" class="zoom" data-title=""><img src="../Images/cbd2e038114579dbc6d97feb231d49b7.png" class="img-fluid center" alt="Click Configure Features button" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-configure-features.png"/>T2】</a></p>

<ol start="3">
<li>启用<strong>结构化配置变量</strong>功能。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-structured-configuration-variables.png" class="zoom" data-title=""><img src="../Images/f797deb449e0b3eb6b9b9039eb892d2d.png" class="img-fluid center" alt="Enable Strucutred Configuration Variables feature" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-structured-configuration-variables.png"/>T2】</a></p>

<ol start="4">
<li>该消息位于hello-world.xml文件中。指定要替换的文件。</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-structured-configuration-file.png" class="zoom" data-title=""><img src="../Images/16a2ae2697bc30b159bc77047e3b056a.png" class="img-fluid center" alt="Define file to perform replacement" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/octopus-structured-configuration-file.png"/>T2】</a></p>

<ol start="5">
<li><p>创建一个XPath项目变量并赋予它一个值。在这种情况下，XPath是<code>/*[local-name()='mule']/*[local-name()='flow']/*[local-name()='set-payload']/@value</code>。</p>
</li>
<li><p>创建一个版本并部署。部署完成后，测试您的API以查看新消息。</p>
</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/postman-changed-message.png" class="zoom" data-title=""><img src="../Images/68eea15cb6ade387a594a6b41ca82c82.png" class="img-fluid center" alt="Use postman to see changed message" data-original-src="https://i.octopus.com/blog/2022-10/deploying-to-mulesoft-runtime/postman-changed-message.png"/></a>T2】</p>

<h2 id="conclusion">结论</h2>

<p>在本文中，您学习了如何使用MuleSoft Anytime Studio创建API，以及如何使用Octopus Deploy将它部署到运行Mule Community Edition Runtime的服务器上。</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>