# Octopus 3.4 的新特性:多租户部署——Octopus 部署

> 原文：<https://octopus.com/blog/whats-new-multi-tenant-deployments>

这篇文章是我们 Octopus 3.4 博客系列的一部分。在我们的[博客](https://octopus.com/blog/octopus34-blog-series-kickoff)或我们的[推特](https://twitter.com/OctopusDeploy)上关注它。

**Octopus Deploy 3.4 已经发货！阅读[博文](https://octopus.com/blog/octopus-deploy-3.4)和[今天就下载](https://octopus.com/downloads)！**

* * *

## Octopus 3.4 的新特性:多租户部署

继续上一篇[博客文章](https://octopus.com/blog/whats-new-elastic-transient-environments)的主题，我将后退一步，概述新的多租户部署特性集。多租户部署是一个高级特性，它为 Octopus 部署体验增加了一个全新的维度，但我们努力让它变得平易近人！请继续阅读，了解更多信息。:)

### 为什么我应该关注多租户部署？

如果您曾经想要将项目的多个实例部署到每个环境中，那么您应该考虑在 Octopus Deploy 中进行多租户部署。例如:

*   您希望在您的测试/QA/UAT 环境中有多个独立的部署
*   您想要为每个测试人员提供一个隔离的测试部署
*   您希望为功能分支上的工作提供独立的部署
*   您希望跨环境管理对单个目标的部署，例如管理一组嵌入式设备或一组笔记本电脑/工作站
*   您想将您的项目部署给另一个客户
*   你想把你的项目变成一个 SaaS 应用程序

保罗·斯托弗最近录制了一集《T2》。NET Rocks 谈论[构建多租户应用](https://www.dotnetrocks.com/?show=1332)。如果能更好地理解为什么要构建多租户应用程序，以及在设计和部署多租户应用程序时要考虑的因素，这将是一次很好的聆听。强烈推荐的播客！

## 特征

### 功能切换

多租户部署的一个最重要的特征是，它被有意设计成一个附加的东西。换句话说，如果你不需要它，你不应该注意到有任何变化。这由 Octopus *功能*配置屏幕中的功能开关控制。

![](img/e3feaf293a76f00ca58ef190a704a1d1.png)

同样需要注意的是，如果您启用了多租户部署，您可以继续愉快地部署现有项目，直到您决定将租户连接到它们。如果您将一个项目连接到一个或多个租户，您仍然可以像现在一样通过环境部署它们。我们称之为非租赁部署。

![](img/a39461d6b0f5ab19ca02ec0c16ec0a29.png)

![](img/a771e73f8499406c8ea01e90a501fa8b.png)

最后，您可以完全控制项目如何支持多租户部署，从禁用它到要求租户进行部署。

![](img/4257cd34beeb16c375050cd05b5dee89.png)

### 头等房客

八达通的租户是一等公民。它们使您能够将项目部署到同一环境中的一个或多个租户。您可以在*租户*屏幕中创建和管理他们的详细信息，我们已经通过项目和环境更新了部署体验，以支持租户概念。

![](img/bbc5bee2eb34fcd9bbfa44863b6985b8.png)

![](img/5218aaddcc0c22babc5af39561343c93.png)

![](img/0bbe94603c5d656b2c11e347f06cf067.png)

![](img/90cab4f23127d75e258d9988b948213a.png)

![](img/b1b41a5f0ab0650a56d96450b570ec32.png)

### 可变模板

变量模板允许您指定将项目成功部署到租户所需的变量。它们可以在一个项目或一个库变量集上定义，我们根据它们定义的位置以稍微不同的方式解释它们。

在项目中定义变量模板意味着对于租户所连接的每个环境，变量可以有不同的值。这是管理技术设置(如数据库连接字符串或其他特定于环境的细节)的好方法。

![](img/16fbd152ed5e8a8f750ca9bd1f0318db.png)

![](img/90cab4f23127d75e258d9988b948213a.png)

在库中定义变量模板意味着无论项目和环境如何，该租户的变量都将有一个常量值。特定于租户的库变量模板值在“通用变量”选项卡下的租户页面上进行管理。

![](img/42714d2206f271eea7ec4ea4365e4c5f.png)

![](img/37b3c0b2639d0f942ee0402cf54ed97a.png)

### 租户标签集

租户标记可帮助您使用自定义标记对租户进行分类，从而为您的项目和环境定制租赁部署。租户标签是在标签集中定义的，用于将相似的标签组合在一起。项目步骤、通道、变量、机器、账户等等都可以被标记。这使您能够与多组租户一起工作，而不是单独工作。例如，您可以将最新版本部署到带有`Tenant Important/VIP`标签的所有租户。租户标签集可在库*租户标签集*屏幕中管理。

![](img/f1988e57b9626d4aee0e9d334ce2bd89.png)

![](img/91503dbad22d1119d680ce2e375deee2.png)

![](img/111b3170bca62a6806191d9197c9174f.png)

### 租户设计者/预览

一些团队可能只有几个租户，而其他团队可能有几千个租户。考虑到这一点，我们建立了一个租户选择设计器/预览工具，以便在您需要时通过 Octopus 轻松找到合适的租户。您可以按名称查找特定租户，按标记集/标记筛选租户，并进一步搜索结果租户。

![](img/07e54393fc37042d037c0ea867c1a359.png)

![](img/93d305f056510422db2036a91d3ec9ed.png)

### 租户部署

将所有这些功能整合在一起可以实现租户部署。通过增强核心 Octopus 部署体验，将一个版本部署到租户，以支持租户选择一个或多个租户，然后将它们部署到环境中。

![](img/c3a183bac251ad17e0a50be25a663af9.png)

Octopus 仪表板现在包括一个租户计数，向您显示一个环境中有多少租户拥有最新版本。这可以进一步定制，以过滤特定租户或标记/标记集值。

![](img/3f99da8f840a441597638dd3261b16ab.png)

默认项目概述指示板让您一目了然地看到哪些版本已经部署到了哪些环境和租户。更好的是，现在可以对仪表板进行过滤和分组，以便只查看您需要的相关信息。

![](img/35a1ce81e3356bf47c58c0cd1846292c.png)

![](img/5de6b8670468f6493dd2be6e838e83a1.png)

## 包裹

多租户部署是一项高级功能，但它也是我们最受欢迎的[用户意见](http://octopusdeploy.uservoice.com/)建议。我们很喜欢在我们构建它的时候从我们的社区收到的反馈，我们迫不及待地想要发布它。有关更多信息，请参见[多租户部署指南](http://docs.octopusdeploy.com/display/OD/Multi-tenant+deployment+guide)。