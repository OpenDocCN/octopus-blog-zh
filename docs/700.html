<html>
<head>
<title>Service Fabric Deployment Targets - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>服务结构部署目标- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/service-fabric-cluster-targets#2022-07-15">https://octopus.com/blog/service-fabric-cluster-targets#2022-07-15</a></blockquote>
                        <p>随着2018.5 的<a href="https://octopus.com/blog/octopus-release-2018.5">发布和</a><a href="https://octopus.com/blog/paas-targets"> Azure服务架构集群目标</a>的引入，我们认为这将是一个完美的机会，可以通过Octopus Deploy快速概述新的服务架构部署目标。</p>

<p>如果你刚刚开始，服务结构可能会有点让人不知所措😃尤其是如果您只是想获得创建灵活/可重复部署场景所需步骤的高级概述。这篇文章旨在通过展示Octopus Deploy的新Azure服务结构集群目标来解决这个问题！</p>

<h2 id="service-fabric-and-the-foreseeable-future">服务结构和可预见的未来</h2>

<p>Azure最近<a href="https://blogs.msdn.microsoft.com/appserviceteam/2018/03/12/deprecating-service-management-apis-support-for-azure-app-services/" rel="nofollow">宣布</a>从2018年6月30日起，他们将停止对服务管理API的支持。在这个声明之后(关于云服务的未来，社区有很多困惑——source:me = P ),已经确认云服务仍然会被支持，但是有一个明确的推动，将人们推向更新的资源管理世界。还有这样的陈述需要考虑:<em>“云服务在控制程度和易用性方面类似于服务结构，但它现在是一个遗留服务，建议新开发使用服务结构”</em> ( <a href="https://docs.microsoft.com/en-us/azure/app-service/choose-web-site-cloud-service-vm" rel="nofollow">来源</a>)。</p>

<p>随着Service Fabric成为Azure中新云服务开发的推荐路径，让我们看看使用您自己的Service Fabric集群进行设置和部署是多么容易。</p>

<h2 id="creating-a-service-fabric-cluster-on-azure">在Azure上创建服务结构集群</h2>

<p>Azure让安全启动和运行服务结构集群变得非常容易。关于服务结构和资源的<a href="https://docs.microsoft.com/en-us/azure/service-fabric/" rel="nofollow">文档在过去一年左右的时间里取得了长足的进步，对于任何想要查看快速入门指南和分步教程的人来说，这都是一个很好的资源。</a></p>

<p>为了跳到有趣的部分，你可以得到一个通过Azure门户创建Azure服务架构集群的<a href="https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-creation-via-portal" rel="nofollow">的演练，或者，如果编写脚本更适合你的话，</a><a href="https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-creation-via-arm" rel="nofollow">通过ARM创建Azure服务架构集群</a>。</p>

<p>对于这个例子，我们通过Azure portal方法手动创建了集群。</p>

<h3 id="gotcha-1-the-initial-wait-time">陷阱#1:初始等待时间</h3>

<p>当在Azure上构建服务结构集群时，我们需要仔细观察集群的状态，并确保在尝试连接或部署任何东西之前它显示“就绪”。</p>

<p><strike>这一点值得一提，因为在Azure上创建集群后，通常会有很长的等待时间，直到所有节点都已配置好，节点的“基线升级”也已完成，最终一切就绪。根据我们的观察，这个过程可能需要1-6个小时，这取决于某一天月亮和星星的排列😃</strike></p>

<p>自从这篇博文发表以来，Azure上的服务结构集群的启动时间已经显著改善，不到一个小时，有几次甚至不到半个小时。但是请记住，在尝试连接或部署任何东西之前，要等到状态为“就绪”😉<i>(2018年10月23日编辑)</i></p>

<p>一旦我们成功地创建了我们的集群，它应该像这样出现在我们的Azure门户中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-cluster-status.png" class="zoom" data-title=""><img src="../Images/aee1a74ad481827907bab8fe32a1fd76.png" class="img-fluid center" alt="Service Fabric Cluster Status" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-cluster-status.png"/>T2】</a></p>

<p>在这种情况下，我们已经在我们的集群上设置了<a href="https://octopus.com/docs/deployments/azure/service-fabric/connecting-securely-with-client-certificates">证书</a>和<a href="https://octopus.com/docs/deployments/azure/service-fabric/connecting-securely-with-azure-active-directory"> Azure Active Directory </a>安全模式，这样我们就可以很容易地用任一种安全模式测试连接。</p>

<h2 id="packaging-for-service-fabric">服务织物的包装</h2>

<p>微软使它成为超级<strike>开发者</strike>演示友好的，可以通过Visual Studio部署到服务结构。</p>

<p>问题是，演示友好！=真实世界(<em>“好友不让好友右键发布”</em> amirite)。</p>

<p>当直接从Visual Studio部署Service Fabric应用程序时，微软只<em>部分</em>打包你所有的文件。在部署过程中，它们实际上<em>将</em>回调到您的源代码中用于<code>PublishProfiles</code>和<code>ApplicationParameters</code>(因此，默认情况下，您发布的包文件夹对除Visual Studio之外的任何东西都是无用的)。</p>

<p>为了解决这个问题，我们已经编写了特定的<a href="https://octopus.com/docs/deployments/azure/service-fabric/deploying-a-package-to-a-service-fabric-cluster">打包文档</a>来帮助您在现实世界中部署(而不是来自实习生笔记本电脑上的过度开发的IDE)。</p>

<blockquote class="blockquote">
<p>这是一种比喻，莫蒂。他们是官僚。我不尊重他们。</p>
</blockquote>

<p>对于本例，我们使用了打包文档的<a href="https://octopus.com/docs/deployments/azure/service-fabric/packaging#custom-build-targets">自定义构建目标</a>部分来帮助我们复制服务结构包所需的<code>PublishProfiles</code>和<code>ApplicationParameters</code>，以确保我们拥有部署所需的<em>一切</em>。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-solution-targets.png" class="zoom" data-title=""><img src="../Images/ef262144e913ce8bf877a0fb3d9adad8.png" class="img-fluid center" alt="Custom Build Targets file" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-solution-targets.png"/>T2】</a></p>

<p>有了我们的定制构建目标文件，我们现在可以构建/打包我们的SF项目了:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-package1.png" class="zoom" data-title=""><img src="../Images/a0f028978e4de4260d9a35bf289eb350.png" class="img-fluid center" alt="Packaging Service Fabric 1" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-package1.png"/>T2】</a></p>

<p>然后，我们应该会看到一个“pkg”文件夹，显示了<code>PublishProfiles</code>和<code>ApplicationParameters</code>(多亏了定制的构建目标文件)。这是服务结构从我们的包中需要的最终结构的示例。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-package2.png" class="zoom" data-title=""><img src="../Images/94cb344784c384ff85747a5774dbc93c.png" class="img-fluid center" alt="Packaging Service Fabric 2" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-package2.png"/>T2】</a></p>

<p>我们现在可以使用一个永远友好的包文件名来压缩它，这个包文件名可以被Octopus使用。在这种情况下，我们创建了一个名为<code>MarksServiceFabricAppOfAwesomenessNetCore.1.0.0.zip</code>的文件，其中包含了上面提到的包输出，并且我们已经将它上传到了Octopus服务器的<a href="https://octopus.com/docs/packaging-applications/package-repositories/pushing-packages-to-the-built-in-repository">内置包存储库</a>。</p>

<h2 id="installing-the-service-fabric-sdk">安装服务结构SDK</h2>

<p>因为微软喜欢他们的GAC，所以在任何与部署相关的东西可以对服务架构起作用之前，我们的部署服务器需要安装<a href="https://g.octopushq.com/ServiceFabricSdkDownload" rel="nofollow">服务架构SDK </a>，并且需要启用PowerShell脚本执行(完整说明可以在这里找到<a href="https://octopus.com/docs/deployments/azure/service-fabric/deploying-a-package-to-a-service-fabric-cluster">)。</a></p>

<h2 id="its-time-to-deploy">是时候部署了</h2>

<p>恭喜你。如果你已经走了这么远:</p>

<ul>
<li>我们的SF群集说它“准备就绪”。</li>
<li>我们已经成功理解了创建独立服务结构包的打包说明。</li>
<li>我们已经在Octopus部署服务器上安装了Service Fabric SDK，并如上所述设置了PowerShell脚本执行。</li>
</ul>

<p>现在我们已经为部署世界做好了准备！(有趣的部分。)</p>

<p>在我们继续之前，如果您正在使用证书进行身份验证，请确保您已经<a href="https://octopus.com/docs/deployments/certificates/add-certificate">将证书添加到Octopus证书库</a>中，以准备在您的新服务结构集群目标中使用它。</p>

<h3 id="create-an-octopus-service-fabric-cluster-target">创建Octopus服务结构集群目标</h3>

<p>我们现在可以将我们的服务结构集群作为Octopus中的一个成熟的部署目标，这将使我们能够与Azure上的集群进行通信。</p>

<p>首先，我们前往<code>Infrastructure &gt; Deployment Targets</code>，点击<code>Add Deployment Target</code>，从列表中选择<code>Azure Service Fabric Cluster</code>:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-create-target1.png" class="zoom" data-title=""><img src="../Images/6276b9cf5142eb2a93c06bf6466da140.png" class="img-fluid center" alt="Creating Azure Service Fabric Targets - step 1" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-create-target1.png"/>T2】</a></p>

<p>接下来，我们填写Azure上的服务结构集群的详细信息，记住根据需要选择正确的安全模式。在这种情况下，我们引用先前上传到我们的证书库的证书:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-create-target2a.png" class="zoom" data-title=""><img src="../Images/44918b29dcf127836375edf24f790cb2.png" class="img-fluid center" alt="Creating Azure Service Fabric Targets - step 2" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-create-target2a.png"/>T2】</a></p>

<p>我们点击<code>Save</code>，然后等待健康检查完成。如果一切顺利，我们的Octopus服务器将使用安装在服务器上的Service Fabric SDK对SF集群运行健康检查(使用我们定义的安全模式参数),并将发现我们的目标是健康的:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-create-target3.png" class="zoom" data-title=""><img src="../Images/85115c4a33dafe24b1abd1701d241358.png" class="img-fluid center" alt="Creating Azure Service Fabric Targets - step 3" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-create-target3.png"/>T2】</a></p>

<p>我们现在可以通过角色引用这个部署目标作为我们部署过程的一部分，就像任何其他目标一样！</p>

<h3 id="deploying-to-our-new-service-fabric-cluster-target">部署到我们新的服务结构集群目标</h3>

<p>对于本例，我们已经创建了一个测试项目，并希望<strong>部署一个服务结构应用</strong>包，因此我们从可用步骤模板列表中键入“Fabric ”,并找到我们想要的步骤:</p>

<p>【T2 <img src="../Images/45720a816973610c3ce0dec7d5d05e30.png" class="img-fluid center" alt="Deploying Service Fabric App package - step 1" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-step1.png"/></p>

<p>然后，我们需要选择该步骤将部署到的角色(分配给我们的目标的角色)，并选择我们之前上传的服务结构包，包括发布配置文件的路径:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-step2.png" class="zoom" data-title=""><img src="../Images/a8cf5c7ade1bf075251699c2c3b0a803.png" class="img-fluid center" alt="Deploying Service Fabric App package - step 2" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-step2.png"/>T2】</a></p>

<p>点击<code>Save</code>，我们准备部署！</p>

<p>运行部署后，我们可以看到Azure SF PowerShell cmdlets成功地将我们的包部署到我们的Azure Service Fabric集群:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-deploy.png" class="zoom" data-title=""><img src="../Images/274c88498bbac15fe872321bd174c41c.png" class="img-fluid center" alt="Deploying Service Fabric App package" data-original-src="https://i.octopus.com/blog/2018-05/service-fabric-cluster-targets/sf-deploy.png"/>T2】</a></p>

<p>:呜呜:</p>

<h2 id="azure-deployment-targets">Azure部署目标</h2>

<p>关于这些新的Azure目标，真正酷的事情是现在存在于<em>基础设施</em>关注点和<em>部署过程</em>关注点之间的明确分离。现在，您可以独立于项目的部署流程来设置和监控您的Azure基础设施，这简化了您的部署并使其更容易推理。</p>

<p>我们的新Azure目标从<code>2018.5</code>开始提供。要了解更多细节，你可以查看完整的<a href="https://octopus.com/blog/octopus-release-2018.5"> 2018.5博客帖子</a>，其中包括一个由真正的加拿大人制作的精彩视频。</p>

<p>如果您有任何想法/反馈，请告诉我们，一如既往，祝您部署愉快！</p>

                    
                    
</body>
</html>