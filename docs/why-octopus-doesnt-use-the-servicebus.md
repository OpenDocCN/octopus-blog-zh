# 为什么章鱼不用。网络服务总线(或轮询)- Octopus 部署

> 原文：<https://octopus.com/blog/why-octopus-doesnt-use-the-servicebus>

Octopus 服务器将软件部署到许多部署代理(“触角”)。[通信模型](http://octopusdeploy.com/documentation/security/octopus-tentacle)使用标准的客户机/服务器模型，触手监听 TCP 端口(默认为 10933 ), Octopus 与之连接。

```
Octopus Server -------> Tentacle 
```

一个常见的功能要求是反转这种通信，因此:

```
Octopus Server <------- Tentacle 
```

这方面的一些实现选项可能是:

*   让触角“轮询”Octopus 服务器的部署命令
*   使用像 web sockets/SignalR 这样的技术
*   使用。网络服务总线

举个例子，考虑一家向银行销售软件的云创业公司。Octopus 服务器可能安装在 Amazon EC2 上，而触手代理将安装在银行的生产 web 服务器上，深埋在银行管理的数据中心中。

上面描述的特性——让银行的生产 web 服务器调用 Amazon 托管的 Octopus 服务器——听起来是一个很好的解决方案，可以避免银行打开防火墙规则。但是缺点是什么呢？

## 为什么章鱼是这样工作的

选择当前的通信架构有几个原因:

1.  “服务器”通常提供一些服务——有可能已经允许到服务器的入站连接，否则您不会向它部署任何东西。根据我的经验，让系统管理员批准一个出站连接和让他们批准一个入站连接一样困难，特别是当 Octopus 服务器与生产 web 服务器处于不同的安全区域时。
2.  我发现大多数系统管理员实际上更喜欢这样，因为他们可以创建规则来调节入站连接。如果软件试图“绕过”防火墙规则，这可能会导致系统管理员不信任它。
3.  负载/性能——让触手向外连接意味着某种主动连接——无论是使用套接字还是轮询。通过让触手监听，我们只有一个打开的监听套接字和一个等待 I/O 的阻塞线程。虽然这两种方式的开销都很小，但如果触手碰巧运行在生产 web 服务器上，一些人会觉得这种方法更舒服。
4.  这与大多数操作工具的工作方式一致——WinRM、PSExec、SSH——都需要“目标”服务器进行监听
5.  它更简单，越简单越好

## 逆转这种模式可能会损害信任

![Who broke through my firewall?](img/49a3a47c691faf2618f17c7e8f94ecf4.png)

在我看来，逆转这一模式的唯一原因是“绕过”防火墙规则。但是它实际上并不是关于绕过防火墙规则(从技术上讲，这些规则并不难改变)；**这是关于围绕控制防火墙规则**的*人*工作。

如果我是上述银行的系统管理员，我想我更愿意知道在我的生产服务器上运行的软件需要打开一个端口，并且我有机会批准/拒绝它。如果该软件悄悄地“绕过”我的防火墙规则，我会非常不安。我宁愿有人花时间告诉我这个软件的目的(使应用程序部署更简单)和[它的安全方面](http://octopusdeploy.com/documentation/security/octopus-tentacle)，这样我就可以做出明智的选择。如果八达通使我周围的工作变得容易，我就不太可能信任该产品。

现在，任何银行系统管理员都不太可能同意更改防火墙规则，以便亚马逊托管的 web 服务器可以将软件部署到银行的生产 web 服务器中。但是如果他们不同意，这难道不是足够的理由来知道试图绕过他们是一个坏主意吗？

## 有有效的场景吗？

虽然替代通信模型的唯一原因似乎是绕过防火墙(或者换句话说，绕过系统管理员)，但是有没有这样的场景，它可能是一个好主意呢？

反转模型可能是一个好主意的一个场景是当使用 Octopus 部署桌面软件时，其中触手运行在每个客户机工作站上。虽然它有可能工作，但我认为将软件部署到客户机工作站与将软件部署到服务器是完全不同的问题领域(由于连接性、大量的机器、需要客户机单独回滚等等)，Octopus 首先不适合这种情况。这就是为什么 Windows Update 不构建在 MS Deploy 之上的原因。

另一个例子可能是防火墙由外部提供商管理，虽然系统管理员很乐意更改规则，但及时更改规则可能很困难。同样，这感觉像是对人的问题的技术解决方案，但有时这就是它所需要的。

我很乐意听到您可能遇到过的任何使这种沟通模式成为必要的场景。现在，当我考虑实现它需要做的工作以及这种模型可能在产品中产生的不信任时，我觉得添加一个基于轮询/服务总线的通信模型并不是一个高优先级的特性。