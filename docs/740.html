<html>
<head>
<title>Testing PowerShell scripts with Tentacle - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用触手章鱼部署测试PowerShell脚本</h1>
<blockquote>原文：<a href="https://octopus.com/blog/testing-powershell-scripts#2019-02-20">https://octopus.com/blog/testing-powershell-scripts#2019-02-20</a></blockquote>
                        <p>Octopus允许您将PowerShell脚本<a href="http://octopusdeploy.com/documentation/features/powershell" title="Embedding scripts">嵌入到您的包</a>中，这些脚本会在部署过程中自动执行。这是一个很好的挂钩，可以让您:</p>

<ul>
<li>运行自定义可执行文件</li>
<li>配置Windows服务</li>
<li><a href="http://octopusdeploy.com/documentation/features/iis" title="IIS and PowerShell">配置IIS </a></li>
<li>执行数据库部署脚本</li>
<li>配置文件和文件夹的安全设置</li>
<li><a href="http://technet.microsoft.com/library/bb978526.aspx" title="What can I use PowerShell for?">成吨的其他东西</a></li>
</ul>

<p>在Octopus portal中定义的变量会自动传递到您的脚本中，因为变量的作用域可以是环境或机器，所以这提供了一个很好的方法来为不同的环境参数化您的脚本。</p>

<p>触手代理在进程中托管PowerShell，这意味着脚本在普通PowerShell中的运行方式与在Octopus中的运行方式有时会有所不同。测试脚本总是很困难——你必须将它们打包，创建一个发行版，然后部署这个发行版，只是为了看看对脚本的一个小的改变是否有效。</p>

<p>如果您在运行PowerShell脚本时遇到问题，您现在可以使用触手可执行文件直接测试脚本，这意味着它们在与部署完全相同的上下文中运行。您可以从命令行使用以下命令来完成此操作:</p>

<pre><code>Tentacle.exe run-script -v Message="Hello world!" -v Repeat=5 -f MyScript.ps1
</code></pre>

<p><code>-v</code>参数允许您传递变量(就像它们是部署中使用的变量一样)。<code>-f</code>参数指定要运行的脚本文件。你也可以使用<code>-w</code>来设置一个自定义的工作目录。</p>

<p>假设我的脚本是这样的:</p>

<pre><code>foreach ($i in (1..$Repeat))
{
    write-host $Message
}
</code></pre>

<p>输出如下所示:</p>

<p><img src="../Images/6780334460d624821e67ca6eaacb3da3.png" alt="Output from Tentacle" title="Output" data-original-src="https://i.octopus.com/blog/migrated/11/PowerShell.png"/></p>

<p>这个特性在<a href="http://octopusdeploy.com/downloads?version=1.0.16.1276" title="1.0.16.1276"> build 1.0.16.1276 </a>中提供。希望它能让在触手环境中测试PowerShell脚本变得更容易！</p>

<h3>了解更多信息</h3>



                    
                    
</body>
</html>