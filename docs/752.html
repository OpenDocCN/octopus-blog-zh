<html>
<head>
<title>Deploying Certificates to Tomcat - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>将证书部署到Tomcat - Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/tomcat-https#2021-10-14">https://octopus.com/blog/tomcat-https#2021-10-14</a></blockquote>
                        <p>在之前的一篇文章中，我向您展示了如何将由Octopus Deploy管理的证书导出到Java密钥库中，然后配置WildFly来利用密钥库提供对web应用程序和管理端口的HTTPS访问。</p>

<p>在这篇文章中，我将向你展示如何在Windows中为Tomcat做同样的事情。</p>

<h2 id="prerequisites">先决条件</h2>

<p>要运行这篇博文中的命令和脚本，您需要安装一些工具。</p>

<p>第一个是OpenSSL客户机。我使用了来自<a href="https://slproweb.com/products/Win32OpenSSL.html" rel="nofollow"> Shining Light Productions </a>的Windows OpenSSL二进制文件。</p>

<p>第二个是Groovy SDK。你可以从<a href="http://groovy-lang.org/download.html" rel="nofollow"> Groovy下载页面</a>下载安装程序。</p>

<p>这些步骤已经用Tomcat 8 测试过了，但是应该适用于Tomcat 6以上的所有版本。</p>

<p>最后，你还需要安装Java 8 JDK。</p>

<h2 id="creating-and-distributing-certificates">创建和分发证书</h2>

<p>因为WildFly和Tomcat都使用Java密钥库，所以WildFly博文中的<a href="https://octopus.com/blog/wildfly-https#creating-the-certificate-store">创建证书库</a>和<a href="https://octopus.com/blog/wildfly-https#exporting-the-certificate-store">导出证书库</a>下的指令可以完全相同的方式应用于Tomcat。</p>

<p>如果您遵循这些步骤，您的Tomcat实例将有一个名为<code>C:\keystore.jks</code>的文件。</p>

<h2 id="configuring-https-in-tomcat">在Tomcat中配置HTTPS</h2>

<p>为Tomcat配置HTTPS支持实际上非常简单。我们需要做两件事:</p>

<ol>
<li>向引用密钥库的<code>server.xml</code>文件添加一个<code>&lt;Connector&gt;</code>元素，如下所示:</li>
</ol>

<pre><code class="language-xml">&lt;Connector SSLEnabled="true"
    keystoreFile="C:\keystore.jks"
    keystorePass="Password01"
    port="8443"
    protocol="org.apache.coyote.http11.Http11NioProtocol"
    scheme="https"
    secure="true"
    sslProtocol="TLS"/&gt;
</code></pre>

<ol start="2">
<li>确保现有的HTTP连接器<code>redirectPort</code>属性指向HTTPS端口，如下所示:</li>
</ol>

<pre><code class="language-xml">&lt;Connector
   connectionTimeout="20000"
   port="8080"
   protocol="HTTP/1.1"
   redirectPort="8443"/&gt;
</code></pre>

<p>为了促进这些改变，我们写了一个<a href="https://github.com/OctopusDeploy/JBossDeployment/blob/master/tomcat-deploy-certificate.groovy" rel="nofollow"> Groovy脚本</a>，它将使用必要的改变来更新<code>server.xml</code>文件。</p>

<h2 id="running-the-script">运行脚本</h2>

<p>要用HTTPS支持更新Tomcat，运行如下脚本:</p>

<pre><code class="language-bash">groovy tomcat-deploy-certificate.groovy --tomcat-dir C:\apache-tomcat-8.5.15 --https-port 8443 --http-port 8080 --keystore-file C:\keystore.jks --keystore-password Password01
</code></pre>

<p>就是这样！重新启动Tomcat，您将能够通过安全连接访问它。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2017-06/tomcat-https.png" class="zoom" data-title=""><img src="../Images/3823c341fb656272d5da9c0603223c92.png" class="img-fluid center" alt="Tomcat HTTPS" data-original-src="https://i.octopus.com/blog/2017-06/tomcat-https.png"/>T2】</a></p>

<h2 id="next-steps">后续步骤</h2>

<p>这些Groovy脚本正在被开发，作为最终将被移植到Octopus Deploy中直接提供的步骤中的概念验证。</p>

<p>如果你对剧本有任何问题，请留下评论。如果有一些Java特性你希望Octopus在未来部署支持，请加入<a href="https://octopus.com/blog/java-rfc"> Java RFC帖子</a>的讨论。</p>

                    
                    
</body>
</html>