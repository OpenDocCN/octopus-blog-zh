<html>
<head>
<title>Further lessons learned building a Raspberry Pi cluster - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>构建Raspberry Pi集群- Octopus部署的进一步经验</h1>
<blockquote>原文：<a href="https://octopus.com/blog/raspberry-pi-further-lessons-learned#2021-11-22">https://octopus.com/blog/raspberry-pi-further-lessons-learned#2021-11-22</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/raspberry-pi-further-lessons-learned/raspberry-pi-cluster.png" class="zoom" data-title=""><img src="../Images/a29c72d8b24f0ae31b8366c2a4f2b534.png" class="img-fluid center" alt="Further lessons learned building a Raspberry Pi cluster" data-original-src="https://i.octopus.com/blog/2020-12/raspberry-pi-further-lessons-learned/raspberry-pi-cluster.png"/>T2】</a></p>

<p>在之前的一篇文章<a href="https://octopus.com/blog/raspberry-pi-cluster-lessons-learned">构建Raspberry Pi集群的经验教训</a>中，我分享了我在Docker集群中使用Raspberry Pi机器时学到的一些东西。以下是我后来学到的一些经验(如果你想看前四课，可以看看<a href="https://octopus.com/blog/raspberry-pi-cluster-lessons-learned">之前的帖子</a>)。</p>

<h2 id="configuration-and-networking-update">配置和网络更新</h2>

<p>在上一篇文章中，集群由五台Raspberry Pi机器组成，这是因为我有8端口交换机。后来，我升级到了24端口交换机，这使我可以用另外三台Pi机器来完全填充机箱。总共有八台机器，我可以在Docker Swarm和Kubernetes (K8s)之间平均分配。</p>

<p>如果你感兴趣，我把我的整个网络设备换成了Unifi。这篇文章不是关于网络设备的，但是如果你曾经考虑过Unifi，我强烈推荐它。它让您以更合理的价格控制企业设备。提醒一句，他们给你足够的配置自由，让你自己陷入困境，有可能失控:</p>

<blockquote class="blockquote">
<p>如果我在儿童室和餐厅之间再增加一个接入点，我就可以在走廊上一直保持5Ghz的信号强度</p>
</blockquote>

<p>你已经被警告了😃</p>

<h2 id="lesson-5-raspberry-pi-4-has-a-64-bit-processor-but-raspberry-pi-os-is-still-32-bit">第5课:Raspberry Pi 4有64位处理器，但Raspberry Pi操作系统仍然是32位的</h2>

<p>正如我在上一篇文章中提到的，并不是所有的容器都可以在ARM架构上运行。然而，我确实发现有许多容器可以在ARM64上运行。在我最初的项目中，我试图运行这些ARM64兼容的容器，但是他们都声称不兼容的架构。当我读到Raspberry Pi 4中的处理器是64位芯片时，我感到困惑。我没有意识到的是，Raspberry Pi操作系统仍然只有32位，这是有意义的，因为直到最近他们才提供了一个大于4GB内存的模型。随着8GB型号的推出，Raspberry Pi OS也有了64位版本，但仍处于测试阶段。</p>

<p>我做了更多的研究，发现Ubuntu有一个64位的ARM兼容版本。由于对Ubuntu有些熟悉，我将这个操作系统加载到了我的4台Raspberry Pi机器上。</p>

<h2 id="lesson-6-arm64-compatible-containers">第6课:ARM64兼容容器</h2>

<p>除了学习集群计算，我的Raspberry Pi项目的另一个目标是通过使用容器而不是虚拟机来减少虚拟机管理程序的负载。我想替换的其中一个虚拟机运行的是MySQL。我在<a href="https://hub.docker.com" rel="nofollow"> Docker Hub </a>上找到的唯一一个在ARM上运行的容器是非官方的、旧的、很少更新的MySQL的Raspberry Pi端口。不幸的是，我使用的数据库部署技术会抱怨它们太旧，需要我购买新的许可证...嘘！幸运的是，<a href="https://hub.docker.com/r/mysql/mysql-server" rel="nofollow"> MySQL-Server </a>容器恰好兼容ARM64！有了几个YAML文件，我很快在我的K8s集群中运行了MySQL容器:</p>


 
 
  
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql-dev-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      component: mysqlserver-dev
  template:
    metadata:
      labels:
        component: mysqlserver-dev
    spec:
      containers:
        - name: mysqlserver-dev
          image: mysql/mysql-server
          ports:
            - containerPort: 3306
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: "A_Password_I_will_not_share"
            - name: MYSQL_ROOT_HOST
              value: "%"
</code></pre>
  
  
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: loadbalancer-dev-mysql
spec:
  selector:
    component: mysqlserver-dev
  ports:
    - port: 3306
      targetPort: 3306
      name: mysqldevport
  externalIPs:
    - 192.168.1.64
  type: LoadBalancer
</code></pre>
  
 


<p>随着这个容器的运行，我现在可以运行MySQL的现代版本，并测试各种部署方法(Dbup、Flyway、Liquibase和RoundhousE)！</p>

<h2 id="lesson-7-better-swarm-monitoring">第7课:更好的群体监控</h2>

<p>在我最初的Swarm项目中，我遵循了一个指南<a href="https://howchoo.com/g/njy4zdm3mwy/how-to-run-a-raspberry-pi-cluster-with-docker-swarm" rel="nofollow">让你运行一个叫做Visualizer的容器。这个容器显示了集群中的哪个节点上运行了哪些容器，除此之外别无其他。我的同事Adam Close告诉我关于</a><a href="https://www.portainer.io/" rel="nofollow"> Portainer </a>，一个容器管理工具。</p>

<p>Portainer不仅能让你看到哪些容器在你的集群中运行，还能让你管理集群本身。左侧的导航显示了它的功能</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/raspberry-pi-further-lessons-learned/portainer-nav.png" class="zoom" data-title=""><img src="../Images/4937d0099cdaaf07701e7d493b09b337.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-12/raspberry-pi-further-lessons-learned/portainer-nav.png"/>T2】</a></p>

<p>不用说，Portainer是用于容器管理的更好的工具。</p>

<h2 id="conclusion">结论</h2>

<p>随着我对Linux、Docker和Kubernetes的了解越来越多，这个项目仍然很有趣。这也让我在新冠肺炎问题拖延的时候有事可做。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/raspberry-pi-further-lessons-learned/rpi-cluster.jpg" class="zoom" data-title=""><img src="../Images/3dfdc7da9253c6560054f3b53ceaf3a4.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-12/raspberry-pi-further-lessons-learned/rpi-cluster.jpg"/>T2】</a></p>

<p>附言:我知道我的电缆管理技能还有待提高😉</p>

                    
                    
</body>
</html>