<html>
<head>
<title>Breaking up monolithic deployments - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>打破单一部署- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/breaking-up-monolith-deployments#2021-08-12">https://octopus.com/blog/breaking-up-monolith-deployments#2021-08-12</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/blogimage-breaking-up-monoliths-2020.png" class="zoom" data-title=""><img src="../Images/a62a67c17b8a2377190e2e87ee659f0a.png" class="img-fluid center" alt="Breaking up monolithic deployments" data-original-src="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/blogimage-breaking-up-monoliths-2020.png"/>T2】</a></p>

<p>术语<em>整体部署</em>通常带有负面含义，然而，整体部署是应用程序随着时间增长的自然发展。在这篇文章中，我演示了如何将一个整体流程分解成更小的可部署组件。</p>

<h2 id="pitstop">进站</h2>

<p>在这篇文章中，我将使用<a href="https://github.com/EdwinVW/pitstop" rel="nofollow"> Pitstop </a>应用程序作为例子。我选择Pitstop是因为它包含多个移动部件:</p>

<ul>
<li>Web前端</li>
<li>蜜蜂</li>
<li>微服务</li>
<li>数据库</li>
<li>引用第三方docker容器</li>
</ul>

<p>这个应用程序的最初版本将数据库和表的创建嵌入到了C#代码中。为了进行更有用的演示，我提取了数据库活动，并将其放入部署流程中。此外，API和web前端都被dockerized化了。同样，我对此进行了修改，以便它们可以部署到Azure而不是容器。下面是<a href="https://github.com/OctopusSamples/PitStop" rel="nofollow">修改版</a>。</p>

<h2 id="monolithic-deployment-process">整体部署流程</h2>

<p>对Pitstop应用程序的修改是为了在部署过程中添加更多内容。部署Pitstop应用程序包括以下步骤:</p>

<ul>
<li>宽限通知-开始部署</li>
<li>创建CustomerManagement数据库(如果不存在)</li>
<li>创建发票数据库(如果不存在)</li>
<li>创建通知数据库(如果不存在)</li>
<li>创建车辆管理数据库(如果不存在)</li>
<li>创建车间管理数据库(如果不存在)</li>
<li>创建WorkshopManagementEventStore数据库(如果不存在)</li>
<li>部署发票微服务</li>
<li>部署审计日志微服务</li>
<li>部署通知微服务</li>
<li>部署时间服务微服务</li>
<li>部署车间管理微服务</li>
<li>部署客户管理数据库</li>
<li>部署发票数据库</li>
<li>部署通知数据库</li>
<li>部署车辆管理数据库</li>
<li>部署车间管理数据库</li>
<li>部署车间管理事件存储数据库</li>
<li>部署Pistop web应用程序</li>
<li>部署客户管理API</li>
<li>部署车辆管理API</li>
<li>部署车间管理API</li>
<li>宽限通知-部署完成</li>
<li>松弛通知-部署失败(仅在失败时)</li>
</ul>

<p>在这种形式下，完成部署大约需要15分钟。虽然这不是一个天文数字，但如果有一个组件停机并需要更新，这可能是一个永恒的数字。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/octopus-project-monolith-process.png" class="zoom" data-title=""><img src="../Images/94fe9c708272364528e4c6273111043f.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/octopus-project-monolith-process.png"/></a>T2】</p>

<h2 id="breaking-up-the-monolith">打破巨石</h2>

<p>查看我们的部署流程，我们可以确定一些相关的步骤，而其他步骤是独立的。例如，发票服务的步骤都是相互关联的，因此这些步骤可以分解到它们自己的Octopus项目中:</p>

<ul>
<li>宽限通知-开始部署</li>
<li>创建发票数据库(如果不存在)</li>
<li>部署发票微服务</li>
<li>部署发票数据库</li>
<li>宽限通知-部署成功</li>
<li>松弛通知-部署失败(仅在失败时)</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/octopus-project-invoice.png" class="zoom" data-title=""><img src="../Images/e7ca148f31b949d58a1ff31abbe46593.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/octopus-project-invoice.png"/>T2】</a></p>

<p>发票组件的部署现在只需1分钟，而在monolith中需要15分钟。这大大节省了时间，尤其是在发票组件是唯一需要更新的部分的情况下。</p>

<p>将整个过程分解成不同的项目将会产生类似这样的结果:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/octopus-component-projects.png" class="zoom" data-title=""><img src="../Images/9bae8999b42cc2b9940f81700383cc38.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/octopus-component-projects.png"/>T2】</a></p>

<p>应用程序的每个组件都被分解到各自的项目中，现在可以单独部署了。</p>

<h2 id="deployment-orchestration">部署流程编排</h2>

<p>既然我们已经将应用程序分解成了独立的可部署组件，那么当我们需要部署整个解决方案时，我们就面临着协调多个项目的问题。</p>

<h3 id="create-an-orchestration-project">创建业务流程项目</h3>

<p>Octopus Deploy包含一个名为<a href="https://octopus.com/docs/projects/coordinating-multiple-projects/deploy-release-step"> Deploy a Release </a>的内置步骤模板。该特性允许您选择不同的项目，并从其中部署最新的版本(社区模板<a href="https://library.octopus.com/step-templates/18392835-d50e-4ce9-9065-8e15a3c30954/actiontemplate-chain-deployment" rel="nofollow">链部署</a>具有类似的功能)。<strong> Deploy a Release </strong>步骤能够在出现变量提示时将变量传递给子项目。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/octopus-project-orchestration.png" class="zoom" data-title=""><img src="../Images/8a09e98420f282ab765464d58f3c88e0.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-12/breaking-up-monolith-deployments/octopus-project-orchestration.png"/></a>T2】</p>

<p>使用<strong>部署发布</strong>模板有几个注意事项:</p>

<ul>
<li>必须在创建业务流程项目发布之前创建子项目发布。这可以通过我们的构建服务器插件来完成，以从构建中创建发布，或者使用CLI。</li>
<li>无法选择子项目的特定发布版本。</li>
</ul>

<h2 id="conclusion">结论</h2>

<p>自动化应用部署是您开发运维之旅中的关键一步。如果您的部署过程已经达到了整体规模，下一步就是确定哪些组件可以单独部署，这通常是说起来容易做起来难。这种做法的一个副作用是，可以单独部署的相同组件通常可以单独构建，这可以大大减少构建持续时间，并缩短交付周期。随着构建持续时间和部署时间的减少，您可以更快、更频繁地部署应用程序。</p>

                    
                    
</body>
</html>