<html>
<head>
<title>SQL Server deployment options for Octopus Deploy - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Octopus Deploy的SQL Server部署选项- Octopus Deploy</h1>
<blockquote>原文：<a href="https://octopus.com/blog/sql-server-deployment-options-for-octopus-deploy#2022-07-07">https://octopus.com/blog/sql-server-deployment-options-for-octopus-deploy#2022-07-07</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-03/sql-server-deployment-options-for-octopus-deploy/sql-server-database-deployment-automation-options.png" class="zoom" data-title=""><img src="../Images/c6f7d9c4ef5d7b4dac4b65a471d864a9.png" class="img-fluid center" alt="SQL Server Deployment Options for Octopus Deploy" data-original-src="https://i.octopus.com/blog/2020-03/sql-server-deployment-options-for-octopus-deploy/sql-server-database-deployment-automation-options.png"/>T2】</a></p>

<p>如果您有一个SQL Server数据库并使用Octopus Deploy，那么您有几个关于数据库源代码控制和部署工具的选项。这篇博客文章提供了最广泛使用的工具的基本概述，以帮助您决定哪个选项最适合您的团队。</p>

<h2 id="model-based-and-migration-based-solutions">基于模型和基于迁移的解决方案</h2>

<p>大多数数据库源代码控制和部署工具可以大致分为基于模型的(T0)或基于迁移的(T5)。</p>

<p>基于模型的工具编写出数据库模式所需的最终状态，通常为每个对象创建一个脚本。在部署管道中的某个点，软件会将源代码与目标数据库进行比较，并生成一个部署脚本。</p>

<p>基于迁移的工具要求用户保存迁移脚本的有序列表。该工具将针对目标数据库执行它们。通常，该工具还会向目标数据库添加一个表，以记录已经部署了哪些脚本。</p>

<p>很多人对哪个更好有强烈的看法。这有点像一场激烈的战争，我不想在这里纠缠不清。然而，每种方法都有优点和缺点，如果你不知道它们是什么，我建议你在继续之前阅读一下这篇博文。</p>

<h2 id="home-grown-solutions">本土解决方案</h2>

<p>基于迁移的解决方案听起来似乎很容易在内部开发。然而，自行开发的解决方案通常会导致知识囤积、复杂且不可预测的部署以及巨大的维护成本。</p>

<p>自行开发的基于迁移的工具通常是作为附带项目产生的，坦率地说，它们不可能像无数类似的开源基于迁移的工具那样成熟，这些工具已经由经验丰富的维护人员社区经过多年的改进，并被世界各地成千上万的开发人员所使用。</p>

<p>在我从事数据库DevOps领域工作的十年中，我还没有看到一个自行开发的解决方案比类似的开源或供应商解决方案更适合组织的例子。不要这样做。请使用本文中的工具。</p>



<p>使用流行的工具通常是值得的。广泛使用的工具通常得到更好的支持，更好的文档记录，并且通常有可以找到答案的活跃社区。通常也可以招募有使用工具经验的人。</p>

<p>为了确定最广泛使用的工具，我首先根据Octopus团队友好提供的一些功能使用数据，检查了各种<a href="https://library.octopus.com/listing" rel="nofollow"> Octopus Deploy社区步骤模板</a>的相对受欢迎程度:</p>

<p>【T2 <img src="../Images/68d86812294d9ff89b481c06c917b8ae.png" class="img-fluid center" alt="Feature usage data in order of popularity descending: SSDT, Redgate, EF Migrations, Flyway, ApexSQL" data-original-src="https://i.octopus.com/blog/2020-03/sql-server-deployment-options-for-octopus-deploy/database-step-template-usage-data.jpg"/></p>

<p>这个数据有局限性。例如，人们完全有可能通过PowerShell步骤触发了他们的数据库部署工具，而没有使用库中的步骤模板。还有一些流行的工具，比如DbUp，它们没有step模板。也就是说，上述步骤模板的相对受欢迎程度与我的真实单词体验相符。</p>

<p>在这篇文章中，我将讨论DbUp和上面的每一个工具，除了ApexSQL，它的用户更少。</p>

<h2 id="ssdt">SSDT</h2>

<p><strong>类型:</strong>基于模型</p>

<p>上面列出的最流行的步骤模板部署DacPacs。这些是使用SQL Server数据工具<a href="https://visualstudio.microsoft.com/vs/features/ssdt/" rel="nofollow"/>(SSDT)从Visual Studio数据库项目中生成的构建工件。</p>

<p>SSDT是由微软构建的，它是随Visual Studio (VS)一起开箱即用的，所以假设你的开发者有适当的MSDN许可证，它基本上是免费的。这使得它成为大多数普通VS用户的自然解决方案。然而，对于更熟悉SQL Server Management Studio (SSMS)的数据库开发人员和DBA来说，VS可能会相当混乱。</p>

<p>Visual Studio数据库项目有点像. NET项目，由解决方案和项目文件组成。因此，这可能是大多数人的天然选择。NET开发人员，但可能会让任何SQL Server专家感到困惑。净经验。此外，有些人对不断在SSMS和VS之间转换感到沮丧</p>

<p>作为一个基于状态的工具，它提供了声明式数据库开发的许多生产力优势，但有时自动生成的部署脚本可能会做一些痛苦的事情，如删除数据或在巨大的表上重建索引。这些问题可能只有在首次部署到大型生产数据库时才会被发现。</p>

<p>SSDT确实有一些混合特性来解决这些问题，比如重构日志、部署前和部署后脚本，但是随着时间的推移，这些往往会变得难以管理。</p>

<p><strong>最好的:</strong>SQL Server的事实上的标准，Visual Studio中的构建过程，SQL环境变量。</p>

<p><strong>最糟糕的事情:</strong>在膨胀的预部署/后部署脚本中管理复杂的重构，管理依赖性。</p>

<h2 id="redgate">雷德盖特</h2>

<p>Redgate支持两种类型的SQL Server源代码管理项目。这两种项目类型都可以使用名为SQL Change Automation的PowerShell模块进行部署:</p>

<ul>
<li><a href="https://www.red-gate.com/products/sql-development/sql-source-control/" rel="nofollow"> SQL源代码管理</a>是SSMS的一个插件，为你的数据库创建一个基于模型的项目。</li>
<li>SQL变更自动化VS和SSMS插件为你的数据库创建一个基于迁移的项目。然而，虽然SCA项目主要是基于迁移的，但是它们有几个强大的混合特性。这使得SCA项目成为撰写本文时可用的最真实的基于混合迁移和基于模型的工具。</li>
</ul>

<h3 id="sql-source-control-projects">SQL源代码管理项目</h3>

<p><strong>类型:</strong>基于模型</p>

<p>几乎可以肯定，SQL源代码管理是继SSDT之后最流行的SQL Server源代码管理工具。SQL源代码控制和SSDT的主要区别在于，它不是内置于VS中，而是内置于SSMS中。对于大部分时间都在SSMS的SQL Server开发人员和数据库管理员来说，这大大简化了使用过程。不要再在不同的想法间跳跃。</p>

<p>部署是通过SCA PowerShell模块处理的，有一些优秀的step模板使得设置Octopus部署项目相对简单。差异报告也非常方便。查看<a href="https://octopus.com/blog/database-deployment-automation-using-redgate-sql-change-automation"> Bob最近的帖子</a>了解更多信息。</p>

<p>我已经在这里写了<a href="https://www.brentozar.com/archive/2018/12/comparison-review-microsoft-ssdt-vs-red-gate-sql-source-control/" rel="nofollow">关于SSDT和SQL源代码控制之间的差异的更详细的描述，并且还有一个关于这个主题的</a><a href="https://dlmconsultants.com/redgate-vs-ssdt/" rel="nofollow"> 30页的白皮书</a>。</p>

<p><strong>最好的事情:</strong>可用性，与SSMS整合，发布差异报告。</p>

<p><strong>最糟糕的事情:</strong>价格，管理复杂的重构。</p>

<h3 id="sql-change-automation-sca-projects">SQL变更自动化(SCA)项目</h3>

<p><strong>类型:</strong>迁徙型/混合型</p>

<p>在撰写本文时，SCA项目(以前称为ReadyRoll项目)无疑是最先进的SQL Server项目类型。它们旨在为您提供基于模型和基于迁移的工具的最佳部分。这确实增加了一些复杂性，所以有一点学习曲线，但是SCA通常会兑现它的承诺。</p>

<p>SCA主要是一个基于迁移的工具，但是因为它来自Redgate，所以它内置了模式比较和脚本生成功能。它也建立在SSDT之上，所以你可以免费继承许多最好的SSDT特性(部署前/部署后脚本、SQL环境变量等)。它带有SSMS和VS的插件，所以你可以使用你喜欢的IDE。</p>

<p>基本原则是，一旦您完成了开发数据库的一些开发工作，您点击一个按钮，SCA将生成您的脚本并将其添加到您的项目中。如果生成的脚本做了一些有点傻的事情，比如删除一列，您可以在提交到源代码控制之前编辑它。</p>

<p>由于覆盖，存储过程和函数通常是用基于迁移的工具管理的噩梦，所有的<em>可编程对象</em>被提取到项目的一个单独部分，在那里它们被视为一个基于迷你模型的子项目。这也有助于减少迁移脚本的总数，使基于迁移的部分更容易管理。这是基于迁移的项目要避免/减少的两个最大问题。</p>

<p>基于迁移的工具的另一个挑战是发现冲突。SCA通过在另一个迷你子项目中保存一个<em>模式模型</em>提供了一个方便的解决方案，为所有的表创建脚本。如果两个迁移脚本更新同一个表，您将在模式模型中看到合并冲突。模式模型还充当了期望的最终状态的便利参考点，尽管事实上它并不用于部署。</p>

<p>这种混合方法确实有一些缺陷。它更复杂，所以有一个学习曲线，并且基线化现有的项目并不容易。此外，如果您在任何迁移脚本中使用存储过程，您可能会遇到一些复杂的竞争情况，存储过程更新总是在最后应用，但是这对于大多数团队来说是一种边缘情况。</p>

<p>坦白地说，SCA最大的问题是你需要向别人要预算。与这篇博文中列出的所有其他工具不同，Redgate工具不是免费的。</p>

<p><strong>最佳:</strong>最佳混合解决方案，兼具基于模型和基于迁移的解决方案的优势。</p>

<p><strong>最差:</strong>价格，复杂度。</p>

<h2 id="entity-framework-ef-migrations">实体框架(EF)迁移</h2>

<p><strong>类型:</strong>迁移型</p>

<p><a href="https://docs.microsoft.com/en-us/ef/" rel="nofollow">实体框架</a> (EF)迁移是默认的部署解决方案，对于使用EF的人来说是现成的，EF是最流行的对象关系映射(ORM)工具。NET/SQL Server。</p>

<p>EF迁移的主要考虑不是部署功能本身，而是你是否想使用ORM工具。如果你问的最多。NET开发人员，他们可能会喜欢它。如果你问大多数数据库管理员，他们可能会讨厌它。这是另一场古老的火焰战争。</p>

<p>EF，尤其是在代码优先而不是数据库优先(大多数人都这样做)的情况下，为。NET开发人员，这使得他们更容易开发他们的。NET应用程序。这使得EF vary很受那些没有太多SQL Server经验或知识的开发人员的欢迎。</p>

<p>然而，开发人员往往会得到关于最终被推送到数据库的代码的糟糕反馈。SQL Server经验有限的开发人员加上对代码的糟糕反馈，常常会导致让DBA非常不高兴的查询。</p>

<p>当然，ORM在美国很受欢迎。NET社区，但要小心行事。此外，戴上我的DevOps帽子，确保你记得为整个价值流进行优化，而不是以下游工人为代价，为单个开发人员或团队/筒仓进行优化。</p>

<p><strong>极品:</strong> ORMs。</p>

<p><strong>最糟糕的事情:</strong> ORMs。</p>

<h2 id="flyway">候鸟迁徙所经的路径</h2>

<p><strong>类型:</strong>迁移型</p>

<p>Flyway 是一个基于移植的开源工具。最初由<a href="https://twitter.com/axelfontaine" rel="nofollow">阿克塞尔·方丹</a>撰写，最近被Redgate 收购<a href="https://tech.eu/brief/redgate-acquires-flyway-for-10-million/" rel="nofollow">。虽然它不是SQL Server使用最广泛的工具，但它在开源社区中非常流行。</a></p>

<p>这是一个Java应用程序，对于SQL Server部署工具来说可能有点奇怪，但这是因为，与本文中的其他工具不同，Flyway从一开始就被设计为跨平台的。Flyway用户可以运行MySQL、Postgres、Oracle或Flyway支持的20多种RDBMSs中的任何一种。这使得它成为支持多个关系数据库的商店的流行选择。</p>

<p>与大多数类似的工具相比，使用它相对简单:下载，用连接字符串更新配置文件，并将脚本放到<code>flyway-[version]/sql</code>目录中。然后打开命令提示符，输入<code>flyway migrate</code>。</p>

<p>也就是说，它没有内置的比较引擎。这意味着它不能为您生成部署脚本。您需要手动创建它们，或者使用数据库比较工具。</p>

<p>Flyway是数据库迁移工具的Marie Kondo。</p>

<p><strong>最好的事情:</strong>跨平台支持，简单——没有花里胡哨。</p>

<p><strong>最差:</strong> Java，没有花里胡哨。</p>

<h2 id="dbup">DbUp</h2>

<p><strong>类型:</strong>基于迁移</p>

<p>DbUp 是另一个非常受欢迎的开源迁移工具，尤其是在Octopus Deploy用户中。这可能与它是由保罗·斯托弗写的这一事实有很大关系。如果您是Octopus Deploy用户，您几乎肯定也使用过它，因为它被打包到Octopus Deploy安装程序中。你认为你的Octopus Deploy数据库是如何部署的？</p>

<p>DbUp是一个. NET库，您可以添加到自己的库中。NET apps，这解释了为什么它没有一个步骤模板。</p>

<p>像Flyway一样，DbUp没有任何巧妙的比较工具或花哨的特性。它故意是一个简单明了的迁徙者。创建和管理这些升级脚本的所有工作都取决于您。</p>

<p><strong>极品:</strong>简单/可定制，. NET。</p>

<p><strong>最糟糕的事情:</strong>需要一些C#技能。</p>

<h2 id="and-the-rest">其余的…</h2>

<p>还有很多其他的解决方案。有些人可能会感到恼火，因为我没有包括更多的供应商工具，如<a href="https://www.idera.com/productssolutions/it-database-management-tools#DESIGNModelsandDatabases" rel="nofollow"> Idera </a>、<a href="https://www.apexsql.com/" rel="nofollow"> ApexSQL </a>、<a href="https://www.dbmaestro.com/" rel="nofollow"> DBmaestro </a>，或者其他无数的开源迁移脚本运行程序，如<a href="https://www.liquibase.org/" rel="nofollow"> Liquibase </a>、<a href="https://code.google.com/archive/p/roundhouse/downloads" rel="nofollow"> RoundhousE </a>或<a href="http://dbdeploy.com/" rel="nofollow"> DBDeploy </a>。</p>

<p>如上所述，我的目的是列出最受欢迎的选项。根据Octopus提供的数据和我的个人经验，这篇博客文章中列出的工具是我认为Octopus Deploy用户中最受SQL Server部署欢迎的工具。</p>

<h2 id="conclusion">结论</h2>

<p>没有一种工具是完美的。他们都有自己的挑战，但他们也都有优势。然而，几乎可以肯定的是，在几乎所有情况下，使用这些工具中的一种比创建自己的数据库部署框架更好。</p>

<p>哪种工具最适合您的环境？嗯，看情况。但是这里有一个决策树，来自<a href="https://dlmconsultants.com/dlm-workshops/" rel="nofollow"> DLM顾问公司为期两天的数据库开发运维培训课程</a>，可以在您的团队中引发一些讨论:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-03/sql-server-deployment-options-for-octopus-deploy/decision-tree.jpg" class="zoom" data-title=""><img src="../Images/acb18ac05209bc06d1c48ad264df7923.png" class="img-fluid center" alt="A decision tree for SQL Server estates" data-original-src="https://i.octopus.com/blog/2020-03/sql-server-deployment-options-for-octopus-deploy/decision-tree.jpg"/>T2】</a></p>

<p>您在使用上述工具时有过正面或负面的体验吗？你试过其他工具吗？如果是这样，请在下面留言。我很想听听你的想法。</p>

<hr/>

<p>自2010年以来，Alex Yates一直在帮助组织将DevOps原则应用于他们的数据。他最引以为豪的是帮助Skyscanner开发了一天95次<a href="https://www.youtube.com/watch?v=sNsPnCv7hHo" rel="nofollow">部署的能力</a>，并支持了联合国项目服务办公室的发布流程。亚历克斯与除南极洲以外的各大洲的客户都有过合作——所以他渴望见到任何研究企鹅的人。</p>

<p>作为一名热心的社区成员，他共同组织了<a href="https://datarelay.co.uk/" rel="nofollow">数据接力</a>，是【www.SpeakingMentors.com】的创始人，并自2017年以来被公认为<a href="https://mvp.microsoft.com/en-us/PublicProfile/5002655?fullName=Alex%20Yates" rel="nofollow">微软数据平台MVP </a>。</p>

<p>Alex是官方Octopus Deploy合作伙伴<a href="https://dlmconsultants.com/" rel="nofollow"> DLM顾问</a>的创始人。他喜欢为那些希望通过改进IT和数据库交付实践来实现更好业务成果的客户提供指导、辅导、培训和咨询。</p>

<p>如果你想和亚历克斯一起工作，请发邮件至:<a href="mailto:enquiries@dlmconsultants.com" rel="nofollow">enquiries@dlmconsultants.com</a></p>

                    
                    
</body>
</html>