<html>
<head>
<title>Configuring Linux servers with Octopus Runbooks - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Octopus Runbooks配置Linux服务器- Octopus Deploy</h1>
<blockquote>原文：<a href="https://octopus.com/blog/configuring-linux-servers-with-runbooks#2022-07-04">https://octopus.com/blog/configuring-linux-servers-with-runbooks#2022-07-04</a></blockquote>
                        <p>当设置Linux服务器时，您必须根据您的需要配置系统。您可以将服务器用于web开发、系统管理、数据科学等等。每个用例都有不同的配置要求，手动配置这些服务器可能会很繁琐。</p>

<p>使用Octopus Runbooks，您可以创建一个可重复的、自动的过程来配置您的Linux服务器，并且它可以适应不同的配置需求。</p>

<p>在这篇文章中，我使用runbook配置了一个Linux服务器，以指定特定任务所需的所有依赖项。可以保存并导出该操作手册，以供未来具有相同要求的服务器使用。</p>

<h2 id="prerequisites">先决条件</h2>

<p>要跟进，您需要:</p>



<h2 id="creating-a-linux-server-in-azure">在Azure中创建Linux服务器</h2>

<p>Microsoft Azure是一个云计算平台，用于创建虚拟机、web应用程序和其他基于云的资源。我们使用Azure为我们的runbook示例创建一个Linux服务器。</p>

<p>在Azure主页上，导航到<strong>创建资源</strong>，然后<strong> Ubuntu Server 20.04 LTS </strong>，然后<strong>创建</strong>。</p>

<p>选择链接订阅并创建新的资源组。给服务器一个名称。在<strong> Administrator account </strong>下，生成一个SSH公钥或密码，供以后使用。选择<strong>查看+创建</strong>接受默认设置。</p>

<p>完成后，选择<strong>转到资源</strong>。点击<strong>连接，堡垒</strong>连接到服务器。您需要输入之前的SSH密钥或密码。如果这是你第一次设置堡垒，点击<strong>部署堡垒</strong>，等待它完成设置。</p>

<h2 id="installing-an-octopus-tentacle-on-the-linux-server">在Linux服务器上安装Octopus触手</h2>

<p>Bastion连接到Linux服务器后，您会看到一个Bash shell。您设置了一个Octopus触手来与运行runbook的Octopus实例通信。</p>

<p>运行以下命令安装触手:</p>

<pre><code>
sudo apt-key adv --fetch-keys https://apt.octopus.com/public.key

sudo add-apt-repository "deb https://apt.octopus.com/ stretch main"

# for Raspbian use

# sh -c "echo 'deb https://apt.octopus.com/ buster main' &gt;&gt; /etc/apt/sources.list"

sudo apt-get update

sudo apt-get install tentacle

</code></pre>

<p>触手需要与您的Octopus实例通信，因此您需要提供触手的密钥进行身份验证。</p>

<p>在你的Octopus实例中，点击<strong>你的个人资料</strong>，然后<strong>个人资料</strong>，然后<strong>我的API密匙</strong>，以及<strong>新API密匙</strong>。给密钥命名并确保保存它，因为它只出现一次。</p>

<p>通过运行以下命令，在Linux服务器上配置触手:</p>

<pre><code>
/opt/octopus/tentacle/configure-tentacle.sh

</code></pre>

<p>安装脚本会询问您一系列问题。请确保指定以下参数:</p>

<ol>
<li><strong>触手实例的名称(默认触手):</strong>按回车键接受默认值</li>
<li><strong>你想配置哪种触手:</strong> 1)监听或2)轮询(默认1): <code>2</code></li>
<li>您希望触手在哪里存储日志文件？(/etc/octopus): 按回车键接受默认值</li>
<li>您希望触手将应用程序安装到哪里？(/home/Octopus/Applications):按回车键接受默认值</li>
<li><strong> Octopus服务器URL(例如https://octopus-server): </strong>您的Octopus实例的URL</li>
<li><strong>选择验证方法:1) API-Key或2)用户名和密码(默认为1): </strong> 1</li>
<li><strong> API-Key: </strong>输入之前配置的API key</li>
<li><strong>选择您想要设置的触手类型:1)部署目标或2)工作器(默认为1): </strong> 1</li>
<li><strong>你想在哪个空间注册这个触手？(默认值):</strong>按回车键接受默认值</li>
<li>你想用什么名字注册这个触手？按回车键接受默认值</li>
<li><strong>输入该触手的环境(用逗号分隔):</strong>指定Octopus实例的环境</li>
<li><strong>输入该触手的角色(用逗号分隔):</strong>为触手指定一个角色，例如Linux(稍后将在操作手册中使用)</li>
<li>按下<strong>回车</strong>继续</li>
</ol>

<h3 id="confirming-the-tentacle-connection">确认触手连接</h3>

<p>你通过导航到<strong>基础设施</strong>，然后<strong>部署目标</strong>来确认你的触手已经连接到Octopus。这里您可以看到您连接的部署目标。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/linux-deployment-target.png" class="zoom" data-title=""><img src="../Images/edf3ed16c15f2f1c692f157bc0eb7f2e.png" class="img-fluid center" alt="Linux Deployment Target" data-original-src="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/linux-deployment-target.png"/>T2】</a></p>

<h2 id="setting-up-the-runbook-in-octopus">在Octopus中设置操作手册</h2>

<p>创建Linux服务器，安装并连接触手之后，就可以创建runbook了。该操作手册为web开发用例建立了一个开发环境。其他用例需要不同的配置设置。当web开发人员需要设置服务器时，操作人员可以运行runbook。</p>

<h3 id="create-the-runbook">创建操作手册</h3>

<ol>
<li>通过转到<strong>项目</strong>，然后<strong>添加项目</strong>，创建一个项目来托管运行手册。</li>
<li>在您的项目中，转到<strong>运行手册</strong>，然后<strong>添加运行手册</strong>，然后<strong>处理</strong>，然后<strong>添加步骤</strong>，然后<strong>脚本</strong>，然后<strong>运行脚本</strong>，最后<strong>添加</strong>。</li>
<li>在角色中目标的<strong>下，添加您在触手设置脚本中指定的角色。</strong></li>
<li>指定一个Bash脚本并添加以下代码:</li>
</ol>

<pre><code>
apt update

apt upgrade

apt install -y build-essential

apt install -y curl

apt-get install -y git-core

apt-get install -y nodejs

apt-get install -y npm

</code></pre>

<ol start="5">
<li>点击<strong>保存</strong>和<strong>运行</strong>。</li>
</ol>

<p>然后你会看到一个成功的结果。</p>

<p>【T2 <img src="../Images/90cd573700337ac4380d79a24c7f8b4b.png" class="img-fluid center" alt="Runbook success web developer" data-original-src="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/runbook-web-success.png"/></p>

<p>转到Linux服务器并运行<code>npm</code>命令来确认安装。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/npm.png" class="zoom" data-title=""><img src="../Images/d18d4bd00c04adabec9d31987c062e06.png" class="img-fluid center" alt="npm command" data-original-src="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/npm.png"/>T2】</a></p>

<h2 id="creating-a-different-configuration">创建不同的配置</h2>

<p>让我们使用一个简单的。网络配置。</p>

<p>创建另一个Linux服务器，按照上面的步骤创建另一个带有Octopus触手的runbook。</p>

<p>这一次，在步骤4中，添加以下代码:</p>

<pre><code>
wget https://packages.microsoft.com/config/ubuntu/21.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb

sudo dpkg -i packages-microsoft-prod.deb

rm packages-microsoft-prod.deb

sudo apt-get update; \

sudo apt-get install -y apt-transport-https &amp;&amp; \

sudo apt-get update &amp;&amp; \

sudo apt-get install -y dotnet-sdk-6.0

</code></pre>

<p>运行操作手册来配置服务器</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/runbook-web-success.png" class="zoom" data-title=""><img src="../Images/90cd573700337ac4380d79a24c7f8b4b.png" class="img-fluid center" alt="Runbook success" data-original-src="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/runbook-web-success.png"/>T2】</a></p>

<p>转到Linux服务器并运行<code>dotnet</code>命令来确认安装。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/dotnet.png" class="zoom" data-title=""><img src="../Images/125898413fcac1ef32cfea165359dc7a.png" class="img-fluid center" alt="dotnet command" data-original-src="https://i.octopus.com/blog/2022-q2/configuring-linux-servers-with-runbooks/dotnet.png"/>T2】</a></p>

<p>这个工作流程演示了runbooks可以配置Linux服务器。您创建了两个操作手册，一个将web开发配置应用到服务器，另一个使用. NET配置来配置服务器。</p>

<p>您可以根据需要为任意多的配置创建操作手册，确保每次创建时每个配置都是一致和自动的。</p>

<h2 id="conclusion">结论</h2>

<p>配置服务器可能是一个繁琐的手动过程。通常，一台服务器有多种配置要求。为了帮助解决这个问题，Octopus Runbooks提供了一种可重复的自动化方式来配置服务器。</p>

<p>Runbooks可以满足特定的配置需求，并在需要时触发。操作手册的可重复特性在您的组织基础设施中引入了一致性。Runbooks还减少了系统管理员的工作量，使他们可以专注于其他任务。</p>

<p>要进一步了解Octopus Runbooks如何帮助您满足部署需求，<a href="mailto:customersuccess@octopus.com" rel="nofollow">请联系我们的客户成功团队</a>。</p>

<p>阅读我们的<a href="https://octopus.com/blog/tag/Runbooks%20Series"> Runbooks系列</a>的其余部分。</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>