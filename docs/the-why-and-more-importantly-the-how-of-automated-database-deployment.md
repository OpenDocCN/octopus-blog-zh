# 为什么，更重要的是如何自动部署数据库——Octopus 部署

> 原文：<https://octopus.com/blog/the-why-and-more-importantly-the-how-of-automated-database-deployment>

[![Why and how your should automate your database deployments](img/9f8a69ddcfea5ce3f9e954c5646aecb4.png)](#)

可靠性、可追溯性、速度:这是自动化数据库变更部署的三大动力。尤其是当涉及到生产时，在审查的水平上没有妥协，这可能只是为了防止生产中发生灾难性的事情。

这种对质量的需求有一种奇怪的效果。我们最近与处于自动化数据库部署的不同阶段的 30 个团队进行了交谈，我们感到惊讶的是，对于许多团队来说，对高质量部署的需求阻止了他们开始时的自动化。

毕竟，如果某件事必须是正确的，你就要亲自去做。你注意每一步，你慢慢来，你充分利用你的经验，所有人类带给工作的好东西，对吗？此外，生产变更是 DBA 角色中非常明显的一部分；人们很容易认为自动化会向组织的其他成员表明它并不重要。

然后，突然，一些事情发生了，同样的人变了。有时是一系列失败的部署，对人类局限性的认识，或者可能是一个新人加入了以更好的方式工作的团队。同样的质量要求现在产生了相反的行为，团队认识到一个简单的事实:**如果你喜欢某样东西，就自动化它。**

这并不是说，“开发人员应该为数据库而疯狂”。有句老话是这么说的:如果你爱某样东西，就应该让它自由；但这里的情况正好相反。(毕竟，自由放养的数据库有办法变得野性十足。)一个高质量的过程约束了变更的流程，使进一步的开发变得容易，而不是抑制它。但是你从哪里开始呢？

在我们的调查电话中，流程变革以三种不同的方式展开:

## 自上而下

有些队伍是(un？幸运的是，我有一个自上而下的计划，可以让一大群任性的数据库保持一致。在这种情况下，可以预先设计一个新系统，所有组件都已就位。当速度和效率与商业价值直接相关时，这种方法更受青睐。以一个面向消费者的保险网站为例:在激烈的竞争压力下，新功能和漏洞修复正在交付。快速交付到产品中是必不可少的，所以他们努力工作，将数据库引入到他们的连续交付过程中。

如果开发人员和数据库管理员之间的沟通不畅，这可能是唯一能让双方合作做出改变的方法。

## 从“左边”

对于逐步引入变更的团队来说，自动化解决方案非常适合分阶段推出。首先，开发人员开始跟踪源代码控制中的数据库变更，解决可见性和冲突方面的问题。一旦他们沐浴在可追溯性的温暖光线中，团队就开始通过他们的 CI 系统运行变更，这样每个数据库变更都会触发基本的健全性检查。与应用程序开发 CI 一样，这为开发人员提供了关于他们的变更的快速反馈。

对于每个“绿色构建”,一些团队将变更直接推向集成或测试环境(持续部署),或者只是提供一个包(持续交付)给其他人。

无论是推还是拉的方法，都可以扩展到下游环境，如 UAT、试运行、生产，但在大多数情况下，诸如 Octopus Deploy 之类的发布管理工具正式确定了环境之间的关系，并提供了对什么版本在哪里的可见性。

这听起来像是这种方法总是由开发人员驱动的，但是我们已经看到了数量惊人的 DBA 推动了这种变化。或者这并不令人惊讶。重复排练将会暴露测试中的大多数问题，而不是生产中的问题，从而增加整体可靠性。

## 由外向内

我见过的另一种模式是通过钳形运动来实现自动化，但老实说，我不确定这是否能带来好的结果。在这种情况下，自动化来自开发生命周期的两端:开发和生产。这样做的动机是用工具或脚本缓解最尖锐的痛点，然后让自动化随着每个人对系统的信任而增长。

我对此不太确定的原因是，从我交谈过的团队来看，在这一点上很容易陷入困境。当然，它们首先解决最大的问题——通常是一个好方法。不利的一面是混乱被压缩到集成和测试中，众所周知，这两个领域很难预算修复所需的努力。

## 结论

对于我们交谈过的团队来说，使环境和流程成形比自动化本身更具挑战性，但即使如此，我们也找不到任何人会接受从部署自动化后退一步。即使是跳槽，他们也会坚持将他们的自动化知识应用到新的环境中。将工作放在部署过程中，而不是单独的部署，这意味着所有的爱和关心都得到了数百倍的回报。

* * *

这是来自 Redgate 的伊丽莎白·艾耶尔的客座博文。Redgate 是为在微软数据平台上工作的专业人员提供软件的领先供应商。他们帮助全球各种类型组织中的 800，000 多人，从中小型企业到财富 100 强中 91%的公司。他们的 SQL 工具带帮助用户为其数据库实施 DevOps 最佳实践，轻松监控数据库性能，并提高团队生产力。

[了解更多信息](https://www.red-gate.com)