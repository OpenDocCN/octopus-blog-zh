<html>
<head>
<title>Octopus Cloud connectivity disruption - report and learnings - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Octopus云连接中断-报告和学习- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/cloud-connectivity-disruption-report-learnings-feb23#2023-02-13">https://octopus.com/blog/cloud-connectivity-disruption-report-learnings-feb23#2023-02-13</a></blockquote>
                        <p>世界标准时间2023年1月25日星期三上午07:05至12:43之间，部分地区的章鱼云客户遇到了网络连接问题。这导致他们在尝试连接到Octopus云实例时出现长时间的网络延迟和/或超时，并影响Octopus Deploy的一些功能。特别是，如果一些Octopus部署操作涉及受影响网络上的网络调用，则这些操作将会失败。这次中断影响了章鱼云、Octopus.com/OctopusID,和octopus.com控制中心。</p>

<p>我们的上游云提供商Azure的网络中断导致了中断。</p>

<p>在本帖中，我们详细讲述了发生的事情和我们学到的知识。</p>

<p>由于这一事件，我们正在加强与Azure的关系，并改进对其可用性的监控。</p>

<h2 id="key-timings">按键计时</h2>

<table class="table">
<thead>
<tr>
<th>事件</th>
<th>期间</th>
</tr>
</thead>
<tbody>
<tr>
<td>检测时间</td>
<td>40分钟</td>
</tr>
<tr>
<td>事件申报时间</td>
<td>69分钟</td>
</tr>
<tr>
<td>解决问题的时间</td>
<td>4小时32分钟</td>
</tr>
</tbody>
</table>

<h2 id="incident-timeline">事故时间表</h2>

<p>2023年1月25日星期三<em>(以下所有日期和时间均以UTC表示)</em></p>

<p><strong> <em> 7:45: </em> </strong>一名Octopus工程师注意到，由于请求超时，对Azure门户的访问中断。Azure的状态页面对于所有服务仍然是绿色的(工作中)。该工程师发现，不管状态页面如何，连接问题很可能是在Azure的内部网络中，因为它并不总是准确地反映当前状态。他们还指出，可能是网络问题导致Azure无法更新他们的状态页面。该工程师注意到octopus.com/OctopusID,使用的数据库负载增加，如果这种情况持续下去，客户可能会面临登录问题。</p>

<p><strong> <em> 7:51: </em> </strong>一名支持工程师注意到，大约一小时前，一名客户报告无法使用OctopusID登录。</p>

<p><strong> <em> 7:51 - 8:14: </em> </strong>八达通工程师继续监控内部服务，并注意到外部服务的类似问题。所有观察到的问题都与云提供商网络中断一致。</p>

<p><strong> <em> 8:14: </em> </strong>一名Octopus工程师宣布发生事故，启动事故响应流程。</p>

<p><strong> <em> 8:14 - 8:19: </em> </strong>待命工程师调查了客户影响并更新了<a href="https://status.octopus.com/" rel="nofollow">我们的状态页面</a>以反映octopus.com/OctopusID,章鱼云和云控制中心的部分中断。他们还暂停了任何可能加剧事故的内部流程(例如，将Octopus服务器部署到Octopus Cloud)。</p>

<p><strong> <em> 8:33: </em> </strong>一名随叫随到的工程师指出，Azure的状态页面现在显示Azure正在调查所有地区的重大网络问题。</p>

<p><strong> <em> 8:33 - 8:42: </em> </strong>待命工程师继续监控上游网络中断，并指导支持团队将受影响的客户指向我们的状态页面。</p>

<p><strong> <em> 8:42: </em> </strong>基于持续停电和重大客户影响，在八达通的状态页面上，停电升级为重大停电。</p>

<p><strong> <em> 9时33分</em> </strong> - 9时59分:待命工程师注意到来自Azure的状态更新，表明中断的原因已经确定，事件的解决正在进行中。</p>

<p><strong> <em> 10:57: </em> </strong>待命工程师与支持工程师确认，客户开始看到他们与受影响的八达通服务的连接恢复。工程师证实，同样受到上游断电影响的内部服务正在开始恢复。</p>

<p><strong> <em> 11:37: </em> </strong>事件已宣布解决，状态页面也相应更新。</p>

<h2 id="technical-details">技术细节</h2>

<p>众所周知，上游云提供商停机很难为客户解决，因为这个问题通常超出了客户的控制范围。</p>

<p>Azure的内部网络承载着运行在云中的各种Octopus服务的流量。在这种情况下，受影响的服务是章鱼云，octopus.com/OctopusID和云控制中心。</p>

<p>影响主要是对外和跨区域交通。我们依赖该网络来承载该流量，并且不打算为该特定云提供商服务构建后备选项。</p>

<h3 id="azures-technical-details">Azure的技术细节</h3>

<blockquote class="blockquote">
<p>我们确定，对Microsoft广域网(WAN)所做的更改会影响互联网上的客户端与Azure之间的连接、跨区域的连接以及通过ExpressRoute的跨场所连接。作为更新WAN路由器上IP地址的计划更改的一部分，向该路由器发出的命令导致它向WAN中的所有其它路由器发送消息，这导致所有路由器重新计算它们的邻接和转发表。在这个重新计算过程中，路由器无法正确转发通过它们的数据包。导致问题的命令在不同的网络设备上有不同的行为，并且该命令没有在执行该命令的路由器上使用我们的完整认证流程进行审查。"</p>
</blockquote>

<p>来源:<a href="https://status.azure.com/en-us/status/history/" rel="nofollow">https://status.azure.com/en-us/status/history/</a>，2023年1月31日星期二检索。</p>



<p>Octopus非常重视服务可用性。尽管上游云提供商停机困难重重，但我们会全面审查和补救发生的任何停机。我们这样做是为了不断改进和保持尽可能最好的服务。</p>

<h3 id="cloud-provider-relationship">云提供商关系</h3>

<p>当向Azure提出问题时，我们与他们一起审查我们的上报流程选项。我们打算通过将我们的内部升级流程与他们的建议保持一致来跟进此事，因此我们简化了与Azure关于停机的所有沟通。</p>

<h3 id="internal-monitoring">内部监控</h3>

<p>我们的可用性监控发现了这个问题，但是因为网络问题是偶发性的，所以故障没有达到我们内部的警报阈值。我们正在审查我们的事件响应指南，以更密切地监控我们的云提供商的可用性仪表板。</p>

<h2 id="conclusion">结论</h2>

<p>我们为任何中断和不便向我们的顾客道歉。我们已经采取措施来完善我们与上游云提供商的问题上报流程。我们还在审查我们的仪器和Azure网络中断警报，以便我们能够尽早有效地向客户传达影响，使他们能够专注于愉快的部署。</p>

                    
                    
</body>
</html>