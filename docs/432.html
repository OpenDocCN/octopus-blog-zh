<html>
<head>
<title>Future of Deployment: Nano Server and .NET Core - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>部署的未来:纳米服务器和。网络核心-八达通部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/nano-server-future-deployment-models#2016-03-21">https://octopus.com/blog/nano-server-future-deployment-models#2016-03-21</a></blockquote>
                        <p>在过去的几个月里，我花了相当多的时间与<a href="https://octopus.com/blog/aspnet-core-build-and-deploy">ASP.NET Core 1</a>在一起，本周我一直在深入研究<a href="https://blogs.technet.microsoft.com/windowsserver/2015/04/08/microsoft-announces-nano-server-for-modern-apps-and-cloud/"> Windows Server 2016和Nano Server </a>。有一点是明确的:对于开发人员来说，当所有这些都投入生产时，我们部署和运行应用程序的方式将会发生相当大的变化。</p>

<h2>背景</h2>

<p>现在，像Octopus这样的工具的工作方式是把你的应用程序打包成一个ZIP文件，然后把它推到一台远程机器上。在那里，它被解压缩、配置，一个新的进程被启动，同时一个旧的进程被淘汰。流程可能是:</p>

<ul>
<li>NT服务(我们停止旧的服务，启动新的服务)</li>
<li>一个IIS网站(旧的应用程序池工作进程死亡，一个新的创建)</li>
</ul>

<p>就堆栈而言，它看起来像这样:</p>

<p><img src="../Images/c5a3122d65fd64253bd7e35551b17cc2.png" alt="Deploying new IIS apps/NT services on top of a bare-metal OS" data-original-src="https://i.octopus.com/blog/201603-process-level-deployments-WS33.png"/></p>

<p>或者也许像这样:</p>

<p><img src="../Images/96953a2f2bc4e8e8432b17a31794ec58.png" alt="Deploying new IIS apps/NT services on top of a VM OS" data-original-src="https://i.octopus.com/blog/201603-vm-level-deployments-BSQM.png"/></p>

<p>虽然您也许可以为每个应用程序版本创建一个新的虚拟机映像，部署一个全新的虚拟机并关闭旧的虚拟机，但现在没有人这样做，因为:</p>

<ol>
<li>VHDX/磁盘镜像文件非常庞大，至少有几十GB以上；而且，</li>
<li>启动要花很长时间</li>
</ol>

<p>(这就是为什么任何使用Azure云服务的人都会告诉你他们有多讨厌部署它们。也许如果纳米服务器已经存在，云服务将会变得巨大)</p>

<p>换一种方式思考这个问题:目前，在应用程序的不同版本之间唯一可行的“部署单元”是过程。为每个应用程序变化构建和部署一个新的虚拟机是很疯狂的(在Windows上)。</p>

<h2>Windows Server 2016:纳米服务器和容器</h2>

<p>Windows Server 2016有三种风格。我们已经熟悉的前两个:带有GUI的服务器和服务器核心。那里没什么有趣的。</p>

<p>第三种风格是纳米服务器，它是游戏规则的改变者。以下是纳米服务器的有趣之处:</p>

<ul>
<li>它<strong>小得可笑</strong>。完整的Nano服务器虚拟机映像，包含IIS、PowerShell和。NET Core，是750mb。</li>
<li>它<strong>快速启动</strong>。从“打开”到“IIS响应HTTP请求”的时间是几秒钟。</li>
<li>内存使用等。非常小，大约170mb。</li>
</ul>

<p>像Linux发行版一样，Nano Server也为您提供了如何运行它的选择:</p>

<ul>
<li>在裸机上</li>
<li>作为Hyper-V客户机器</li>
<li>在容器内</li>
</ul>

<p>是的，Windows Server 2016的另一个重大变化是容器。这是一项由Docker等公司在Linux操作系统上推广的技术，它也将进入Windows。</p>

<h2>许多应用程序部署单元</h2>

<p>有了Nano Server，当您考虑在2016年发布和部署您的应用时，突然有了许多选择:</p>

<p><img src="../Images/d1afe1b9c9404e8b91b8ca3d96970838.png" alt="New unit of deployment options" data-original-src="https://i.octopus.com/blog/201603-new-deployment-options-MZT5.png"/></p>

<p>假设您的团队正在进行为期两周的冲刺，并且每两周交付一个新版本的软件进行测试，然后最终投入生产。现在，您可以选择如何交付新软件:</p>

<ul>
<li>编译您的应用程序并将其压缩(约50mb) -流程级部署(现在)</li>
<li>编译你的应用程序，把它放在一个容器映像中(Docker build-&gt; image)——容器级部署</li>
<li>编译您的应用程序，并生成新的Nano Server VHDX (~800mb) -虚拟机级部署</li>
</ul>

<p>Nano服务器映像的微小尺寸使它们成为您连续交付管道中非常可信的“构建工件”。当您可以使用大致相同的时间和工件大小构建整个虚拟机映像时，为什么要构建MSI或ZIP呢？</p>

<p>对于Octopus来说，这意味着我们需要开始在这个堆栈的每一层进行操作。现在，当您创建一个发布时，您选择NuGet/ZIP包的版本以包含在发布中。在未来，这将意味着:</p>

<ul>
<li>选择构成这个版本的NuGet/ZIP包:Octopus部署到一个现有的运行目标</li>
<li>选择构成这个版本的Docker/container映像:Octopus部署到Docker/container主机</li>
<li>选择构成此次发布的VHDX:Octopus部署到Hyper-V主机</li>
</ul>

<h2>取舍，以及如何选择</h2>

<p>这些变化的最大好处是隔离和安全:微软现在只关注Azure，所以投资能够运行微小的、完全隔离的操作系统映像是非常有意义的。</p>

<p>隔离在企业中也是一种好处。有多少次您需要部署一个新版本的应用程序，或者想要部署一个新版本的应用程序。NET运行时，但被告知不能这样做，因为这可能会破坏系统上的其他应用程序。</p>

<p><img src="../Images/741e2757215731b01e257d934ae69490.png" alt="Isolation tradeoffs with new unit of deployment options" data-original-src="https://i.octopus.com/blog/201603-isolation-tradeoff-RUN5.png"/></p>

<p>另一方面，容器映像和VHDX使得部署时配置有点笨拙。在理想情况下，我们将在测试和生产环境中使用相同的容器映像/VHDX。但是测试和生产可能使用不同的数据库连接字符串。</p>

<ul>
<li>使用流程级部署，就像解压缩后修改配置文件一样简单</li>
<li>使用容器级部署，您可以将一些变量/连接器放入容器中，但是这样不够灵活</li>
<li>借助基于VHDX的部署，您可以为每个环境构建不同的VHDX，或者先启动虚拟机并对其进行配置</li>
</ul>

<p><img src="../Images/05677f4d89a1357a2f30ebc910624e62.png" alt="Composition tradeoffs with new unit of deployment options" data-original-src="https://i.octopus.com/blog/201603-composition-tradeoff-CHW6.png"/></p>

<p>作为另一个例子，也许您的应用程序允许每个部署启用不同的附加包。同样，在部署流程时，在运行时“组合”这些应用程序要比试图在VHDX中组合它们更容易，如果那是部署的单元的话。</p>

<p>无论您如何交付新版本的应用程序——作为zip、Docker图像、VHDXs或可启动USB拇指驱动器——Nano Server都是一个选项。这是一个非常引人注目的问题。</p>

<h2>。网络核心和纳米服务器是未来</h2>

<p>凝视着我的水晶球，我将做出两个大胆的预测:</p>

<ul>
<li>完整的。NET框架现在是遗留的；5年后，大多数绿地C#/。NET应用程序将针对。网络核心</li>
<li>具有GUI和服务器核心的Windows服务器现在是传统的；大多数绿地环境将建立在纳米服务器上</li>
</ul>

<p>请这样想:任何对服务器应用程序真正重要的东西要么被移植到。NET Core，或将在未来几年。如果你的app <em>能</em>瞄准。NET Core，那就应该。没有理由把自己限制在最大限度内。NET Framework，也是将您与完整的。随着这些技术的消亡，NET Framework将会逐渐消失。</p>

<p>如果你的应用针对。NET核心，那么应该可以在Nano服务器上运行。如果你能在微小、快速、小表面积的Nano服务器上运行，为什么要保留GUI服务器或服务器核心的所有开销？</p>

<p>也就是说，我确信Windows Server的“完整版本”将继续存在很长一段时间，主要是针对那些被当作“宠物”而不是“牛”的服务器。例如域控制器、SQL Server主机等。-但这将是一个小的利基市场。对于大部分水平扩展的服务器(应用和网络服务器)，纳米服务器是未来的发展方向。</p>

                    
                    
</body>
</html>