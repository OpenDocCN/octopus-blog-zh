<html>
<head>
<title>Using HashiCorp Vault with Octopus - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>通过Octopus - Octopus部署使用HashiCorp Vault</h1>
<blockquote>原文：<a href="https://octopus.com/blog/using-hashicorp-vault-with-octopus-deploy#2022-11-21">https://octopus.com/blog/using-hashicorp-vault-with-octopus-deploy#2022-11-21</a></blockquote>
                        <p>在Octopus Deploy中存储敏感值解决了许多问题。但是，如果您的组织已经标准化了机密管理器，这可能意味着将敏感值存储两次，从而使机密管理更加复杂。</p>

<p>自<a href="https://octopus.com/blog/new-in-2.0/sensitive-variables"> Octopus 2.0 </a>以来，Octopus一直支持<a href="https://octopus.com/docs/projects/variables/sensitive-variables">敏感变量</a>的概念，但客户经常询问对秘密管理器的支持。一个特别的例子是<a href="https://www.vaultproject.io/" rel="nofollow">哈希公司的金库</a>。</p>

<p>在这篇文章中，我将介绍一些我们介绍过的HashiCorp Vault步骤模板,这些模板旨在从Vault中检索机密，用于您的部署或操作手册。</p>

<p>截至2022年11月，我们HashiCorp Vault的外部秘密存储模板由HashiCorp认证，使Octopus部署了一个<a href="https://www.hashicorp.com/partners/tech/octopus-deploy#all" class="alert-link" rel="nofollow">认证的HashiCorp合作伙伴</a>。</p>


<h2 id="in-this-post">在这篇文章中</h2>



<h2 id="introduction">介绍</h2>

<p>这篇文章假设你知道<a href="https://octopus.com/docs/projects/custom-step-templates">自定义步骤模板</a>和章鱼<a href="https://octopus.com/docs/projects/community-step-templates">社区库</a>。要了解更多，你可以阅读Ryan Rousseau的关于创建自己的step模板并将其发布到库的两部分系列文章。</p>

<p>此外，这篇文章没有详细介绍Vault服务器的概念或如何配置Vault服务器。</p>

<p>本文中介绍的步骤模板为版本1和2的<a href="https://www.vaultproject.io/docs/secrets/kv" rel="nofollow">键值(kv) </a>秘密引擎执行<a href="https://www.vaultproject.io/docs/concepts/auth" rel="nofollow">保险库认证</a>和秘密检索。</p>

<p>所有的步骤模板都利用了Vault <a href="https://www.vaultproject.io/api-docs" rel="nofollow"> HTTP API </a>，因此除了连接到您的Vault服务器之外，没有其他依赖项可以使用它们。它们都已经使用Vault版本<strong> 1.11.3 </strong>进行了测试，包括对<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">名称空间</a>(Vault Enterprise的一项功能)的支持，并且可以在安装了<code>Powershell Core</code>的Windows和Linux上运行。</p>

<h2 id="authentication">证明</h2>

<p>在与Vault交互之前，您必须根据验证方法进行验证。Vault提供了许多不同的身份验证选项。已创建以下步骤模板来支持Vault身份验证:</p>



<p>AppRole方法是使用Vault for servers进行身份验证的推荐方法。</p>


<p>通过Vault验证后，会生成一个<a href="https://www.vaultproject.io/docs/concepts/tokens" rel="nofollow">令牌</a>，可用于与Vault的进一步交互。</p>

<h3 id="ldap-login">LDAP登录步骤</h3>

<p><a href="https://library.octopus.com/step-templates/de807003-3b05-4649-9af3-11a2c7722b3f/actiontemplate-hashicorp-vault-ldap-login" rel="nofollow"> HashiCorp Vault - LDAP登录</a>步骤模板使用<a href="https://www.vaultproject.io/docs/auth/ldap" rel="nofollow"> LDAP </a>认证方法向Vault服务器进行认证。这允许Vault集成，而无需复制用户名或密码配置。</p>

<p>如果您已经有可用的LDAP服务器，您可以选择使用LDAP进行鉴定，并使用服务帐户来控制对敏感信息的访问。</p>



<p>认证后，来自保险库响应的<code>client_token</code>将作为名为<code>LDAPAuthToken</code>的<a href="https://octopus.com/docs/projects/variables/output-variables#sensitive-output-variables">敏感输出变量</a>在其他步骤中使用。</p>

<h4 id="ldap-login-parameters">LDAP登录参数</h4>

<p>步骤模板具有以下参数:</p>

<ul>
<li><code>Vault Server URL</code>:您正在连接的Vault实例的URL，包括端口(默认为<code>8200</code>)。</li>
<li><code>API version</code>:从下拉列表中选择要使用的API版本。目前只有一个选项:<code>v1</code>。</li>
<li><code>Namespace</code> : <em>可选</em>要使用的<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">命名空间</a>。可以提供嵌套的名称空间，例如<code>ns1/ns2</code>。<strong>注意:</strong>名称空间仅在<a href="https://www.hashicorp.com/products/vault" rel="nofollow"> Vault Enterprise </a>上受支持。</li>
<li><code>LDAP Auth Login path</code>:LDAP方法<a href="https://www.vaultproject.io/api-docs/auth/ldap" rel="nofollow">挂载到</a>的路径。默认是<code>/auth/ldap</code>。</li>
<li><code>Username</code>:LDAP用户名。</li>
<li><code>Password</code>:LDAP密码。</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-ldap-login-step-parameters.png" class="zoom" data-title=""> T31 </a></p>

<h4 id="ldap-login-use">使用LDAP登录步骤</h4>

<p><strong> LDAP登录</strong>步骤以与其他步骤相同的方式添加到<a href="https://octopus.com/docs/projects/steps#adding-steps-to-your-deployment-processes">中的部署和runbook流程中。</a></p>

<p>将步骤添加到流程后，填写步骤中的参数:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-ldap-login-step-in-process.png" class="zoom" data-title=""><img src="../Images/e73c87831cbd8e545a7a7223ab2a6888.png" class="img-fluid center" alt="Vault LDAP login step used in a process" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-ldap-login-step-in-process.png"/>T2】</a></p>

<p>然后，您可以在操作手册或部署流程中执行该步骤。成功执行后，包含该令牌的敏感输出变量名将显示在任务日志中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-ldap-login-step-output-variable.png" class="zoom" data-title=""><img src="../Images/b3aa05392d8de32c13160cfec6ba5c27.png" class="img-fluid center" alt="Vault LDAP login step task log" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-ldap-login-step-output-variable.png"/>T2】</a></p>

<p>在后续步骤中，输出变量<code>#{Octopus.Action[HashiCorp Vault - LDAP Login].Output.LDAPAuthToken}</code>可用于认证和检索秘密。</p>

<p><strong>提示:</strong>对于任何输出变量名，记得用您的步骤名替换<code>HashiCorp Vault - LDAP Login</code>。</p>


<h3 id="jwt-login">JWT登录步骤</h3>

<p><a href="https://library.octopus.com/step-templates/d49bc861-cd36-4624-960c-77613a54b139/actiontemplate-hashicorp-vault-jwt-login" rel="nofollow">哈希公司Vault - JWT登录</a>步骤模板使用<a href="https://www.vaultproject.io/docs/auth/ldap" rel="nofollow"> JWT </a>认证方法向Vault服务器进行认证。这允许使用一个<a href="https://en.wikipedia.org/wiki/JSON_Web_Token" rel="nofollow"> JSON Web令牌</a>进行保险库集成。</p>

<p>如果您的组织中已经使用了JWT身份验证方法，您可以选择使用该方法进行身份验证。当通过HTTP发出请求时，这是一个很好的选择，因为它是一个自包含的令牌，可以在任何地方生成。</p>

<p><strong>生成JWT </strong> <br/> Octopus有两个现有的步骤模板来生成一个用私钥签名的JWT，但它们不在本文讨论范围之内。有关更多信息，请参见步骤模板描述:</p>



<p>认证后，来自保险库响应的<code>client_token</code>作为一个名为<code>JWTAuthToken</code>的<a href="https://octopus.com/docs/projects/variables/output-variables#sensitive-output-variables">敏感输出变量</a>可用于其他步骤。</p>

<h4 id="jwt-login-parameters">JWT登录参数</h4>

<p>步骤模板具有以下参数:</p>

<ul>
<li><code>Vault Server URL</code>:您正在连接的Vault实例的URL，包括端口(默认为<code>8200</code>)。</li>
<li><code>API version</code>:从下拉列表中选择要使用的API版本。目前只有一个选项:<code>v1</code>。</li>
<li><code>Namespace</code> : <em>可选</em>要使用的<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">命名空间</a>。可以提供嵌套的名称空间，例如<code>ns1/ns2</code>。<strong>注意:</strong>名称空间仅在<a href="https://www.hashicorp.com/products/vault" rel="nofollow"> Vault Enterprise </a>上受支持。</li>
<li><code>JWT Auth Login path</code>:在安装<a href="https://www.vaultproject.io/api-docs/auth/jwt" rel="nofollow"> JWT方法的路径。默认为<code>/auth/jwt</code>。</a></li>
<li><code>JWT role</code>:跳马<a href="https://www.vaultproject.io/api-docs/auth/jwt#create-role" rel="nofollow"> JWT角色</a>。</li>
<li><code>JWT Token</code>:已签名的<a href="https://tools.ietf.org/html/rfc7519" rel="nofollow"> JSON Web令牌</a> (JWT)用于登录。</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-jwt-login-step-parameters.png" class="zoom" data-title=""><img src="../Images/e4e6a0a51cf9a6ad1d88dacad3c1ef28.png" class="img-fluid center" alt="Parameters for the Vault JWT login step" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-jwt-login-step-parameters.png"/>T2】</a></p>

<h4 id="jwt-login-use">使用JWT登录步骤</h4>

<p>以与其他步骤相同的方式将<strong> JWT登录</strong>步骤添加到<a href="https://octopus.com/docs/projects/steps#adding-steps-to-your-deployment-processes">部署和运行手册流程中。</a></p>

<p>将步骤添加到流程后，填写步骤中的参数:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-jwt-login-step-in-process.png" class="zoom" data-title=""><img src="../Images/10b4ff1c20577253f1c81e4ed46c4a7e.png" class="img-fluid center" alt="Vault JWT login step used in a process" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-jwt-login-step-in-process.png"/>T2】</a></p>

<p>然后，您可以在操作手册或部署流程中执行该步骤。成功执行后，包含该令牌的敏感输出变量名将显示在任务日志中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-jwt-login-step-output-variable.png" class="zoom" data-title=""><img src="../Images/7adfb5a5506a9ab3f393c25c32a759de.png" class="img-fluid center" alt="Vault JWT login step task log" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-jwt-login-step-output-variable.png"/>【T34】T2】</a></p>

<p>在后续步骤中，输出变量<code>#{Octopus.Action[HashiCorp Vault - JWT Login].Output.JWTAuthToken}</code>可用于认证和检索秘密。</p>

<p><strong>提示:</strong>对于任何输出变量名，记得用您的步骤名替换<code>HashiCorp Vault - JWT Login</code>。</p>


<h3 id="approle-login">适当的登录步骤</h3>

<p><a href="https://library.octopus.com/step-templates/e04a9cec-f04a-4da2-849b-1aed0fd408f0/actiontemplate-hashicorp-vault-approle-login" rel="nofollow"> HashiCorp Vault - AppRole登录</a>步骤模板使用<a href="https://www.vaultproject.io/docs/auth/approle" rel="nofollow"> AppRole </a>认证方法向Vault服务器进行认证。这非常适合与章鱼一起使用。HashiCorp建议将其用于机器或应用程序:</p>

<blockquote class="blockquote">
<p>这种身份验证方法面向自动化工作流(机器和服务)，对人工操作员用处不大。</p>
</blockquote>

<p>使用AppRole，机器可以使用以下方式登录:</p>

<ul>
<li><code>RoleID</code>，将此视为认证对中的用户名。</li>
<li><code>SecretID</code>，把这个当做认证对中的密码。</li>
</ul>

<p><strong>不要存储SecretID: </strong> <br/>将RoleID作为敏感变量存储在Octopus中是一种很好的方法，可以确保它在需要之前保持加密状态。</p>
<p>然而，同样是<strong>不推荐</strong>给SecretID。</p>
<p>秘密就像密码一样，是为过期而设计的。存储SecretID还可以提供检索所有秘密的能力，因为RoleID和SecretID都是可用的。</p>
<p>我们建议您使用更安全的<a href="#get-wrapped-secretid" class="alert-link"> Get wrapped SecretID </a>和<a href="#unwrap-secretid-login" class="alert-link">unwrapped SecretID和Login </a>步骤模板，因为它们使用了<a href="#approle-best-practices" class="alert-link">最佳实践</a>、<strong>响应包装</strong>之一。</p>
<p>如果您使用适当的登录步骤模板，我们建议您在执行时使用敏感的<a href="https://octopus.com/docs/projects/variables/prompted-variables" class="alert-link">提示变量</a>提供SecretID。</p>


<p>经过认证后，来自保险库响应的<code>client_token</code>将作为一个名为<code>AppRoleAuthToken</code>的<a href="https://octopus.com/docs/projects/variables/output-variables#sensitive-output-variables">敏感输出变量</a>在其他步骤中使用。</p>

<h4 id="approle-login-parameters">合适的登录参数</h4>

<p>步骤模板具有以下参数:</p>

<ul>
<li><code>Vault Server URL</code>:您正在连接的Vault实例的URL，包括端口(默认为<code>8200</code>)。</li>
<li><code>API version</code>:从下拉列表中选择要使用的API版本。目前只有一个选项:<code>v1</code>。</li>
<li><code>Namespace</code> : <em>可选</em>要使用的<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">命名空间</a>。可以提供嵌套的名称空间，例如<code>ns1/ns2</code>。<strong>注意:</strong>名称空间仅在<a href="https://www.hashicorp.com/products/vault" rel="nofollow"> Vault Enterprise </a>上受支持。</li>
<li><code>App Role Path</code>:安装<a href="https://www.vaultproject.io/api-docs/auth/approle" rel="nofollow"> approle auth方法的路径</a>。</li>
<li><code>Role ID</code>:批准的<a href="https://www.vaultproject.io/docs/auth/approle#roleid" rel="nofollow">角色</a>。</li>
<li><code>Secret ID</code>:批准的<a href="https://www.vaultproject.io/docs/auth/approle#secretid" rel="nofollow">secret</a>。</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-approle-login-step-parameters.png" class="zoom" data-title=""><img src="../Images/b51bdbc516db42949080b2ecbf935281.png" class="img-fluid center" alt="Parameters for the Vault AppRole login step" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-approle-login-step-parameters.png"/>T2】</a></p>

<h4 id="approle-login-use">使用适当的登录步骤</h4>

<p><strong>批准登录</strong>步骤以与其他步骤相同的方式添加到<a href="https://octopus.com/docs/projects/steps#adding-steps-to-your-deployment-processes">部署和运行手册流程中。</a></p>

<p>将步骤添加到流程后，填写步骤中的参数:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-approle-login-step-in-process.png" class="zoom" data-title=""><img src="../Images/c0f0fe3787711c8752b7cea9ff14ba9d.png" class="img-fluid center" alt="Vault AppRole login step used in a process" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-approle-login-step-in-process.png"/>T2】</a></p>

<p>然后，您可以在操作手册或部署流程中执行该步骤。成功执行后，包含该令牌的敏感输出变量名将显示在任务日志中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-approle-login-step-output-variable.png" class="zoom" data-title=""><img src="../Images/cbda8cd5b11dbb069d23d066782a0e6a.png" class="img-fluid center" alt="Vault AppRole login step task log" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-approle-login-step-output-variable.png"/>T2】</a></p>

<p>在后续步骤中，输出变量<code>#{Octopus.Action[HashiCorp Vault - AppRole Login].Output.AppRoleAuthToken}</code>可用于认证和检索秘密。</p>

<p><strong>提示:</strong>对于任何输出变量名，记得用您的步骤名替换<code>HashiCorp Vault - AppRole Login</code>。</p>


<h3 id="approle-best-practices">合适的最佳实践</h3>

<p><a href="https://www.vaultproject.io/docs/auth/approle" rel="nofollow"> AppRole </a>认证方法被认为是<em>可信代理</em>方法。这意味着信任的责任在于作为客户机(通常是Octopus部署目标)和Vault之间的认证中介的系统(即<em>代理</em>)。</p>

<p>一个重要的最佳实践是避免存储合适的机密。相反，使用<a href="https://www.vaultproject.io/docs/concepts/response-wrapping" rel="nofollow">响应包装</a>来提供一个<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-tokens" rel="nofollow">包装令牌</a>，它将提供一个访问机制来在需要时检索SecretID。这种获取SecretID的方法也称为<a href="https://www.vaultproject.io/docs/auth/approle#pull-and-push-secretid-modes" rel="nofollow">拉模式</a>,因为它需要从AppRole中获取SecretID或<em>拉取</em>。</p>

<p>保险库文件包含使用适当认证时的<a href="https://learn.hashicorp.com/tutorials/vault/pattern-approle?in=vault/recommended-patterns" rel="nofollow">推荐模式</a>。</p>

<p>以下是这些建议的摘要:</p>

<ul>
<li>使用安全的系统作为代理来检索包装的SecretID。</li>
<li>使用<a href="https://www.vaultproject.io/docs/concepts/response-wrapping" rel="nofollow">响应包装</a>获得SecretID。</li>
<li>限制SecretID的使用次数和生存时间(TTL)值，以防止过度使用。</li>
<li>避免<a href="https://learn.hashicorp.com/tutorials/vault/pattern-approle?in=vault/recommended-patterns#anti-patterns" rel="nofollow">反模式</a>，比如让代理检索秘密。</li>
</ul>

<p><strong>保护代理:</strong> <br/>由于信任依赖于代理，我们建议使用Octopus服务器的<a href="https://octopus.com/docs/infrastructure/workers#built-in-worker" class="alert-link">内置工作器</a>，或者高度安全的<a href="https://octopus.com/docs/infrastructure/workers#external-workers" class="alert-link">外部工作器</a>来充当代理。它将负责检索包装好的SecretID，并将该值传递给通过Vault进行身份验证的机器(客户端)。</p>


<p>为了支持这些推荐的实践，创建了三个额外的<code>AppRole</code>步骤模板:</p>



<h3 id="get-wrapped-secretid">接近包装的秘密步骤</h3>

<p><a href="https://library.octopus.com/step-templates/76827264-af27-46d0-913a-e093a4f0db48/actiontemplate-hashicorp-vault-approle-get-wrapped-secret-id" rel="nofollow">hashi corp Vault-AppRole Get Wrapped Secret ID</a>步骤模板为<a href="https://www.vaultproject.io/docs/auth/approle" rel="nofollow"> AppRole </a>认证方法生成一个<a href="https://www.vaultproject.io/docs/concepts/response-wrapping" rel="nofollow">响应包装的</a> SecretID。</p>

<p>step模板使用令牌通过Vault服务器进行身份验证，以检索包装的SecretID。响应包含一个<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-tokens" rel="nofollow">包装令牌</a>和其他元数据，比如令牌的创建路径。</p>

<p>该值可用于验证<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-token-validation" rel="nofollow">未发生不当行为</a>。包装令牌随后可用于检索实际的SecretID值。</p>

<p>用于进行身份验证以检索包装的SecretID的令牌应该具有有限的范围，并且应该只允许检索包装的SecretID。考虑创建一个长期存储令牌，因为这只会带来较小的风险。</p>


<p>从Vault服务器收到响应后，创建2个<a href="https://octopus.com/docs/projects/variables/output-variables#sensitive-output-variables">敏感输出变量</a>用于其他步骤:</p>

<ul>
<li><code>WrappedToken</code>这是从响应中包装的<code>token</code>，用于检索实际的SecretID值。</li>
<li><code>WrappedTokenCreationPath</code>这是令牌的创建路径。它允许您验证<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-token-validation" rel="nofollow">没有发生不当行为</a>。</li>
</ul>

<h4 id="get-wrapped-secretid-parameters">AppRole Get Wrapped SecretID参数</h4>

<p>步骤模板使用以下参数:</p>

<ul>
<li><code>Vault Server URL</code>:您正在连接的Vault实例的URL，包括端口(默认为<code>8200</code>)。</li>
<li><code>API version</code>:从下拉列表中选择API版本。目前只有一个选项:<code>v1</code>。</li>
<li><code>Namespace</code> : <em>可选</em>要使用的<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">命名空间</a>。可以提供嵌套的名称空间，例如<code>ns1/ns2</code>。<strong>注意:</strong>名称空间仅在<a href="https://www.hashicorp.com/products/vault" rel="nofollow"> Vault Enterprise </a>上受支持。</li>
<li><code>App Role Path</code>:安装<a href="https://www.vaultproject.io/api-docs/auth/approle" rel="nofollow"> AppRole auth方法的路径</a>。</li>
<li><code>Role Name</code>:审批<a href="https://www.vaultproject.io/api/auth/approle" rel="nofollow">的角色名称</a>。</li>
<li><code>Time-to-live (TTL)</code>:以秒为单位的<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-tokens" rel="nofollow">响应包装令牌</a>本身的TTL。默认为:<code>120s</code></li>
<li><code>Auth Token</code>:用于向Vault认证的<a href="https://www.vaultproject.io/docs/auth/token" rel="nofollow">令牌</a>，生成<a href="https://www.vaultproject.io/docs/concepts/response-wrapping" rel="nofollow">响应包装的</a> SecretID。</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-get-wrapped-secretid-step-parameters.png" class="zoom" data-title=""><img src="../Images/7aeaab9aa9b8d170677ffb01fc7f0408.png" class="img-fluid center" alt="Parameters for the Vault Get Wrapped SecretID step" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-get-wrapped-secretid-step-parameters.png"/>T2】</a></p>

<h4 id="get-wrapped-secretid-use">使用适当的获取包装机密步骤</h4>

<p>以与其他步骤相同的方式将<strong> Get Wrapped SecretID </strong>步骤添加到部署和runbook流程中。</p>

<p>将步骤添加到流程后，填写步骤中的参数:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-get-wrapped-secretid-step-in-process.png" class="zoom" data-title=""><img src="../Images/56f07f711ac1ee8db0c06f201dd44e9b.png" class="img-fluid center" alt="Vault Get Wrapped SecretID step used in a process" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-get-wrapped-secretid-step-in-process.png"/>T2】</a></p>

<p>然后，您可以在操作手册或部署流程中执行该步骤。成功执行后，敏感的输出变量名会显示在任务日志中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-get-wrapped-secretid-step-output-variable.png" class="zoom" data-title=""><img src="../Images/a1b34cea70a9402cfda8f35ab3d1867a.png" class="img-fluid center" alt="Vault Get Wrapped SecretID step task log" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-get-wrapped-secretid-step-output-variable.png"/>T2】</a></p>

<p>在后续步骤中，输出变量可用于验证和检索实际的SecretID值:</p>

<ul>
<li><code>#{Octopus.Action[HashiCorp Vault - AppRole Get Wrapped Secret ID].Output.WrappedToken}</code></li>
<li><code>#{Octopus.Action[HashiCorp Vault - AppRole Get Wrapped Secret ID].Output.WrappedTokenCreationPath}</code></li>
</ul>

<p><strong>提示:</strong>对于任何输出变量名，记得用您的步骤名替换<code>HashiCorp Vault - AppRole Get Wrapped Secret ID</code>。</p>


<h3 id="unwrap-secretid">近似展开秘密步骤</h3>

<p><a href="https://library.octopus.com/step-templates/c1f56030-0bcd-458d-bc70-b4f43ec0d30f/actiontemplate-hashicorp-vault-approle-unwrap-secret-id" rel="nofollow">hashi corp Vault-AppRole Unwrap Secret ID</a>步骤模板使用<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-tokens" rel="nofollow">包装令牌</a>检索并解开<a href="https://www.vaultproject.io/docs/auth/approle" rel="nofollow"> AppRole </a>的Secret ID。</p>

<p>来自保险库响应的<code>secret_id</code>将作为名为<code>UnwrappedSecretID</code>的<a href="https://octopus.com/docs/projects/variables/output-variables#sensitive-output-variables">敏感输出变量</a>用于其他步骤。</p>

<h4 id="unwrap-secretid-parameters">适当的展开保密参数</h4>

<p>步骤模板使用以下参数:</p>

<ul>
<li><code>Vault Server URL</code>:您正在连接的Vault实例的URL，包括端口(默认为<code>8200</code>)。</li>
<li><code>API version</code>:从下拉列表中选择要使用的API版本。目前只有一个选项:<code>v1</code>。</li>
<li><code>Namespace</code> : <em>可选</em>要使用的<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">命名空间</a>。可以提供嵌套的名称空间，例如<code>ns1/ns2</code>。<strong>注意:</strong>名称空间仅在<a href="https://www.hashicorp.com/products/vault" rel="nofollow"> Vault Enterprise </a>上受支持。</li>
<li><code>Wrapped Token</code>:包装令牌，用于从金库中检索实际的秘密ID。</li>
<li><code>Token Creation Path</code> : <em>可选</em>包装令牌的创建路径。如果提供了该值，步骤模板将执行<a href="https://www.vaultproject.io/api-docs/system/wrapping-lookup" rel="nofollow">回绕查找</a>以<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-token-validation" rel="nofollow">验证没有发生不当行为</a>。</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-step-parameters.png" class="zoom" data-title=""><img src="../Images/9cf5291d8824bbf99077d762be13c5af.png" class="img-fluid center" alt="Parameters for the Vault Unwrap SecretID step" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-step-parameters.png"/>T2】</a></p>

<h4 id="unwrap-secretid-use">使用展开秘密步骤</h4>

<p>与其他步骤一样，在<a href="https://octopus.com/docs/projects/steps#adding-steps-to-your-deployment-processes">中将<strong>展开SecretID </strong>步骤添加到部署和runbook流程中。</a></p>

<p>将步骤添加到流程后，填写步骤中的参数:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-step-in-process.png" class="zoom" data-title=""><img src="../Images/5e4a227a92e681150a97d7a5d30e5e6c.png" class="img-fluid center" alt="Vault Unwrap SecretID step used in a process" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-step-in-process.png"/>【T37】T2】</a></p>



<p>然后，您可以在操作手册或部署流程中执行该步骤。成功执行后，敏感的输出变量名会显示在任务日志中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-step-output-variable.png" class="zoom" data-title=""><img src="../Images/381d5f3236e7dfd35ac2a623c5ac5050.png" class="img-fluid center" alt="Vault Unwrap SecretID step task log" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-step-output-variable.png"/>T2】</a></p>

<p>在后续步骤中，输出变量<code>#{Octopus.Action[HashiCorp Vault - AppRole Unwrap Secret ID].Output.UnwrappedSecretID}</code>可用于向Vault进行身份验证，并接收一个令牌，该令牌可用于检索机密。</p>

<p><strong>提示:</strong>对于任何输出变量名，记得用您的步骤名替换<code>HashiCorp Vault - AppRole Unwrap Secret ID</code>。</p>


<h3 id="unwrap-secretid-login">适当的解密和登录步骤</h3>

<p><a href="https://library.octopus.com/step-templates/aa113393-e615-40ed-9c5a-f95f471d728f/actiontemplate-hashicorp-vault-approle-unwrap-secret-id-and-login" rel="nofollow">hashi corp Vault-AppRole Unwrap Secret ID and log in</a>步骤模板是将Vault使用的两个步骤模板合并为一个的便捷方法:</p>



<p>它是Vault两步工作流程的第二部分:</p>

<ol>
<li>使用<a href="#get-wrapped-secretid">AppRole Get wrapped SecretID</a>步骤模板获取包装的SecretID。</li>
<li>提供从第一步到此步骤模板的敏感输出变量中存储的包装的SecretID，以进行解包装和身份验证。</li>
</ol>

<p>经过认证后，来自保险库响应的<code>client_token</code>就可以作为一个名为<code>AppRoleAuthToken</code>的<a href="https://octopus.com/docs/projects/variables/output-variables#sensitive-output-variables">敏感输出变量</a>用于其他步骤。</p>

<h4 id="unwrap-secretid-login-parameters">AppRole展开SecretID和登录参数</h4>

<p>步骤模板使用以下参数:</p>

<ul>
<li><code>Vault Server URL</code>:您正在连接的Vault实例的URL，包括端口(默认为<code>8200</code>)。</li>
<li><code>API version</code>:从下拉列表中选择要使用的API版本。目前只有一个选项:<code>v1</code>。</li>
<li><code>Namespace</code> : <em>可选</em>要使用的<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">命名空间</a>。可以提供嵌套的名称空间，例如<code>ns1/ns2</code>。<strong>注意:</strong>名称空间仅在<a href="https://www.hashicorp.com/products/vault" rel="nofollow"> Vault Enterprise </a>上受支持。</li>
<li><code>App Role Path</code>:安装<a href="https://www.vaultproject.io/api-docs/auth/approle" rel="nofollow"> AppRole auth方法的路径</a>。</li>
<li><code>Role ID</code>:批准的<a href="https://www.vaultproject.io/docs/auth/approle#roleid" rel="nofollow">角色ID </a>。</li>
<li><code>Wrapped Token</code>:用于从金库中检索实际秘密ID的<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-tokens" rel="nofollow">包装令牌</a>。</li>
<li><code>Token Creation Path</code> : <em>可选</em>包装令牌的创建路径。如果提供了该值，步骤模板将执行<a href="https://www.vaultproject.io/api-docs/system/wrapping-lookup" rel="nofollow">回绕查找</a>以<a href="https://www.vaultproject.io/docs/concepts/response-wrapping#response-wrapping-token-validation" rel="nofollow">验证没有发生不当行为</a>。</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-login-step-parameters.png" class="zoom" data-title=""><img src="../Images/829743da58b9863287beffd9460d0d6c.png" class="img-fluid center" alt="Parameters for the Vault Unwrap SecretID and Login step" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-login-step-parameters.png"/>T2】</a></p>

<h4 id="unwrap-secretid-login-use">使用展开SecretID和登录步骤</h4>

<p><strong>解开SecretID并登录</strong>步骤以与其他步骤相同的方式添加到<a href="https://octopus.com/docs/projects/steps#adding-steps-to-your-deployment-processes">部署和runbook流程中。</a></p>

<p>将步骤添加到流程后，填写步骤中的参数:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-login-step-in-process.png" class="zoom" data-title=""><img src="../Images/14fab04f6ee4ae210eb2bb64233dace5.png" class="img-fluid center" alt="Vault Unwrap SecretID and Login step used in a process" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-login-step-in-process.png"/>T2】</a></p>



<p>然后，您可以在操作手册或部署流程中执行该步骤。成功执行后，敏感的输出变量名会显示在任务日志中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-login-step-output-variable.png" class="zoom" data-title=""><img src="../Images/035bf696f441d571529a37554d330600.png" class="img-fluid center" alt="Vault Unwrap SecretID and Login step task log" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-unwrap-secretid-login-step-output-variable.png"/>T2】</a></p>

<p>在后续步骤中，输出变量<code>#{Octopus.Action[HashiCorp Vault - AppRole Unwrap Secret ID and Login].Output.AppRoleAuthToken}</code>可用于认证和检索秘密。</p>

<p><strong>提示:</strong>对于任何输出变量名，记得用您的步骤名替换<code>HashiCorp Vault - AppRole Unwrap Secret ID and Login</code>。</p>


<h2 id="retrieving-secrets">找回秘密</h2>

<p>使用Vault进行身份验证后，您会收到一个可用于检索机密的身份验证令牌。Vault中的机密存储在一个<a href="https://www.vaultproject.io/docs/secrets" rel="nofollow">机密引擎</a>中，该引擎有许多不同的类型。</p>

<p>为支持检索机密而创建的步骤模板关注于<a href="https://www.vaultproject.io/docs/secrets/kv" rel="nofollow">键值(kv) </a>机密引擎，因为它是一个通用的键值存储，用于存储任意机密:</p>



<h3 id="retrieve-kv-v1-secrets">检索KV (v1)机密步骤</h3>

<p><a href="https://library.octopus.com/step-templates/9aab9522-25e0-4539-841c-8b726e6b1520/actiontemplate-hashicorp-vault-key-value-(v1)-retrieve-secrets" rel="nofollow"> HashiCorp保险库密钥值(v1)检索机密</a>步骤模板检索存储在<code>v1</code>密钥值机密引擎中的一个或多个机密。</p>

<p>检索一个秘密需要:</p>

<ul>
<li>通往秘密的道路。</li>
<li>有权限访问机密的身份验证令牌。</li>
<li><em>可选的</em>，要检索的字段名列表。</li>
</ul>

<p>step模板的一个高级特性支持一次检索多个机密。这需要将<strong>机密检索方法</strong>参数更改为<code>Multiple vault keys</code>。</p>

<p>递归检索秘密也是可能的。当您想要检索给定路径的所有秘密时，这很有用。</p>

<p>对于检索到的每个秘密，创建一个<a href="https://octopus.com/docs/projects/variables/output-variables#sensitive-output-variables">敏感输出变量</a>用于后续步骤。默认情况下，任务日志中只会显示已创建变量的数量。要查看任务日志中的变量名，将<strong>打印输出变量名</strong>参数更改为<code>True</code>。</p>

<h4 id="retrieve-kv-v1-secrets-parameters">检索KV (v1)秘密参数</h4>

<p>步骤模板使用以下参数:</p>

<ul>
<li><code>Vault Server URL</code>:您正在连接的Vault实例的URL，包括端口(默认为<code>8200</code>)。</li>
<li><code>API version</code>:从下拉列表中选择要使用的API版本。目前只有一个选项:<code>v1</code>。</li>
<li><code>Namespace</code> : <em>可选</em>要使用的<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">命名空间</a>。可以提供嵌套的名称空间，例如<code>ns1/ns2</code>。<strong>注意:</strong>名称空间仅在<a href="https://www.hashicorp.com/products/vault" rel="nofollow"> Vault Enterprise </a>上受支持。</li>
<li><code>Auth Token</code>:用于认证检索秘密的<a href="https://www.vaultproject.io/docs/auth/token" rel="nofollow">令牌</a>。</li>
<li><code>Secrets Path</code>:您要检索的机密的完整路径。该值应该包括安装机密引擎的路径以及机密本身的路径。</li>
<li><code>Secrets retrieval method</code>:选择检索单个秘密或多个秘密。检索单个秘密相当于使用<a href="https://www.vaultproject.io/api-docs/secret/kv/kv-v1#read-secret" rel="nofollow"> Get </a>方法的<code>vault kv get</code>命令。检索多个秘密相当于组合使用<a href="https://www.vaultproject.io/api-docs/secret/kv/kv-v2#list-secrets" rel="nofollow">列表</a>方法的<code>vault kv list</code>命令和针对每个秘密的后续<code>vault kv get</code>命令。</li>
<li><code>Recursive retrieval</code>:如果正在检索多个秘密，是否也应该枚举和检索任何子文件夹？默认为:<code>False</code>。</li>
<li><code>Field names</code>:从已识别的机密中选择要检索的特定字段。当您只想从一个或多个机密中检索特定字段时，这很有用。您可以选择包含输出变量的名称。</li>
<li><code>Print output variable names</code>:将Octopus输出变量名写入任务日志。默认为:<code>False</code>。</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v1-secrets-step-parameters.png" class="zoom" data-title=""><img src="../Images/367ece244261b8e848f673244ff7f754.png" class="img-fluid center" alt="Parameters for the retrieve KV v1 secrets step" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v1-secrets-step-parameters.png"/>T2】</a></p>

<h4 id="retrieve-kv-v1-secrets-use">使用检索KV (v1)机密步骤</h4>

<p>以与其他步骤相同的方式将<strong>键值(v1)检索机密</strong>步骤添加到<a href="https://octopus.com/docs/projects/steps#adding-steps-to-your-deployment-processes">部署和runbook流程中。</a></p>

<p>将步骤添加到流程后，填写步骤中的参数:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v1-secrets-step-in-process.png" class="zoom" data-title=""><img src="../Images/e58472f2d6b5d26e07e18996144ec79e.png" class="img-fluid center" alt="Vault retrieve KV v1 secrets step used in a process" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v1-secrets-step-in-process.png"/>T2】</a></p>



<p>填写参数后，您可以在操作手册或部署流程中执行该步骤。在成功执行时，任何匹配的机密都被存储为敏感的输出变量。如果将步骤配置为打印变量名，它们会出现在任务日志中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v1-secrets-step-output-variable.png" class="zoom" data-title=""><img src="../Images/c6d8d4270af79aa4606332e33e35a086.png" class="img-fluid center" alt="Vault retrieve KV v1 secrets step task log" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v1-secrets-step-output-variable.png"/>T2】</a></p>

<p>在后续步骤中，从匹配密码创建的输出变量可以在您的部署或runbook中使用。</p>

<p><strong>提示:</strong>对于任何输出变量名，记得用您的步骤名替换<code>HashiCorp Vault - Key Value (v1) retrieve secrets</code>。</p>


<h3 id="retrieve-kv-v2-secrets">检索KV (v2)机密步骤</h3>

<p><a href="https://library.octopus.com/step-templates/337f1b67-cdb0-4f33-9e08-6bf804f672d2/actiontemplate-hashicorp-vault-key-value-(v2)-retrieve-secrets" rel="nofollow">hashi corp Vault-Key Value(v2)retrieve secrets</a>步骤模板检索存储在<code>v2</code> Key-Value secrets引擎中的一个或多个机密。</p>

<p><code>v2</code>键值机密引擎的关键优势之一是它支持<a href="https://learn.hashicorp.com/tutorials/vault/versioned-kv" rel="nofollow">版本化机密</a>。如果您需要在意外丢失数据的情况下回滚机密，这将非常有用。</p>

<p>检索一个秘密需要:</p>

<ul>
<li>通往秘密的道路</li>
<li>具有访问机密的权限的身份验证令牌</li>
<li><em>可选的</em>，要检索的字段名列表</li>
</ul>

<p>此步骤模板提供了高级功能:</p>

<ol>
<li>支持一次检索多个秘密。这需要将<strong>机密检索方法</strong>参数改为<code>Multiple vault keys</code>。递归检索秘密也是可能的。这对于检索给定路径的所有秘密非常有用。</li>
<li>支持检索特定版本的秘密。这仅在检索单个机密时受支持。</li>
</ol>

<p>对于检索到的每个秘密，创建一个<a href="https://octopus.com/docs/projects/variables/output-variables#sensitive-output-variables">敏感输出变量</a>用于后续步骤。默认情况下，任务日志中只会显示已创建变量的数量。要查看任务日志中的变量名，将<strong>打印输出变量名</strong>参数更改为<code>True</code>。</p>

<h4 id="retrieve-kv-v2-secrets-parameters">检索KV (v2)秘密参数</h4>

<p>步骤模板使用以下参数:</p>

<ul>
<li><code>Vault Server URL</code>:您正在连接的Vault实例的URL，包括端口(默认为<code>8200</code>)。</li>
<li><code>API version</code>:从下拉列表中选择要使用的API版本。目前只有一个选择:<code>v1</code>。</li>
<li><code>Namespace</code> : <em>可选</em>要使用的<a href="https://www.vaultproject.io/docs/enterprise/namespaces" rel="nofollow">名称空间</a>。可以提供嵌套的名称空间，例如<code>ns1/ns2</code>。<strong>注意:</strong>名称空间仅在<a href="https://www.hashicorp.com/products/vault" rel="nofollow"> Vault Enterprise </a>上受支持。</li>
<li><code>Auth Token</code>:用于认证取回机密的<a href="https://www.vaultproject.io/docs/auth/token" rel="nofollow">令牌</a>。</li>
<li><code>Secrets Path</code>:您想要检索的机密的完整路径。该值应该包括安装机密引擎的路径以及机密本身的路径。</li>
<li><code>Secrets retrieval method</code>:选择检索单个秘密或多个秘密。检索一个秘密相当于使用<a href="https://www.vaultproject.io/api-docs/secret/kv/kv-v1#read-secret" rel="nofollow"> Get </a>方法的<code>vault kv get</code>命令。检索多个秘密相当于使用<a href="https://www.vaultproject.io/api-docs/secret/kv/kv-v2#list-secrets" rel="nofollow"> List </a>方法的<code>vault kv list</code>命令和随后针对每个秘密的<code>vault kv get</code>命令的组合。</li>
<li><code>Recursive retrieval</code>:如果正在检索多个机密，是否也应该枚举和检索任何子文件夹？默认为:<code>False</code>。</li>
<li><code>Secret Version</code> : <em>可选</em>检索单个秘密时，选择要检索的秘密版本。例如，如果您希望所有字段值的版本2处于保密状态，请输入值<code>2</code>。</li>
<li><code>Field names</code>:选择要从已识别的机密中检索的特定字段。当您只想从一个或多个机密中检索特定字段时，这很有用。您可以选择包含输出变量的名称。</li>
<li><code>Print output variable names</code>:将Octopus输出变量名写入任务日志。默认为:<code>False</code>。</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v2-secrets-step-parameters.png" class="zoom" data-title=""> T32 </a></p>

<h4 id="retrieve-kv-v2-secrets-use">使用检索KV (v2)机密步骤</h4>

<p><strong>键值(v2)检索机密</strong>步骤以与其他步骤相同的方式添加到<a href="https://octopus.com/docs/projects/steps#adding-steps-to-your-deployment-processes">中的部署和runbook流程中。</a></p>

<p>将步骤添加到流程后，填写步骤中的参数:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v2-secrets-step-in-process.png" class="zoom" data-title=""><img src="../Images/296023fc95c1e1d8345bd981b394c013.png" class="img-fluid center" alt="Vault retrieve KV v2 secrets step used in a process" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v2-secrets-step-in-process.png"/>T2】</a></p>



<p>填写参数后，您可以在操作手册或部署流程中执行该步骤。在成功执行时，任何匹配的机密都被存储为敏感的输出变量。如果将步骤配置为打印变量名，它们会出现在任务日志中:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v2-secrets-step-output-variable.png" class="zoom" data-title=""><img src="../Images/7ad76f4c8f443a21704e4b59629879d5.png" class="img-fluid center" alt="Vault retrieve KV v2 secrets step task log" data-original-src="https://i.octopus.com/blog/2022-11/using-hashicorp-vault-with-octopus-deploy/vault-retrieve-kv-v2-secrets-step-output-variable.png"/>T2】</a></p>

<p>在后续步骤中，从匹配密码创建的输出变量可以在您的部署或runbook中使用。</p>

<p><strong>提示:</strong>对于任何输出变量名，记得用您的步骤名替换<code>HashiCorp Vault - Key Value (v2) retrieve secrets</code>。</p>


<h2 id="conclusion">结论</h2>

<p>本文中的模板展示了如何扩展Octopus的功能，从Vault或任何其他secrets manager中检索机密，并在您的部署或runbooks中使用它们。请务必在我们的<a href="https://samples.octopus.app/app#/Spaces-822" rel="nofollow">示例实例</a>的秘密管理空间中查看它们。</p>

<h2 id="learn-more">了解更多信息</h2>

<p>有关更多信息，您可以阅读:</p>



<p>愉快的部署！</p>

                    
                    
</body>
</html>