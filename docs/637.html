<html>
<head>
<title>Run the AWS CLI in Octopus Deploy - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Octopus部署- Octopus部署中运行AWS CLI</h1>
<blockquote>原文：<a href="https://octopus.com/blog/run-aws-cli-in-octopus-deploy#2021-08-12">https://octopus.com/blog/run-aws-cli-in-octopus-deploy#2021-08-12</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/octopus-aws-cli.png" class="zoom" data-title=""><img src="../Images/e65949ea81c221a39ee719f4f70901bc.png" class="img-fluid center" alt="Run the AWS CLI in Octopus Deploy" data-original-src="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/octopus-aws-cli.png"/>T2】</a></p>

<p>您是否曾经发现自己处于这样一种情况，您知道您想要自动创建一个对象，或者甚至列出对象并生成一个报告，但是您不想在编程语言之间切换？CLI为您提供了一种获得SDK全部可用性的方法，它们通常在每个系统上运行相同的功能，这意味着您不必为API创建包装。</p>

<p>在这篇博文中，我们来看看如何在Octopus Deploy中使用AWS CLI。演示重点是使用Octopus Deploy中的<strong>运行AWS CLI脚本</strong>步骤模板创建一个S3存储桶。</p>

<h2 id="prerequisites">先决条件</h2>

<p>要跟进这篇博文，您应该具备以下条件:</p>



<p>你可以从八达通服务器或八达通云免费开始使用。</p>

<h2 id="create-a-new-project">创建新项目</h2>

<p>在运行任何AWS CLI命令或创建步骤之前，您需要配置一个项目，以便有地方创建AWS CLI过程和步骤。为此，我们将使用Octopus CLI的强大功能。</p>

<p>打开终端并运行以下命令，创建一个添加了适当开关值的新项目:</p>

<pre><code>octo create-project --name AWSCLIDeployments --server=octopus_server_url --apiKey=octopus_server_api_key --projectGroup project_group --lifecycle=lifecycle_name
</code></pre>

<p>打开网络浏览器并登录Octopus门户网站。您现在应该看到新项目可用:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/images/1.png" class="zoom" data-title=""><img src="../Images/7407c66b624199168ac4ad924e842aa0.png" class="img-fluid center" alt="AWS CLI Project" data-original-src="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/images/1.png"/>T2】</a></p>

<h2 id="configure-the-variables">配置变量</h2>

<p>现在项目已经创建，您可以配置项目本身了。首先，我们将配置变量。要使AWS CLI步骤模板正常工作，它需要AWS帐户是一个变量:</p>

<ol>
<li>在Octopus门户网站中，导航到您刚刚创建的项目，<strong><span class="path">projects➜AWS clideployments</span></strong>。</li>
<li>在项目窗格下，点击<strong>变量</strong>。</li>
<li>在项目变量内的<strong>值</strong>下，选择下拉菜单并选择<strong>改变类型</strong>。</li>
<li>在类型选项下，选择<strong> AWS账户</strong>。</li>
<li>选择一个现有的AWS帐户，并为其命名。完成后，点击绿色的<strong> DONE </strong>按钮。</li>
<li>点击绿色的<strong>保存</strong>按钮，保存项目中的变量。</li>
</ol>

<h2 id="add-the-aws-cli-step">添加AWS CLI步骤</h2>

<p>现在已经配置了AWS account变量，您可以开始配置AWS CLI步骤本身来运行AWS CLI命令了。为此，您将创建一个新流程:</p>

<ol>
<li>在项目概述页面，选择<strong>流程</strong>:</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/images/2.png" class="zoom" data-title=""><img src="../Images/3468d2e7b3d5f32466ec45ba7be97049.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/images/2.png"/>T2】</a></p>

<ol start="2">
<li>在process页面上，您可以开始添加新步骤，特别是AWS CLI步骤。点击<strong>添加步骤</strong>按钮。</li>
<li>在<strong>下选择步骤模板</strong>，选择AWS，在已安装的步骤模板下，选择名为<strong>的步骤模板运行AWS CLI脚本</strong>。找到后，单击该步骤。</li>
<li>在<strong> AWS工具</strong>部分，选择<strong>使用与Octopus </strong>捆绑的AWS工具，因为该选项包含我们需要的所有内容:</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/images/3.png" class="zoom" data-title=""><img src="../Images/2a4fb94b1920632c07288d1578ed8490.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/images/3.png"/>T2】</a></p>

<ol start="5">
<li>在<strong> Amazon Web Services </strong>部分，选择您之前创建的<code>AWSAccount</code>变量，并选择<strong> us-east-1 </strong>地区:</li>
</ol>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/images/4.png" class="zoom" data-title=""><img src="../Images/f01efa95add650478285b112773cebfa.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-08/run-aws-cli-in-octopus-deploy/images/4.png"/>T2】</a></p>

<ol start="6">
<li>在该步骤的<strong>脚本部分</strong>中，选择inline source code选项并键入以下代码，这些代码将用于创建S3存储桶。您也可以将bucket的名称改为您所在的环境。请记住，S3存储桶名称必须是唯一的:</li>
</ol>

<pre><code>aws s3api create-bucket --bucket octopusdeploys392 --region us-east-1
</code></pre>

<ol start="7">
<li>输入代码后，点击绿色的<strong>保存</strong>按钮。</li>
</ol>

<p>您现在已经准备好运行管道了。</p>

<h2 id="run-the-pipeline">运行管道</h2>

<p>现在已经创建了使用AWS CLI的步骤，添加了内联代码，您已经准备好开始管道的部署过程了。</p>

<ol>
<li>在项目下，点击蓝色的<strong>创建发布</strong>按钮。</li>
<li>要保存发布，点击绿色的<strong>保存</strong>按钮。</li>
<li>选择要部署到的环境。比如Dev。</li>
<li>点击绿色的<strong>展开</strong>按钮，展开将开始。</li>
<li>完成后，您将看到任务摘要，其中完成了S3存储桶的创建。</li>
</ol>

<p>恭喜你。您已经成功地使用AWS CLI在AWS中创建了S3存储桶。</p>

<h2 id="conclusion">结论</h2>

<p>许多CLI为您提供了围绕任务执行简单操作的能力，而这些任务在UI中可能是复杂或繁琐的。使用CLI，您仍然可以从编程的角度直接与平台进行交互，以确保您能够自动执行任务。</p>

<p>在这篇博文中，您不仅学习了如何在Octopus Deploy中启动并运行项目，还学习了如何配置AWS CLI任务以在AWS中创建S3存储桶。</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>