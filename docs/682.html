<html>
<head>
<title>Selenium series: Creating an UberJAR - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Selenium系列:创建UberJAR - Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/selenium/30-create-an-uberjar/create-an-uberjar#2021-07-07">https://octopus.com/blog/selenium/30-create-an-uberjar/create-an-uberjar#2021-07-07</a></blockquote>
                        <p>这篇文章是关于<a href="/blog/selenium/0-toc/webdriver-toc">创建Selenium WebDriver测试框架</a>的系列文章的一部分。</p>

<p>我们用来构建代码的Maven项目会将我们的类打包到一个JAR文件中。我们可以通过运行Maven包生命周期来创建这个JAR文件。为此，打开<code>Maven Projects</code>工具窗口，双击<span class="path">生命周期➜包</span>选项。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image1.png" class="zoom" data-title=""><img src="../Images/e7bf49316a8c291096650792aea74b9e.png" class="img-fluid center" alt="C:\b4da756b8e562f2449a92910d5712a96" data-original-src="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image1.png"/>T2】</a></p>

<p>打包应用程序将首先运行所有的测试，然后在<code>target</code>目录下构建JAR文件。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image2.png" class="zoom" data-title=""><img src="../Images/2246892fc64b26dddcd5900530b9aa79.png" class="img-fluid center" alt="C:\eb232509f6285bcc27ff6f6904d0429f" data-original-src="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image2.png"/>T2】</a></p>

<p>然而，这个文件本身不足以运行应用程序，因为它不包括我们所依赖的所有附加库，如WebDriver和Cucumber。我们可以通过在任何查看ZIP文件的应用程序中打开JAR文件来确认这一点，因为JAR文件只是具有不同扩展名的ZIP文件。你可以看到这个档案中唯一的类是我们自己写的。这个档案中没有来自WebDriver或Cucumber库的类。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image3.png" class="zoom" data-title=""><img src="../Images/f37e1d718eb5fb14bfce702701ace735.png" class="img-fluid center" alt="C:\c8e655e8f7f7ad56dc24ed87b905be9d" data-original-src="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image3.png"/>T2】</a></p>

<p>这带来了一些问题，因为组成Lambda函数的代码必须打包到一个单独的归档文件中。一种解决方案是构建一个完全自包含的JAR文件，也称为UberJAR。</p>

<p>UberJAR是一个JAR文件，它包含运行应用程序所需的所有类，这意味着它包含我们编写的代码的所有类，以及我们的代码所依赖的库中的所有类。Maven使得用<a href="https://maven.apache.org/plugins/maven-shade-plugin/" rel="nofollow"> Shade </a>插件构建UberJAR变得很容易。</p>

<p>要配置Shade插件，我们需要将其配置添加到<code>&lt;build&gt;&lt;plugins&gt;</code>元素下。</p>

<p>这个配置指定插件的<code>shade</code>目标应该在<code>package</code>阶段运行。这意味着当我们用Maven打包代码时，Shade插件将自动运行以生成UberJAR:</p>

<pre><code class="language-xml">&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\"
xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"
xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0
http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;!-- ... --&gt;
  &lt;properties&gt;
    &lt;!-- ... --&gt;
    &lt;shade.version&gt;3.1.0&lt;/shade.version&gt;
    &lt;!-- ... --&gt;
  &lt;/properties&gt;
    &lt;build&gt;
      &lt;plugins&gt;
      &lt;!-- ... --&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
        &lt;version&gt;${shade.version}&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;shade&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      &lt;!-- ... --&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
  &lt;!-- ... --&gt;
&lt;/project&gt;
</code></pre>

<p>现在，当我们打包应用程序时，创建了两个JAR文件。</p>

<p><code>original-webdrivertraining-1.0-SNAPSHOT.jar</code>文件是常规的JAR文件，只包含我们自己代码中的类。你可以看到这个文件只有几千字节大小。</p>

<p><code>webdrivertraining-1.0-SNAPSHOT.jar</code>是包含运行这个应用程序所需的所有类的UberJAR文件。它要大得多，有几兆字节的大小。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image4.png" class="zoom" data-title=""><img src="../Images/404e7f2faa1bc46b62e5f500c6081649.png" class="img-fluid center" alt="C:\651a01a2c62fa638e66ab24197a7af10" data-original-src="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image4.png"/>T2】</a></p>

<p>查看UberJAR文件的内容，我们可以看到它有更多的类。这些类来源于我们在<code>pom.xml</code>文件中定义的所有依赖项，以及它们所有的依赖项。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image5.png" class="zoom" data-title=""><img src="../Images/0fbb612665287bf1faf2922411e0d441.png" class="img-fluid center" alt="C:\2f1e567c929f42473046a8ad3d364a97" data-original-src="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image5.png"/>T2】</a></p>

<p>您会注意到，运行<code>package</code> Maven生命周期会导致所有的测试都在运行。假设我们编写的测试涉及启动web浏览器，如果您只想生成JAR文件，这些测试可能会碍事。为了防止测试运行，右键单击package lifecycle菜单项并选择<code>Create 'webdrivertraining...'...</code>选项。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image6.png" class="zoom" data-title=""><img src="../Images/aba8914a337481be3fa189e1b335630f.png" class="img-fluid center" alt="C:\c00ed64c68f139e3bbf3bf836c200a12" data-original-src="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image6.png"/>T2】</a></p>

<p>然后选择<code>Runner</code>选项卡。取消选择<code>Use project settings</code>选项，然后选择<code>Skip tests</code>选项。点击<code>OK</code>按钮保存更改后的内容。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image7.png" class="zoom" data-title=""><img src="../Images/0415d012abb2a06472bae3095e94d10c.png" class="img-fluid center" alt="C:\f3de0341a982365112d4ac0fb3ff17d8" data-original-src="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image7.png"/>T2】</a></p>

<p>这将创建一个名为<code>webdrivertraining [package]</code>的新配置。在选中这个配置的情况下，单击绿色箭头将运行Maven包的生命周期，但是跳过测试，允许您快速构建JAR文件。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image8.png" class="zoom" data-title=""><img src="../Images/da082417f8b900110cb585c7a66f0eb0.png" class="img-fluid center" alt="C:\1eaaa83ad11078700649ee9e0810bd14" data-original-src="https://i.octopus.com/blog/2018-10/selenium/30-create-an-uberjar/image8.png"/>T2】</a></p>

<p>由此产生的UberJAR文件提供了一个方便的、自包含的包，我们可以轻松地分发和运行它，这就是我们将作为AWS Lambda部署的内容。在下一篇文章中，我们将添加在Lambda中运行WebDriver测试所需的代码，并使用无服务器应用程序发布UberJAR文件。</p>

<p>这篇文章是关于<a href="/blog/selenium/0-toc/webdriver-toc">创建Selenium WebDriver测试框架</a>的系列文章的一部分。</p>

                    
                    
</body>
</html>