# 变革顾问委员会不起作用-八达通部署

> 原文：<https://octopus.com/blog/change-advisory-boards-dont-work>

[![Change Advisory Boards Don’t Work](img/db87e3afc6c769c90d7e63438e20de38.png)](#)

以质量的名义，许多组织有一个变更顾问委员会或变更批准委员会(CAB ),他们在针对生产执行变更之前对变更进行审查。它们有时是为了遵守某些法规，如 2002 年萨班斯-奥克斯利法案(SOX)，和/或强制执行“职责分离”。其他时候，为了提高可靠性，在一系列部署失败后引入 cab。

这个想法是提供额外的审查，通常是为了捕捉错误、糟糕的代码或欺诈性的更改。这是一个崇高的目标，但不幸的是，出租车通常弊大于利。

这一点在 2018 年由妮可·福斯格伦、吉恩·金和杰兹·亨布尔在 [Accelerate](https://www.amazon.co.uk/Accelerate-Software-Performing-Technology-Organizations/dp/1942788339) 中清晰地展示出来。他们分析了 2014–2017 年开发运营状况报告中的数据，他们:

> “发现外部批准与交付时间、部署频率和恢复时间呈负相关，与变更失败率无关。简而言之，外部机构(如经理或 CAB)的批准根本不能提高生产系统的稳定性，这是通过恢复服务和变更失败率的时间来衡量的。然而，它肯定会减慢速度。事实上，这比根本没有变更审批流程更糟糕。”

上面的报价包含一些加载的条款。让我们来讨论它们的含义以及为什么它们意义重大。

## 研制周期

对于许多人来说，DevOps 运动开始于一个模糊的认识，即快速地将变更投入生产以及减少任何时候的在制品(WIP)量的重要性。“DevOps”这个名称是对典型的反模式的拒绝，这种反模式是在开发人员和运营人员之间的“混乱之墙”上抛出变更，在这种情况下，变更将不可避免地与政治心理剧纠缠在一起，导致延迟和错误。

基于精益制造和敏捷软件开发，人们认识到了与长开发周期和大量 WIP 水平相关的巨大挑战和浪费。在 DevOps 运动的早期，经常听到人们亲切地称交付周期为从“啊哈！去挖沟！”他们认识到，任何能够以小增量快速实现其想法的企业，都将在市场上拥有显著的优势。

我们不再生活在一个大打小闹的世界。快打败了慢。如果你能尽早交付价值，你就有能力扰乱市场。有可能在开发周期的更早阶段就开始销售产品，并根据现实世界的反馈逐步完善想法。这大大降低了对前期资本投资的要求，并带来了更好的产品和服务。一个企业只能从速度、质量和成本中选择两者的古老说法已经过时了。

缩短交付周期与减少 WIP 密切相关。如果一个组织试图一次进行太多或太大的变更，变更管理开销会很快变得很大，失败的风险也会激增。开发周期短，变更少，效率更高，反之亦然。

然而，cab 通常会显著增加交付周期和 WIP，因为更新会被延迟，并在经过正式的审批流程时进行批量处理。例如，如果 CAB 每周召开一次会议，那么只花了一个小时编写的变更在交付给最终用户之前可能会延迟 40 个工作小时，或实际 168 个小时。对企业来说，意想不到的后果是交付周期明显缩短，WIP 增加，导致质量下降，反馈变慢，开发成本增加，现金流减少。

## 部署频率

一个组织部署的频率并不是一个难以理解的概念，但它是一个重要的指标，会带来一些反直觉的后果。

每个部署都有一些风险，失败的部署是一件可怕的事情。根据[《可见运营手册》](https://www.amazon.co.uk/Visible-Ops-Handbook-Implementing-Practical/dp/0975568612/)、[、《开发运营手册》](https://www.amazon.co.uk/Devops-Handbook-World-Class-Reliability-Organizations/dp/1942788002/)和各种 Gartner 报告，大约 80%的生产中断是有人做出改变的结果。如果一个组织遭受了一系列代价高昂的部署失败，自然希望减少失败次数，并采取额外的措施来测试和验证它们。

出租车通常就是在这种背景下形成的。然而，正如 Chuck Rossi 在脸书工作时观察到的，当部署增长超过一定规模时，成功执行它们几乎是不可能的。如果将许多小的变更捆绑到一个大的部署中，那么这个部署本质上会变得更复杂、更有风险、更难修复。他总结道，“如果我们想要更多的改变，我们需要更多的部署”。

不幸的是，cab 经常产生一个瓶颈，许多变更在一个批处理中被评审，然后在一个部署窗口中被部署，通常是由对每个变更的上下文了解很少的人进行的。因此，尽管出发点是好的，但现实是，由于降低部署频率的直接结果，cab 通常会增加痛苦的部署失败的风险，从而导致更大、更复杂和更危险的部署。

## 恢复时间和更改失败率

恢复时间，或平均恢复时间(MTTR)，是一个衡量团队从中断中恢复的速度的指标。因为我们预计 80%的停机是变更的结果，所以明智的做法是特别关注团队从失败的部署中恢复的速度，并投资于改善 MTTR 的工作。

然而，从历史上看，组织更关注平均无故障时间(MTBF)。虽然态度正在改变，但人们仍然更可能谈论部署失败的频率，而不是故障可以多快修复。

在[数据库可靠性工程](https://www.amazon.co.uk/Databases-at-Scale-Operations-Engineering/dp/1491925949)中，Laine Campbell 和 Charity Majors 将此称为“弹性对健壮性”。他们解释说，当人们设计健壮的系统从不/很少崩溃时，系统就变得脆弱了。因为失败很少发生，所以当失败真的发生时，团队准备不足，而且通常失败是复杂的，难以理解和修复。相反，当团队接受失败会发生并设计一个系统来处理失败时，他们更有可能快速恢复。他们提倡诸如金丝雀部署模式、自动故障转移、混沌工程以及使系统能够自动切换到小规模模式等实践。例如，当服务处于重负载时，适度地关闭资源密集型功能。通过采用这些弹性实践，部署失败的影响可能会小得多。

因此，虽然变更失败率低当然是可取的，但是试图消除所有风险是徒劳的。您可以将整个 IT 预算投资于避免失败，但失败仍然会发生。与此同时，寻找完美部署记录的开销可能会削弱交付时间和创新。老话说，只要完美是不可能的或者不切实际的，“完美就是好的敌人”。

相比之下，首先关注 MTTR，其次关注变更失败率的组织，将与风险有更健康的关系。如果失败的部署不再是一个问题，并且您的团队能够更快地修复它们，那么变更失败率是 1%还是 2%就不那么重要了。也可能是 25%，因为在客户眼中，这个组织仍然可能比 MTTR 差的组织表现更好。

不幸的是，大多数 cab 更重视停止中断的部署，而不是创建一个失败时更安全的系统。这是没有效果的。

## 四个关键指标

这四个概念(交付时间、部署频率、MTTR 和变更失败率)共同构成了 Accelerate 的“四个关键指标”。选择这些指标是因为它们被证明能够带来积极的业务成果。

虽然听起来不太直观，但是那些在速度指标(交付周期和部署频率)上得分高的组织也是在质量指标(MTTR 和变更失败率)上得分高的组织。在交付周期、部署频率和 MTTR 方面表现较好的组织具有较好的业务成果，这可以通过盈利能力、生产力和市场份额来衡量。(有趣的是，变更失败率似乎没有其他三个指标重要。)

Forsgren、Humble 和 Kim 已经证明了速度产生质量，质量产生速度，它们都会带来更好的业务成果。如果您有一个 CAB，那么 CAB 与四个关键指标和业务成果负相关的事实应该引起您、您的 IT 经理和您的股东的关注。

## 一个理想的代码审查过程

让知识渊博的专家审查代码无疑是同时提高质量和避免知识囤积的一个极好的方法。这也是促进指导、个人发展以及与具有不同技能或经验的人(如数据库管理员、信息安全等)合作的好方法。代码审查是一件美妙的事情，这篇博客文章不应该被解释为对这种有价值的实践的批评。

大多数出租车的目标无疑是积极的。问题出在它们的实现上。

当由理解代码和上下文的人来完成时，代码评审工作最好。例如，它们可以由开发团队的另一个成员来完成。也许是坐在邻桌的人或更有经验的同事？如果您是一名 web 开发人员，但是您需要更新数据库中的存储过程，那么您可能更希望获得 DBA 的审核。对于代码来说，由一个了解上下文的有知识的专家来评审比由一群不了解上下文的人组成的委员会来评审要有效得多。

代码评审也应该在小范围的变更中进行。有人被要求评审的代码越多，他们就越不仔细，提出的建议也越少。因此，由委员会在相对较短的会议中审查大量的变更，不太可能提供高质量的审查或反馈。相比之下，频繁的小代码审查要有效得多。

无论是谁来评审你的工作，都应该理解缩短交付周期和减少在制品的重要性。简单地说，评审应该快速进行，完成工作比开始工作更重要。因此，如果您正在处理一个新的开发任务，并且有人要求您评审他们的“开发完成”变更，您通常应该优先评审他们的代码，而不是您自己的工作。虽然这可能会引入一个上下文切换开销，但是这比在一周结束时对变更进行批处理要小得多。因此，理想的评审者应该服从于开发者，而不是相反。任何评审者都应该在变更准备好接受评审时，近乎实时地评审变更，而不是让变更以适合评审者的节奏进行批量评审。如果评审者是个人，这应该是可以管理的，但是如果评审者是一个大的委员会，这就变得不切实际了。

## 布线过程

不幸的是，cab 很少反映上述理想的代码评审过程。通常，来自整个组织的各种极度规避风险的角色会聚集在会议室或通过视频会议，讨论一长串在过去一周左右分批进行的变更。CAB 可能包括不是主题专家的人，他们可能不了解上下文。

这些会议可能会按照固定的时间表进行，所以工作是根据人们的日程安排的，而不是人们根据手头的任务来安排他们的时间。

在大多数 CAB 会议中，由于要审查的变更的数量和规模，单个变更不会受到太多审查。

每个变更可能只与 CAB 的一两个成员相关，因此其他与会者很可能是在浪费时间。

CAB 会议往往成为例行公事，每个项目都要问一两个相同的问题。“这会导致停机吗？”“您有回滚计划吗？”很好，下一个。

也许最糟糕的是，这些会议对所有与会者来说，可能会变得极其乏味，占用日程表。

不管最初的意图是什么，出租车通常会变成一个安全的剧院，而不是真正试图创建更可靠的系统。它们在提供有限价值的同时，往往会造成严重的破坏。

## 职责分离、法规遵从性和欺诈

在我们继续之前，请明确一个事实，我不是律师，虽然我在本文前面提到了 SOX，但我对技术实践的建议不应被解释为对任何特定法律的法律建议。如果你对任何法律问题有任何疑虑，你应该寻求专业的法律意见。我的建议纯粹是关于特定技术实践的有效性。

正如本文开头所提到的，cab 的存在通常是因为监管要求，通常是因为一个关于“职责分离”的特定条款。这些法规通常是为了防止欺诈而存在的，它们非常重要。

不幸的是，cab 通常不是发现欺诈的有效方法，并且由于上述原因，它们给组织带来了可怕的负担。上面描述的理想的代码审查过程是对欺诈的更好的防御，也是交付创新软件的更有效的方法。

在不对任何具体法律做出任何评论的情况下，根据我的经验，大多数关于防止欺诈的法律不太关心代码审查的形式，而更关心其有效性和可审计性。如果您要审查管理您的法律，您很可能会发现传统的 CAB 并不是绝对必要的，更轻量级但同样严格的审查过程可能更合适，它更自然地适合您的开发周期并包含更彻底的审查。

例如，上面描述的理想代码评审过程非常适合在源代码控制中使用拉请求。通过这种方式，审核者和他们的注释被审核，并且通常可以配置各种规则来定义需要审核每个变更的人员的种类。如果没有进行适当的代码评审，就不可能更新源代码控制中的主分支。

或者，您可以在部署管道中审核您的评审，比如通过使用 Octopus Deploy 中的“[手动干预](https://octopus.com/docs/deployment-process/steps/manual-intervention-and-approvals)”步骤。这些都是经过全面审核的，包括关于谁审核了变更、何时审核的详细信息，并且任何评论都存储在日志中。

对于不同种类的审查，您可能希望在部署管道中同时使用源代码控制拉请求和手动审查步骤，但是要小心添加太多的手动批准门，因为这可能会增加交付时间和 WIP，并且会导致更大和更有风险的部署。评论很重要，但是保持轻量级和避免不必要的官僚主义也很重要。

如果您对自己的法律要求有任何疑问，请寻求专业的法律建议。

## 如果您的组织正在考虑组建一个 CAB，该怎么办

首先，保持冷静。做出这些决定的人很可能是出于好意。他们只是不理解出租车可能产生的反模式。你应该设法教育他们，而不是压制他们。大多数人喜欢学习和被说服，但人们很少对被击败而屈服做出好的反应。

你可以从教他们上述四个关键指标的反直觉本质开始。从这里开始，你可以解释你同意适当的监督是重要的，并且你渴望尽可能有效和高效地交付必要的监督。

你可能要考虑拥抱最厌恶风险的人和最了解主要风险的人。通过要求他们帮助您设计自动化的方法来标记您的自动化测试框架或部署管道中的潜在问题，让他们站在您的一边。最了解风险的人通常会成为优秀的盟友。

特别注意与驾驶室相关的任何表格填写或售票系统。这些通常设计得很差，或者没有给用户提供所有必要信息的机会，或者它们引入了难以忍受的开销，即使是简单和低风险的更改。当这种情况发生时，这个过程将不可避免地中断，没有人会赢。

确保 CAB 具有明确定义的范围，并且如果可能的话，低风险，甚至可能是中等风险的变更可以完全跳过 CAB。这将使 CAB 有更多的时间关注最有风险的变更。例如，尝试获得一个承诺，即如果变更符合以下标准，它可以绕过 CAB:

*   开发团队在过去的 30 天里一直保持在他们的“误差预算”内(参见[现场可靠性工程](https://www.amazon.co.uk/Site-Reliability-Engineering-Betsy-Beyer/dp/149192912X)、[第 3 章](https://landing.google.com/sre/sre-book/chapters/embracing-risk/)关于误差预算的更多细节)。
*   所有变更都通过自动化部署管道进行部署。
*   所有变更都已经由团队的另一名成员进行了同行评审。
*   所有的变更都通过了相关的测试，代码库保持了至少 x%的代码覆盖率。

除了节省 CAB 时间，这将激励开发团队投资于适当的质量控制和测试自动化，以避免经历 CAB。

最后，为每个关键决策者购买一份 [Accelerate](https://www.amazon.co.uk/Accelerate-Software-Performing-Technology-Organizations/dp/1942788339) 可能不会有什么坏处。如果他们不想读，和他们达成一个协议，你会在他们的推荐下读一本书(而且一定要读！)，如果他们答应看一本你推荐的书。然后约定一个见面的时间，也许可以吃顿大餐，讨论一下这两本书。你们可能都学到了一些东西，这可能会引发一场友好而有价值的讨论。

## 如果你已经有出租车了该怎么办

不得不随着出租车的节拍跳舞并不理想。然而，在阅读这篇博客后，你应该避免任何下意识的反应。在没有投资任何轻量级批准过程的情况下，您很可能会依赖 CAB 来进行高风险的变更。

不管你喜欢它还是讨厌它，对你现有过程的任何改变都应该反复地、小心翼翼地进行。开发您的部署过程，就像构建一个软件一样，应该小批量地完成，以避免意外地做出灾难性的大规模更改。

承认人为因素也很重要。你可能已经有了一群有价值、有技能的同事，他们已经是 CAB 的成员或者投资了 CAB——你想把他们带在身边。也可能有一些有权有势的人对缩减或解散 CAB 的想法感到不安。与他们为敌可能不是个好主意。

作为第一步，与 CAB 的支持者谈谈如何让它更有效率。毕竟，很有可能他们和你一样厌倦了出租车。它们可能是相当乏味的会议，大多数与会者可能会认为它们分散了他们对更重要任务的注意力。

也许你可以问他们以下几个问题:

*   变更是否分为高风险、中风险和低风险变更？低风险和中等风险的变更有什么区别？阈值是否设置在适当的水平，使 CAB 能够将注意力集中在最重要的问题上？
*   怎样才能让 CAB 满意地自动批准低风险变更或允许他们完全绕过 CAB？
*   要将中等风险的变更降级为低风险的变更，您能做些什么？需要什么样的验证或测试？为了预先批准中等风险变更，这些测试可以自动化吗？
*   如何简化文书工作或表格？
*   是否要求所有 CAB 成员都到场审查所有变更？例如，如果 CAB 通常在周三下午开会，您是否可以在每天上午 11 点与一两名 CAB 成员一起额外运行一个缩小版的 CAB，以便在低/中风险变更可用时尽快进行审核？这将使您有更多的时间在周三的主要会议上仔细检查高风险的变更，并改善中低风险变更的准备时间。这可能会显著减少 WIP，并推动所有四个关键指标的改进。
*   为了使系统相互分离，您可以投资什么样的架构变化？这可以降低一个故障影响多个系统的风险。因此，可能需要更少的人来审查每个变更。
*   您可以进行哪些投资来改善 MTTR 或降低部署风险？如果部署失败的后果显著减少，这是否会使 CAB 允许变更更自由地流向生产？
*   您如何报告您对 CAB 流程所做的任何更改的成功/失败？当您迭代您的 CAB 流程时，您能跟踪这四个关键指标，或者任何其他关键性能指标，以确保您的更改产生积极的效果吗？

* * *

自 2010 年以来，Alex Yates 一直在帮助组织将 DevOps 原则应用于他们的数据。他最引以为豪的是帮助 Skyscanner 开发了一天 95 次部署的能力，并支持联合国项目服务办公室的发布流程。亚历克斯与除南极洲以外的各大洲的客户都有过合作——所以他渴望见到任何研究企鹅的人。

作为一名热心的社区成员，他共同组织了[数据接力](https://datarelay.co.uk/)，是【www.SpeakingMentors.com】的创始人，并自 2017 年以来被公认为[微软数据平台 MVP](https://mvp.microsoft.com/en-us/PublicProfile/5002655?fullName=Alex%20Yates) 。

Alex 是官方 Octopus Deploy 合作伙伴 [DLM 顾问](https://dlmconsultants.com/)的创始人。他喜欢为那些希望通过改进 IT 和数据库交付实践来实现更好业务成果的客户提供指导、辅导、培训和咨询。

如果你想和亚历克斯一起工作，请发电子邮件:[enquiries@dlmconsultants.com](mailto:enquiries@dlmconsultants.com)