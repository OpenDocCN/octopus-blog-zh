<html>
<head>
<title>Selenium series: Exposing Gherkin steps - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>硒系列:暴露小黄瓜步骤-章鱼部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/selenium/26-exposing-gherkin-steps/exposing-gherkin-steps#2021-07-07">https://octopus.com/blog/selenium/26-exposing-gherkin-steps/exposing-gherkin-steps#2021-07-07</a></blockquote>
                        <p>这篇文章是关于<a href="/blog/selenium/0-toc/webdriver-toc">创建Selenium WebDriver测试框架</a>的系列文章的一部分。</p>

<p>现在我们已经有了将<code>AutomatedBrowserBase</code>类与Cucumber集成的基础，是时候开始充实我们可以用来编写WebDriver测试的小黄瓜方言了。</p>

<p>在大多数测试中，打开浏览器后的下一步是打开一个URL。我们可以通过注释<code>goTo()</code>方法来揭示这一点。</p>

<p>我们将使用正则表达式<code>^I open the URL "([^\"]*)"$</code>来捕获我们希望打开的URL，并将其传递给<code>url</code>参数。这个正则表达式遵循我们熟悉的模式，即使用脱字符号和美元符号来匹配字符串的开头和结尾，一些必须进行字面匹配的纯文本，以及单组引号:</p>

<pre><code class="language-java">@And("^I open the URL \"([^\"]*)\"$")
@Override
public void goTo(String url) {
  // ...
}
</code></pre>

<p>现在我们需要公开一些方法来与网页交互。这里我们已经注释了<code>clickElementWithId()</code>方法:</p>

<pre><code class="language-java">@And("^I click the \\w+(?:\\s+\\w+)* with the id \"([^\"]*)\"$")
@Override
public void clickElementWithId(String id) {
  // ...
}
</code></pre>

<p>我们用来作为一个步骤公开这个方法的正则表达式包含一些新概念。</p>

<p>我们使用了一些字符类来匹配常见的字符类型。字符类是一个反斜杠，后跟一个定义类的字符。</p>

<p><code>\w</code>字符类匹配任何单词字符，这意味着它匹配任何小写字符、任何大写字符和任何数字。</p>

<p>字符类匹配任何空白字符，比如空格或制表符。</p>

<p>您可以在<a href="https://docs.oracle.com/javase/tutorial/essential/regex/pre_char_classes.html" rel="nofollow"> Oracle文档</a>中找到关于正则表达式字符类的更多信息。</p>

<p>在这个正则表达式中，我们还使用了一个非捕获组。非捕获组以<code>(?:</code>开始，以<code>)</code>结束。非捕获组很有用，因为它们定义了我们可以选择或重复的匹配，而当模式与字符串匹配时，不会被捕获为一个不同的组。这对于与Cucumber的集成非常重要，因为非捕获组不会作为参数传递给相关的方法。</p>

<p>模式<code>\\w+(?:\\s+\\w+)*</code>匹配由空格分隔的零个或多个单词。因此，以下字符串将全部匹配此模式:</p>

<ul>
<li>文字框</li>
<li>下拉列表</li>
<li>文本区域</li>
<li>单选按钮</li>
<li>检验盒</li>
</ul>

<p>我们使用这种模式来允许以最自然的方式描述交互的元素。因为该模式使用非捕获组，Cucumber不会将匹配的文本作为参数传递给该方法。</p>

<p>下表将正则表达式分解为各个部分:</p>

<table class="table">
<thead>
<tr>
<th>模式</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>^</code></td>
<td>匹配字符串的开头</td>
</tr>
<tr>
<td><code>I click the</code></td>
<td>匹配文字字符串<code>I click the</code></td>
</tr>
<tr>
<td><code>\\w+</code></td>
<td>匹配一个或多个单词字符</td>
</tr>
<tr>
<td><code>(?:</code></td>
<td>启动非捕获组</td>
</tr>
<tr>
<td><code>\\s+</code></td>
<td>匹配一个或多个空白字符</td>
</tr>
<tr>
<td><code>\\w+</code></td>
<td>匹配一个或多个单词字符</td>
</tr>
<tr>
<td><code>)*</code></td>
<td>结束非捕获组，并进行零次或多次匹配</td>
</tr>
<tr>
<td><code>with the id \"</code></td>
<td>匹配文字字符串<code>with the id "</code></td>
</tr>
<tr>
<td><code>(</code></td>
<td>启动捕获组</td>
</tr>
<tr>
<td><code>[^"]*</code></td>
<td>匹配除双引号以外的任何字符零次或多次</td>
</tr>
<tr>
<td><code>)</code></td>
<td>结束捕获组</td>
</tr>
<tr>
<td><code>\"</code></td>
<td>匹配文字字符串<code>"</code></td>
</tr>
<tr>
<td><code>$</code></td>
<td>匹配字符串的结尾</td>
</tr>
</tbody>
</table>

<p>要了解匹配该正则表达式的步骤，请将其输入到<a href="http://regex-testdrive.com/en/dotest" rel="nofollow">http://regex-testdrive.com/en/dotest</a>中，并测试以下示例:</p>

<ul>
<li>我单击id为“email”的文本框</li>
<li>我单击id为“option-1”的复选框</li>
<li>我点击id为“提交”的红色大按钮</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/26-exposing-gherkin-steps/image1.png" class="zoom" data-title=""><img src="../Images/9a9482854db9f60799d4e7d43cb9821a.png" class="img-fluid center" alt="C:\d117bb78328e97f7dab22e91ecfeae72" data-original-src="https://i.octopus.com/blog/2018-10/selenium/26-exposing-gherkin-steps/image1.png"/>T2】</a></p>

<p>注意，只捕获了两个组:组0是整个字符串，组1是我们想要单击的元素的ID。然后，Group 1作为第一个参数传递给该方法。</p>

<p>接下来，我们公开实现显式等待的重载版本<code>clickElementWithId()</code>。这个方法有第二个名为<code>waitTime</code>的参数，它接受一个<code>int</code>:</p>

<pre><code class="language-java">@And("^I click the \\w+(?:\\s+\\w+)* with the id \"([^\"]*)\" waiting up to \"(\\d+)\" seconds?$")
@Override
public void clickElementWithId(String id, int waitTime) {
  // ...
}
</code></pre>

<p>这个方法的正则表达式与前一个相似，但是增加了一个捕获组来捕获等待元素可点击的时间。</p>

<p>这个正则表达式使用了一个新的字符类<code>\d</code>，它匹配任何数字。</p>

<p>下表将正则表达式分解为各个部分:</p>

<table class="table">
<thead>
<tr>
<th>模式</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>^</code></td>
<td>匹配字符串的开头</td>
</tr>
<tr>
<td><code>I click the</code></td>
<td>匹配文字字符串<code>I click the</code></td>
</tr>
<tr>
<td><code>\\w+</code></td>
<td>匹配一个或多个单词字符</td>
</tr>
<tr>
<td><code>(?:</code></td>
<td>启动非捕获组</td>
</tr>
<tr>
<td><code>\\s+</code></td>
<td>匹配一个或多个空白字符</td>
</tr>
<tr>
<td><code>\\w+</code></td>
<td>匹配一个或多个单词字符</td>
</tr>
<tr>
<td><code>)*</code></td>
<td>结束非捕获组，并进行零次或多次匹配</td>
</tr>
<tr>
<td><code>with the id \"</code></td>
<td>匹配文字字符串<code>with the id "</code></td>
</tr>
<tr>
<td><code>(</code></td>
<td>启动捕获组</td>
</tr>
<tr>
<td><code>[^"]*</code></td>
<td>匹配除双引号以外的任何字符零次或多次</td>
</tr>
<tr>
<td><code>)</code></td>
<td>结束捕获组</td>
</tr>
<tr>
<td><code>\" waiting up to \"</code></td>
<td>匹配文字字符串<code>" waiting up to "</code></td>
</tr>
<tr>
<td><code>(</code></td>
<td>启动捕获组</td>
</tr>
<tr>
<td><code>\\d+</code></td>
<td>匹配一个或多个数字字符</td>
</tr>
<tr>
<td><code>)</code></td>
<td>结束捕获组</td>
</tr>
<tr>
<td><code>\" second</code></td>
<td>匹配文字字符串<code>" second</code></td>
</tr>
<tr>
<td><code>s?</code></td>
<td>匹配零个或一个<code>s</code>字符</td>
</tr>
<tr>
<td><code>$</code></td>
<td>匹配字符串的结尾</td>
</tr>
</tbody>
</table>

<p>要了解匹配该正则表达式的步骤，请将其输入到<a href="http://regex-testdrive.com/en/dotest" rel="nofollow">http://regex-testdrive.com/en/dotest</a>中，并测试以下示例:</p>

<ul>
<li>我点击id为“email”的文本框，等待“1”秒</li>
<li>我单击id为“option-1”的复选框，等待“10”秒</li>
<li>我点击id为“提交”的红色大按钮，等待“5”秒</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-10/selenium/26-exposing-gherkin-steps/image2.png" class="zoom" data-title=""><img src="../Images/7097c1720fe5669c1327e94ad51381cd.png" class="img-fluid center" alt="C:\4f279d1029084cec389ed1a693b43b4e" data-original-src="https://i.octopus.com/blog/2018-10/selenium/26-exposing-gherkin-steps/image2.png"/>【T37】T2】</a></p>

<p>这个正则表达式有三个捕获组。同样，组0是整个字符串。与前面的正则表达式一样，group 1是要单击的元素的ID，Cucumber将它作为第一个参数传递给方法。新的group 2捕获显式等待时间，Cucumber将其作为第二个参数传递给该方法。</p>

<p>让我们看看我们将用来定义一个步骤的最复杂的正则表达式。<code>selectOptionByTextFromSelectWithId()</code>方法接受下拉列表中要选择的选项的名称、下拉列表的ID以及等待下拉列表可点击的时间。这个正则表达式有3个捕获组:</p>

<pre><code class="language-java">@And("^I select the option \"([^\"]*)\" from the \\w+(?:\\s+\\w+)* with the id \"([^\"]*)\" waiting up to \"(\\d+)\" seconds?$")
@Override
public void selectOptionByTextFromSelectWithId(String optionText, String id, int waitTime) {
// ...
}
</code></pre>

<p>下表将正则表达式分解为各个部分:</p>

<table class="table">
<thead>
<tr>
<th>模式</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>^</code></td>
<td>匹配字符串的开头</td>
</tr>
<tr>
<td><code>I select the option \"</code></td>
<td>匹配文字字符串<code>I select the option "</code></td>
</tr>
<tr>
<td><code>(</code></td>
<td>启动捕获组</td>
</tr>
<tr>
<td><code>[^"]*</code></td>
<td>匹配除双引号以外的任何字符零次或多次</td>
</tr>
<tr>
<td><code>)</code></td>
<td>结束捕获组</td>
</tr>
<tr>
<td><code>\"</code></td>
<td>从匹配的文字字符串<code>" from the</code></td>
</tr>
<tr>
<td><code>\\w+</code></td>
<td>匹配一个或多个单词字符</td>
</tr>
<tr>
<td><code>(?:</code></td>
<td>启动非捕获组</td>
</tr>
<tr>
<td><code>\\s+</code></td>
<td>匹配一个或多个空白字符</td>
</tr>
<tr>
<td><code>\\w+</code></td>
<td>匹配一个或多个单词字符</td>
</tr>
<tr>
<td><code>)*</code></td>
<td>结束非捕获组并匹配它零次或多次</td>
</tr>
<tr>
<td><code>with the id \"</code></td>
<td>匹配文字字符串<code>with the id "</code></td>
</tr>
<tr>
<td><code>(</code></td>
<td>启动捕获组</td>
</tr>
<tr>
<td><code>[^"]*</code></td>
<td>匹配除双引号以外的任何字符零次或多次</td>
</tr>
<tr>
<td><code>)</code></td>
<td>结束捕获组</td>
</tr>
<tr>
<td><code>\" waiting up to \"</code></td>
<td>匹配文字字符串<code>" waiting up to "</code></td>
</tr>
<tr>
<td><code>(</code></td>
<td>启动捕获组</td>
</tr>
<tr>
<td><code>\\d+</code></td>
<td>匹配一个或多个数字字符</td>
</tr>
<tr>
<td><code>)</code></td>
<td>结束捕获组</td>
</tr>
<tr>
<td><code>\"</code></td>
<td>第二个匹配文字字符串<code>" second</code></td>
</tr>
<tr>
<td><code>s?</code></td>
<td>匹配零个或一个<code>s</code>字符实例</td>
</tr>
<tr>
<td><code>$</code></td>
<td>匹配字符串的结尾</td>
</tr>
</tbody>
</table>

<p>要了解匹配该正则表达式的步骤，请将其输入到<a href="http://regex-testdrive.com/en/dotest" rel="nofollow">http://regex-testdrive.com/en/dotest</a>中，并测试以下示例:</p>

<ul>
<li>我从id为“dropdownlist”的下拉列表中选择选项“Option One ”,等待“1”秒</li>
<li>我从下拉列表中选择了选项“一个很长的选项名”, id为“the-select-element ”,等待了“10”秒</li>
<li>我从id为“alongid”的选项列表中选择“这也是一个长名字”选项，等待“5”秒</li>
</ul>

<p>【T2 <img src="../Images/9c6d923489e76b19973ea82fddead85d.png" class="img-fluid center" alt="C:\98467ce11d951c72ec283e76b8d449e3" data-original-src="https://i.octopus.com/blog/2018-10/selenium/26-exposing-gherkin-steps/image3.png"/></p>

<p>现在我们有4个捕获组。因为group 0总是整个字符串，所以第一个捕获组是要选择的选项的名称，第二个是下拉列表的ID，第三个是等待元素可点击的时间。</p>

<p>正如您所看到的，正则表达式非常强大，我们只涉及了正则表达式匹配字符串的一小部分方法。然而，这些正则表达式展示了我们将方法映射到小黄瓜步骤时使用的所有技术。剩下的所有方法都将使用正则表达式，其中包含我们在前面的方法中演示的捕获组、非捕获组、字符类和特殊字符的某种组合。</p>

<p>这篇文章是关于<a href="/blog/selenium/0-toc/webdriver-toc">创建Selenium WebDriver测试框架</a>的系列文章的一部分。</p>

                    
                    
</body>
</html>