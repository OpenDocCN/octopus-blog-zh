# CI/CD - Octopus 部署的最佳实践

> 原文：<https://octopus.com/blog/best-practices-for-cicd>

持续集成和交付(CI/CD)将软件开发从代码转化为实际产品。CI/CD 是 DevOps 流程的一部分，其中包含许多公认的最佳实践，您可以遵循这些实践来改进您的部署渠道。

如果您在 DevOps 中工作，您可能已经使用过像 Jenkins 这样的构建服务器和像 Octopus Deploy 这样的部署工具来完成您的部署过程。Octopus 支持 CI/CD 的持续交付方面，提供了同类最佳的产品，使复杂的部署变得更加容易。

在八达通，我们相信 8 的力量。章鱼有 8 条肢体，因此这里有 8 个最佳实践来帮助您的部署之旅。

您还可以在我们的 [DevOps 工程师手册](https://octopus.com/devops/)中了解更多信息。

## 采用敏捷方法

敏捷方法对 CI/CD 和 DevOps 至关重要。敏捷是一种项目管理方法，包括与利益相关者的持续协作以及在部署过程的每个阶段的持续改进。

敏捷的原则是通过小的开发迭代获得频繁的反馈，这样开发人员就可以使最终产品与用户的需求紧密结合。敏捷方法与传统的瀑布方法形成对比，在传统的瀑布方法中，项目是在一个阶段中确定范围和交付的。

我们建议根据敏捷和精益原则管理软件项目，这样持续的反馈循环可以改进产品。我们已经看到敏捷被实现为上层管理人员的核对清单。在初始阶段，软件团队应用敏捷来满足清单。随着团队获得探索敏捷空间的许可，他们开始看到真正的好处。

## 使用受版本控制的代码，连接到部署过程，经常提交

如果你从事软件工作，你几乎肯定用过 Git。关于源代码控制的战争已经打响并取得了胜利，Git 现在是源代码控制的同义词。

受源代码控制的代码允许完整的历史记录和代码回滚到以前的版本。您还可以通过使用 Git 的合并方法来解决冲突。

提交代码更改应该会触发 CI/CD 管道构建。该触发器允许开发人员更早地测试和验证对代码库的更改。在代码变更被设置为触发自动构建之后，应该鼓励开发人员至少每天提交一次他们的代码。每日提交更频繁地触发自动化测试，因此开发人员可以更快地发现任何错误。

## 将配置用作部署流程的代码

Config as Code 表示您在基于 Git 的系统中的部署过程。部署继承了 Git 的所有优点，比如分支、版本控制和作为拉请求的批准。

Config as Code 允许您将部署过程存储在 Git 中。您可以在分支中测试对部署的更改，并通过拉请求来验证它们。基于 Git 的部署使得将部署设置从一个环境转移到另一个环境变得更加容易。

在 2022 年 Q1，我们发布了作为 Octopus Deploy 代码的 [Config，并相信我们设立了一个行业标准。其他配置为代码的解决方案牺牲了功能的可用性。在 Octopus 中，无论您使用 UI 还是版本控制的实现，您都可以通过代码获得 Config 的所有特性。](https://octopus.com/blog/octopus-release-2022-q1)

CI/CD 管道中的绿色构建意味着每个测试都通过了，并且发布已经进展到下一个阶段。软件团队的目标是保持构建绿色。

您应该选择一个展示信息的部署工具来帮助保持构建绿色。许多部署流程只使用一个构建服务器，将发布版本推入生产环境。实际上，仅使用构建服务器会使管理不同部署阶段之间的发布变得更加困难。使用专用的部署工具为您提供了一个专用的管理层来保持构建的绿色性。

构建服务器不包括部署阶段的概念。然而，Octopus Deploy 将一个发布分为测试、开发和生产环境，并且在每个阶段，环境可以存在于不同的发布版本中。我们的 UI 显示了每个版本的部署阶段，并在阶段之间转换版本。Octopus UI 还显示日志和错误消息，帮助开发人员快速识别失败的构建。

## 持续自动化您的测试

测试代码变更对于生产可靠的版本是必不可少的。测试套件应该覆盖产品的所有用例，从功能测试到非功能测试。这些测试应该是自动化的，这样代码变更就可以触发自动化的测试和构建。自动化测试提高了软件开发项目的敏捷性，从而更快地发布产品。

由 [Mabel 进行的一项关于 DevOps](https://www.dropbox.com/s/nnagymzdcnoswc6/Benchmark-Report-State-of-Testing-in-DevOps.pdf?dl=0) 测试状态的调查表明，自动化测试(至少 4 到 5 种不同类型的测试)是客户满意度的关键。在 [2021 年 DevOps DORA 报告](https://www.dropbox.com/s/xycst8qsxnpsieu/state-of-devops-2021.pdf?dl=0)中，持续测试是成功的一个指标。达到可靠性目标的精英级员工利用持续测试的可能性是普通员工的 3.7 倍。

## 通过监控加强反馈回路

开发人员使用遥测数据(日志、指标和跟踪)来了解他们系统的内部状态。遥测技术开启了可观测性，因此开发人员可以根据数据来修复他们的系统。当您拥有遥测数据时，您可以使用可观测性工具为您的系统添加监控功能。

监控关键系统指标有助于诊断系统漏洞并确定改进措施。在 DevOps 社区中， [DORA 指标](https://cloud.google.com/blog/products/devops-sre/using-the-four-keys-to-measure-your-devops-performance)被普遍认为是部署管道成功的关键指标。

Octopus 让您可以测量结果、比较项目状态，并通过 [DevOps 专注于 DORA 指标的洞察力](https://octopus.com/docs/insights)持续改进。

## 使用适用的技术

每年，都有一项新技术被人们宣称将彻底改变 IT 领域。无论是容器化、机器学习还是区块链，一些技术改变了游戏场，而另一些技术则太不成熟，无法产生真正的影响。在管理 CI/CD 渠道时，只选择适合用途的技术至关重要。

虽然云优先对某些部分来说是有意义的，但强迫所有东西都放在云上可能不是正确的解决方案。采用新技术可以带来显著的改进，但是当采用的成本超过收益时，采取谨慎的方法可以避免不必要的痛苦。

## 认真对待安全性

随着软件项目变得越来越大，安全风险随着更多的数据处理、用户和依赖性而增加。您的部署过程应该有一个安全策略。

许多云提供商，如 AWS、Azure 和 Google，都有内置的安全功能，如 IAM、secrets 和基于角色的权限。您可以使用这些特性来管理一些安全问题。

客户越来越关注安全性，公司需要投资 ISO 27001 和 SOC II 等认证，以证明他们符合安全法规。

2021 年 5 月 12 日，美国政府发布第 14028 号行政命令，“提高国家网络安全”。该命令要求政府软件项目的所有供应商提供软件材料清单(SBOM)。SBOMs 详细列出了所有的软件组件，以便政府可以对软件进行网络安全筛选。如果你想要一个如何制作一个 [SBOM](https://octopus.com/blog/what-are-sboms) 并将其附加到你的部署流程中的例子，我们创建了一个名为 [Octopus Workflow Builder](https://octopusworkflowbuilder.octopus.com/#/) 的免费工具可以帮到你。

## 结论

CI/CD 是 DevOps 模型的一部分，有助于将软件项目从代码带到客户面前。如果您在 DevOps 中工作并实施 CI/CD，您应该遵循管道的行业标准最佳实践。为了有所帮助，这篇文章涵盖了你可以用来充分利用 CI/CD 的 8 个最佳实践。

许多工具可以帮助您使用 CI/CD，从构建服务器和部署工具到监控解决方案。Octopus Deploy 作为连续部署解决方案适合 CI/CD，使复杂的部署变得更加容易。

要了解更多关于 CI/CD 的最佳实践，请查看我们的 [DevOps 工程师手册](https://octopus.com/devops/)。

愉快的部署！