<html>
<head>
<title>Self-hosted Octopus in a Cloud VM vs. Octopus Cloud - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>云虚拟机中的自托管Octopus与Octopus云- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/self-hosted-octopus-cloud-vm-vs-octopus-cloud#2022-07-07">https://octopus.com/blog/self-hosted-octopus-cloud-vm-vs-octopus-cloud#2022-07-07</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-hybrid-shift-to-cloud.png" class="zoom" data-title=""><img src="../Images/1d765f6ccf5e408836875a6f09757b30.png" class="img-fluid center" alt="Self-hosted Octopus in a Cloud VM vs. Octopus Cloud" data-original-src="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-hybrid-shift-to-cloud.png"/>T2】</a></p>

<p>考虑将Octopus迁移到云基础架构的客户向我们提出的一个常见问题是:</p>

<blockquote class="blockquote">
<p>我应该迁移到虚拟机上的Octopus服务器还是托管的Octopus云？</p>
</blockquote>

<p>在本帖中，我们来看看为什么你会选择其中一个。成本和安全是主要考虑因素，但我们也会考虑你如何使用八达通。</p>

<p><strong>章鱼云</strong>是指Octopus Deploy提供的章鱼云<a href="https://en.wikipedia.org/wiki/Software_as_a_service" class="alert-link" rel="nofollow"> SaaS </a>和<strong>章鱼云服务器</strong>是指Octopus Deploy的自托管版本。在本文的上下文中，<strong> Octopus服务器</strong>位于云中的一个虚拟机上。</p>





<h2 id="architecture">体系结构</h2>

<p>在我进入细节之前，让我们看一下我们正在讨论的Octopus的两个化身的架构。</p>

<p><strong>服务器</strong></p>

<p>Octopus服务器作为Windows服务运行；这提供了对<a href="https://octopus.com/docs/octopus-rest-api"> Octopus REST API </a>和<a href="https://octopus.com/docs/getting-started#the-octopus-web-portal"> Octopus门户网站</a>的访问。它连接到一个SQL Server数据库，并使用<a href="https://g.octopushq.com/MovingOctopusComponents" rel="nofollow">文件共享</a>来存储任务日志、工件和包。</p>

<p><strong>云</strong></p>

<p>Octopus Cloud使用一个运行在<a href="https://octopus.com/blog/octopus-cloud-v2-why-kubernetes"> AKS </a>上的Linux容器，数据库托管在Azure SQL中。文件共享使用Azure云存储。</p>

<h2 id="management">管理</h2>

<p>选择Octopus Cloud减少了您必须在Octopus实例上执行的管理任务的数量；然而，出于某些原因，您可能希望Octopus服务器提供更大的控制。</p>

<h3 id="retention-policies-and-storage">保留策略和存储</h3>

<p>Octopus <a href="https://g.octopushq.com/RetentionPolicies" rel="nofollow">保留策略</a>在所有Octopus实例上都有一个默认配置，我们建议查看它们以满足您的需求。</p>

<p><strong>服务器</strong></p>

<p>当您在虚拟机上配置Octopus服务器时，您选择Octopus用于服务器文件夹的存储。这意味着您可以为这些文件夹设置适合您的存储限制，并相应地配置保留策略。</p>

<p><strong>云</strong></p>

<p>章鱼云为大多数企业提供了充足的存储；然而，你可以使用的存储量有一个<a href="ttp://g.octopushq.com/AcceptableUsage" rel="nofollow">限制</a>。在法规遵从性要求长期保留的情况下，您可能会发现这是选择Octopus Server而不是Octopus Cloud的原因。</p>

<p>我们在Octopus实例管理页面的技术部分添加了监控。要查看详细信息，请登录您的Octopus帐户，然后在您的实例上，选择<span class="path">管理➜资源使用</span>。这是每24小时更新一次。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-limits.png" class="zoom" data-title=""><img src="../Images/e9e55f4398c78513433913c4be62e8aa.png" class="img-fluid center" alt="cloud-limits" data-original-src="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-limits.png"/>T2】</a></p>

<p>Octopus有一个对所有实例都可用的内置包存储库，除此之外，可以配置外部存储库提要来为您的<a href="https://g.octopushq.com/OnboardingPackageRepositoriesLearnMore" class="alert-link" rel="nofollow">部署包</a>服务。您可能会选择使用外部feed来帮助进行<a href="#regional-package-feeds" class="alert-link">多区域部署</a>，或者如果您的包feed存储需求相当大的话。</p>


<h3 id="maintenance-window">维护窗口</h3>

<p><strong>云</strong></p>

<p>章鱼云的一个伟大之处在于，你不必担心如何以及何时进行系统维护和升级。Octopus为您管理这些，您可以选择适合您的业务和地区的维护窗口。</p>

<p>中断窗口信息位于Octopus实例管理页面的技术部分:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-outage-window.png" class="zoom" data-title=""><img src="../Images/321ef6b387e8c524ee81d7e2a0486dbf.png" class="img-fluid center" alt="cloud-outage-window" data-original-src="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-outage-window.png"/>T2】</a></p>

<p><strong>服务器</strong></p>

<p>Octopus Server允许您更具体地确定何时执行系统维护和升级。如果您实施了<a href="https://g.octopushq.com/HighAvailability" rel="nofollow">高可用性</a>，那么您就可以在进行维护时实现零停机。一些客户选择通过使用章鱼的另一个实例<a href="https://g.octopushq.com/UpgradeOctopusWithOctopus" rel="nofollow">中的</a><a href="https://g.octopushq.com/OnboardingRunbooksLearnMore" rel="nofollow">run book</a>来自动化维护和升级任务。一个免费的Octopus Cloud实例适合这个任务。</p>

<h3 id="managing-infrastructure">管理基础设施</h3>

<p><strong>服务器</strong></p>

<p>有了Octopus Server，您可以使用适合您企业运营架构的基础设施，并且任何基础设施管理流程和策略都可以用于您的Octopus实例。因为您托管您的Octopus服务器，所以您有责任确保<a href="https://g.octopushq.com/ManagingInfrastructure" rel="nofollow">基础设施</a>运行良好、得到维护、可恢复并具有扩展能力。</p>

<p><strong>云</strong></p>

<p>使用Octopus Cloud可以让您从基础架构管理中后退一步。我们有责任确保基础架构的强健，并根据您的使用情况进行扩展。</p>

<h4 id="workers">工人</h4>

<p>Octopus服务器的<a href="https://g.octopushq.com/OnboardingWorkersLearnMore" rel="nofollow">默认工作池</a>和Octopus Cloud有明显的区别。</p>

<p><strong>服务器</strong></p>

<p>在Octopus Server中，<a href="https://g.octopushq.com/BuiltinWorker" rel="nofollow">默认工作器</a>是Octopus服务器本身，而Octopus Cloud不允许服务器执行外部操作。</p>

<p>当您使用Octopus服务器时，我们建议尽可能使用Worker来减少Octopus服务器上的资源使用，并且由于Octopus是在特权帐户下执行的，如果您可以以Worker的形式将工作卸载到另一台机器，那么为了增加安全性，这样做是明智的。</p>

<p><strong>云</strong></p>

<p>章鱼云从特定于其区域的工人池中租赁一台<a href="https://g.octopushq.com/DynamicWorkerPools" rel="nofollow">动态工人</a>机器。</p>

<h3 id="backups">备份</h3>

<p><strong>云</strong></p>

<p>备份是Octopus Cloud托管服务的一部分。备份数据库、内置软件包存储库和配置。如果您使用外部程序包馈送，则您有责任确保配置备份。</p>

<p><strong>服务器</strong></p>

<p>当作为Octopus服务器安装的一部分管理您的基础设施时，您可以设计您的<a href="https://g.octopushq.com/BackupRestore" rel="nofollow">备份</a>和恢复计划来匹配您现有的基础设施计划。</p>

<h3 id="monitoring">监视</h3>

<p>Octopus <a href="https://g.octopushq.com/Subscriptions" rel="nofollow">订阅</a>在Octopus Cloud和Octopus Server中都可以使用。您可以配置通知来通知您Octopus中的更改，例如，特定项目流程的更改、用户修改、部署目标的添加。有一个很长的名单。</p>

<p><a href="https://g.octopushq.com/RestAPI" rel="nofollow"> REST API </a>有一个<a href="https://g.octopushq.com/Reporting" rel="nofollow">报告</a>端点，您可以用它来创建一个仪表板，在Octopus云和Octopus服务器中都可用。</p>

<p>使用Octopus Server，您还可以通过向<em> nlog config </em>文件添加一个日志目标来<a href="https://help.octopus.com/t/how-can-i-configure-octopus-deploy-to-write-logs-to-a-centralized-logger-such-as-seq-splunk-or-papertrail/24551" rel="nofollow">向中央日志工具</a>发送日志。</p>

<h2 id="database">数据库ˌ资料库</h2>

<p><strong>云</strong></p>

<p>客户无法访问Octopus云数据库，因此与Octopus的所有交互都必须使用web界面或API来完成。最棒的是数据库维护、安全和修补都是由我们完成的。</p>

<p><strong>服务器</strong></p>

<p>云虚拟机上的Octopus服务器为您提供了几个数据库托管选项:</p>



<p>管理数据库的好处是，您可以选择更宽松的<a href="https://g.octopushq.com/RetentionPolicies" rel="nofollow">保留策略</a>，能够使用集群数据库，并管理自己的备份。</p>

<h2 id="security">安全性</h2>

<p><strong>云</strong></p>

<p>借助Octopus Cloud，我们可以保护基础设施并进行渗透测试，以确保Octopus实例的安全性和完整性。但是，您仍然要负责:</p>

<ul>
<li>如何将Octopus连接到您的基础设施。</li>
<li>你如何识别你的用户和控制他们在八达通的活动。</li>
<li>你如何处理八达通内的敏感信息。</li>
</ul>

<p><strong>服务器</strong></p>

<p>当你使用Octopus服务器时，你有责任<a href="https://octopus.com/docs/security/hardening-octopus">强化</a>Octopus实例基础设施。如果您需要遵守特定行业的法规，这种级别的控制可能是有益的。在这种情况下，您还需要承担以下责任:</p>

<ul>
<li>如何强化底层服务器操作系统。</li>
<li>如何保护操作系统上的Octopus服务器文件。</li>
<li>你如何储存八达通服务器生成的文件。</li>
<li>你如何保护你的SQL数据库和八达通服务器产生的数据。</li>
<li>你如何将你的Octopus服务器暴露给你的基础设施？</li>
<li>你如何识别你的用户和控制他们在八达通的活动。</li>
<li>你如何处理八达通内的敏感信息。</li>
</ul>

<p>当向Octopus云或Octopus服务器基础设施添加部署目标和工作机时，它们的安全性和完整性是您的责任。</p>


<h3 id="authentication-providers">身份验证提供商</h3>

<p><strong>云</strong></p>

<p>章鱼云<a href="https://g.octopushq.com/AuthenticationProviders" rel="nofollow">认证</a>使用<a href="https://g.octopushq.com/AuthOctopusID" rel="nofollow">章鱼ID </a>，允许你使用在<a href="https://octopus.com" rel="nofollow">octopus.com</a>登录时使用的同一个账户。Octopus ID支持用户名和密码，也可以使用谷歌或微软账户。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/octopus-id.png" class="zoom" data-title=""><img src="../Images/bc9fc5be39981bbc470f1596e7a91c57.png" class="img-fluid center" alt="octopus-id" data-original-src="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/octopus-id.png"/>T2】</a></p>

<p>Octopus ID允许Octopus用户映射到Google或Microsoft帐户，但是它不允许映射到外部组，这在Active Directory中是可能的。</p>

<p><strong>服务器</strong></p>

<p>Octopus服务器有几个可用的身份验证提供程序:</p>



<p>可以同时配置多个提供程序。</p>

<h3 id="ip-restrictions">IP限制</h3>

<p><strong>云</strong></p>

<p>一个Octopus云实例有一系列在同一个Azure区域的客户之间共享的静态IP地址。这些可以在Octopus实例管理页面的技术部分找到:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-ips.png" class="zoom" data-title=""><img src="../Images/b5ff54fa458437bcb7015dca50898332.png" class="img-fluid center" alt="cloud-ips" data-original-src="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-ips.png"/>T2】</a></p>

<p><strong>服务器</strong></p>

<p>当您在虚拟机上使用Octopus服务器时，您可以配置适合您业务需求的IP和DNS。您可以选择配置一个负载平衡器来处理Octopus web接口的流量；如果您配置了<a href="#high-availability">高可用性</a>，这将非常有用。</p>

<h3 id="organize-projects-and-environments">组织项目和环境</h3>

<p><a href="https://octopus.com/docs/administration/spaces">空间</a>在八达通云和八达通服务器上都可用。空间在项目和基础设施之间建立了一堵硬墙，因此您的每个团队只能访问他们需要的项目和基础设施。</p>

<p><strong>服务器</strong></p>

<p>并发许可证是Octopus Server的一个额外好处。每个许可证可以使用三个实例，这意味着您可以运行一个Octopus Deploy服务用于生产，并为开发或测试设置额外的服务。或者，您可以使用两个单独的Octopus部署实例来隔离生产和生产前部署。</p>

<h2 id="networking">建立工作关系网</h2>

<p>通过WebSockets将<a href="https://g.octopushq.com/PollingTentacle" rel="nofollow">轮询触角</a>连接到Octopus Cloud目前是不可能的，但我们确实计划很快支持轮询触角连接到443端口。</p>

<h3 id="proxy-support">代理支持</h3>

<p>章鱼服务器和章鱼云都支持<a href="https://g.octopushq.com/ProxySupport" rel="nofollow">代理</a>。您可以为Octopus指定一个代理服务器，以便在与触手或SSH目标通信时使用。当触手和Octopus服务器向其他服务器发出web请求时，您也可以指定一个代理服务器。</p>

<h2 id="region">地区</h2>

<p><strong>服务器</strong></p>

<p>在虚拟机上使用Octopus服务器可以让您在自己选择的地理区域托管Octopus实例。</p>

<p><strong>云</strong></p>

<p>Octopus Cloud还为您提供了在适合您的地区托管实例的选项。我们使用Microsoft Azure托管Octopus Cloud，在撰写本文时，我们提供以下区域:</p>

<ul>
<li>美国西部2</li>
<li>西欧</li>
<li>澳大利亚东部</li>
</ul>

<p>当您第一次创建Octopus云实例时，会选择该区域。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-region.png" class="zoom" data-title=""><img src="../Images/f46d88ad6a2d8b7db7300bdb50f3eb30.png" class="img-fluid center" alt="cloud-region" data-original-src="https://i.octopus.com/blog/2020-06/self-hosted-octopus-cloud-vm-vs-octopus-cloud/cloud-region.png"/>T2】</a></p>

<p>如果我们推出更适合您需求的新区域，请联系我们，以便我们将您的实例转移到该区域。</p>

<h3 id="regional-package-feeds">区域套餐订阅源</h3>

<p>如果您在多个地区运营，并且担心在部署期间传输大型包时出现网络延迟问题，我们建议您选择外部<a href="https://g.octopushq.com/OnboardingPackageRepositoriesLearnMore" rel="nofollow">包馈送</a>并在多个地区复制它。通过DNS别名，您可以让触手从地理上本地的包存储库中获取包。或者您可以拥有两个独立但相同的包存储库，并使用一个<a href="https://g.octopushq.com/DynamicPackageFeeds" rel="nofollow">变量作为提要ID </a>。对于<strong> Octopus Server </strong>和<strong> Octopus Cloud </strong>，包存储库都以这种方式工作。</p>

<h2 id="high-availability">高可用性</h2>

<p><a href="https://g.octopushq.com/HighAvailability" rel="nofollow">可以为Octopus服务器配置高可用性</a> (HA)来运行多个Octopus服务器，在它们之间分配负载和任务。</p>

<p>Octopus HA不可用于Octopus Cloud，但所有实例都被配置为运行在AKS  (Azure的托管Kubernetes)上的<a href="https://octopus.com/blog/octopus-cloud-v2-why-kubernetes"> Linux容器。</a><a href="https://kubernetes.io/" rel="nofollow"> Kubernetes </a>帮助我们实现章鱼云的弹性和伸缩灵活性。</p>

<h2 id="other-considerations">其他考虑</h2>

<h3 id="tentacles">触须</h3>

<p>章鱼触手机器可以配置为<a href="https://g.octopushq.com/PollingTentacle" rel="nofollow">轮询</a>或<a href="https://g.octopushq.com/ListeningTentacle" rel="nofollow">监听</a>通信模式。您为部署选择的触角类型将取决于您的业务需求。您还应该考虑这些机器的配置是否对您的Octopus实例所选择的基础设施有任何影响。</p>

<h4 id="tentacle-firewall-rules">触手防火墙规则</h4>

<p>你使用的触手类型将取决于你的防火墙规则。侦听触手必须具有入站防火墙规则，以允许通过TCP端口10933进行访问。轮询触手不需要触手上的任何防火墙规则，但是Octopus服务器必须允许通过TCP端口10943上的防火墙入站访问。侦听触手使用较少的资源，但是如果您使用动态IPs或者触手位于NAT之后，轮询触手将是必需的。</p>

<p>您需要将这些规则应用于任何中间防火墙。</p>

<h3 id="octopus-in-a-container">容器中的章鱼</h3>

<p>在虚拟机上运行Octopus服务器的另一种方法是在容器中运行它。事实上，这就是我们管理Octopus云实例的方式。用于Octopus的<a href="https://g.octopushq.com/DockerWindows" rel="nofollow"> Windows容器</a>得到了完全支持，而<a href="https://g.octopushq.com/DockerLinux" rel="nofollow"> Linux容器</a>在撰写本文时是我们早期访问计划的一部分。</p>

<h2 id="conclusion">结论</h2>

<p>这篇文章有望为您迁移到云基础设施的决策过程提供清晰的思路。无论您的业务需求是什么，Octopus Deploy使发布管理变得容易，并且简化了即使是最复杂的部署，无论您在哪里部署您的软件。Runbook automation最大限度地减少停机，并让您能够控制基础架构和应用。</p>

<p>如果你有任何问题或者想知道如何让八达通为你服务，请给我们写信，地址是<a href="mailto:advice@octopus.com" rel="nofollow">advice@octopus.com</a></p>

<h2 id="more-information">更多信息</h2>



                    
                    
</body>
</html>