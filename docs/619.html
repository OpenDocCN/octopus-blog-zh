<html>
<head>
<title>Request for Comments - Dynamic infrastructure - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>征求意见-动态基础设施-八达通部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/rfc-dynamic-infrastructure#2022-02-10">https://octopus.com/blog/rfc-dynamic-infrastructure#2022-02-10</a></blockquote>
                        <p>云提供商使供应新的基础设施变得容易。这意味着可以轻松启动环境来测试新功能或为客户进行演示。然而，保持你的Octopus目标同步可能是有挑战性的，因为这个基础设施来来去去。</p>

<p>Octopus目前提供了一个<a href="https://octopus.com/docs/infrastructure/deployment-targets/dynamic-infrastructure">动态基础设施</a>特性，允许您在部署过程中注册目标。我们给你必要的部件，你把它们粘在一起以满足你的要求。这包括定制脚本、处理输出变量和切换设置。</p>

<p>这种复杂性使它成为一个专家用例，需要多次尝试将所有东西按正确的顺序排列。对于许多用户来说，手动注册这些目标更容易。因为功能不清楚，有些人甚至不知道还有另一种方法。</p>

<p>我们想改变这一切。我们希望利用用户已经与他们的云提供商和Octopus交互的方式，创建一个感觉不显眼和直观的解决方案。</p>

<h2 id="our-solution">我们的解决方案</h2>

<p>我们希望Octopus为您的部署找到并注册目标。我们已经分解出关键部分，使其全部工作。</p>

<h3 id="tag-driven-target-discovery">标签驱动的目标发现</h3>

<p>我们将在需要时发现目标，而不是直接在Octopus中注册部署目标。</p>

<p>您将对您的云资源应用标记来表示您的意图，Octopus将在执行您的部署过程时发现并注册这些目标。</p>

<p>首先，您的资源将需要两个标签:<code>octopus-environment</code>和<code>octopus-role</code>来分别表示环境和角色。您还可以指定标签来限制项目、空间和租户的发现。</p>

<h3 id="authentication-context">认证上下文</h3>

<p>为了发现目标，Octopus需要向合适的云提供商进行认证。您将能够使用Octopus变量提供这种上下文。例如，您将能够配置一个名为<code>Octopus.Azure.Account</code>的变量来引用Azure帐户以用于发现。默认情况下，我们将在发现过程中将身份验证上下文中的帐户链接到目标。</p>

<p>为此，我们喜欢使用变量，因为它们具有完善的作用域行为，可用于为每个适用的作用域配置不同的帐户。例如，您可以通过环境来确定范围，确保测试和生产环境使用不同的身份验证上下文。</p>

<h3 id="target-lifecycle">目标生命周期</h3>

<p>云的一个关键优势是，当您使用完新环境时，可以非常轻松地启动新环境并拆除它们。Octopus将跟踪这些发现的目标，如果它们不再存在，就将它们清理掉。如果由于某种原因，他们回来了，Octopus将重新发现他们，以便进行下一次部署。</p>

<h2 id="faq">FAQ</h2>

<h3 id="will-all-my-cloud-resources-become-targets-in-octopus">我所有的云资源会成为Octopus中的目标吗？</h3>

<p>不会。只有映射到内置步骤使用的Octopus目标的资源才会被发现。Octopus还需要资源来设置标签<code>octopus-role</code>和<code>octopus-environment</code>。Octopus会在发现过程中忽略任何没有这些标签的资源。</p>

<h3 id="will-the-traditional-way-of-working-with-deployment-targets-still-work">传统的处理部署目标的方式还有效吗？</h3>

<p>现有的自定义脚本将继续工作，用于创建新目标的PowerShell commandlets将保持不变。迁移到这种新方法只会涉及:</p>

<ul>
<li>在您的云资源上设置适当的标签</li>
<li>删除现有的脚本步骤</li>
<li>配置身份验证上下文变量</li>
</ul>

<p>目标仍然可以手动注册。</p>

<h3 id="will-all-my-targets-be-automatically-deleted-if-theyre-not-found">如果找不到我的所有目标，它们会被自动删除吗？</h3>

<p>只有通过此机制发现而创建的目标才会被自动删除。通过UI或现有commandlets创建的目标将像现在一样工作。</p>

<h3 id="what-if-i-need-to-use-different-accounts-for-deployment-and-discovery">如果我需要使用不同的帐户进行部署和发现，该怎么办？</h3>

<p>您可以通过设置其他标签来指定Octopus配置目标所需的额外细节。例如，要在部署到资源时使用不同的帐户，您可以指定<code>octopus-account</code>标记来引用Octopus中所需的帐户。</p>

<h3 id="what-targets-will-be-supported">将支持哪些目标？</h3>

<p>最初，我们将致力于支持Azure Web应用、服务架构和AWS ECS集群。然后，随着我们在未来一年扩大对更多云目标的支持，我们将确保他们为动态基础架构做好准备。</p>

<p>我们计划接下来支持在AWS、Azure和Google Cloud上发现Kubernetes容器。</p>

<h3 id="will-aws-instanceassumed-roles-be-supported">是否支持AWS实例/假定角色？</h3>

<p>Octopus目前为AWS认证提供了广泛的选择。除了使用访问密钥和秘密密钥的帐户之外，我们还支持承担IAM角色并使用分配给Worker的角色。</p>

<p>我们仍在研究如何最好地支持这一点，并在依赖实例角色时平衡工人池依赖性。</p>

<h2 id="we-want-your-feedback">我们需要您的反馈</h2>

<p>我们正在积极开发这一功能，并希望采纳您的反馈。我们已经创建了一个<a href="https://github.com/OctopusDeploy/StepsFeedback/issues/8" rel="nofollow"> Github问题</a>来收集您的评论。</p>

<p>具体来说，我们想知道:</p>

<ul>
<li>关于标记方面我们可能没有预料到的边缘情况</li>
<li>该解决方案适合您的使用情形吗？</li>
<li>你希望Octopus解决其他动态基础设施挑战吗？</li>
</ul>

<p>这些反馈将有助于我们提供最佳解决方案。</p>

<p><span> <a class="btn btn-success" href="https://github.com/OctopusDeploy/StepsFeedback/issues/8">提供反馈</a> </span></p>

<h2 id="conclusion">结论</h2>

<p>总之，我们改进动态基础设施的计划包括:</p>

<ul>
<li>定义在云资源上使用的标签，以描述发现过程中的意图</li>
<li>通过具有众所周知的名称的变量提供认证上下文</li>
<li>在部署过程中注册目标</li>
<li>清理云中不再存在的旧目标</li>
</ul>

<p>感谢阅读。我们希望您和我们一样对这项功能将释放的潜力感到兴奋。</p>

<p>非常感谢您的任何反馈。</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>