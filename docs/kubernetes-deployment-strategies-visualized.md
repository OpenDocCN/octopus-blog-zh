# Kubernetes 部署策略可视化- Octopus 部署

> 原文：<https://octopus.com/blog/kubernetes-deployment-strategies-visualized>

[![Kubernetes deployment strategies](img/121936dee45ef56035fd72ecdba66155.png)](#)

Kubernetes 为管理员和开发人员提供的好处之一是能够智能地管理新软件或配置的部署。

Kubernetes 包括两个内置的部署策略，称为*重建*和*滚动更新*，它们直接配置在部署资源上。Octopus 提供了第三种 Kubernetes 部署策略，称为*蓝绿色*，通过*部署 Kubernetes 容器*步骤进行管理。

但是这些策略实际上是干什么的呢？在这篇博文中，我们将可视化这些部署策略，以突出它们的差异，并说明为什么您会选择一种策略而不是另一种。

## 测试部署

在下面的视频中，我们将观看在多节点 Kubernetes 集群上更新的部署。集群中的每个节点都有一个唯一的标签，部署会更新以将新的 pod 放在特定的节点上。

最终结果是新的部署将 pod 从一个节点转移到另一个节点。然后，我们可以观察 pod 如何在节点之间移动，以了解不同部署策略的效果。

## Kubernetes 部署再造战略

Kubernetes 部署*重建*策略是三种策略中最简单的。当使用*重建*策略配置的部署被更新时，Kubernetes 将首先从现有部署中删除 pod，一旦这些 pod 被删除，新的 pod 将被创建。

在上面的视频中，您可以看到节点 1 上的所有 pod 都被删除，只有在它们被删除后，第二个节点上的新 pod 才会被创建。

*重建*策略确保新旧 pod 不会同时运行。当同步对不支持从两个不同客户端版本访问的后端数据存储库的更改时，这可能是有益的。然而，在新的 pod 开始接受流量之前，有一段停机时间。

## Kubernetes 滚动更新

顾名思义，Kubernetes *滚动更新*策略是在拆除旧单元的同时逐步部署新单元。您可以在上面的视频中看到这一点，在第一个节点上的许多 pod 被删除，同时在第二个节点上创建新的 pod。最终，第一个节点上的 pod 将被全部删除，而所有新的 pod 将在第二个节点上创建。

*滚动更新*策略确保在更新期间有一些 pod 可用于继续服务流量，因此没有停机时间。但是，在进行更新时，新旧 pod 会并排运行，这意味着任何数据存储或客户端都必须能够与两个版本进行交互。

## Kubernetes 蓝绿色部署

与其他部署策略不同，Kubernetes *蓝绿色*部署策略不是 Kubernetes 自己实现的。它包括创建全新的部署资源(即，具有新名称的部署资源)，等待新部署就绪，将流量从旧部署切换到新部署，最后删除旧部署。这个过程通过*部署 Kubernetes 容器*步骤在 Octopus 中实现。

在上面的视频中，您可以看到在蓝/绿部署期间，第二个节点上的单元被部署和初始化，当它们准备好时，第一个节点上的单元被删除。

*蓝/绿*策略确保新部署在任何流量发送到它之前完全初始化并保持健康。如果新部署失败，旧部署将继续为流量提供服务。

与*滚动更新*策略一样，*蓝/绿*策略在一段时间内并排部署两个版本，因此任何后备数据存储都需要支持两个不同的客户端。但是，通过在新部署就绪时将所有流量转移到新部署，任何时候都只能访问一个版本的部署。

## 结论

选择正确的部署策略对于确保您的 Kubernetes 更新的可靠性以及消除或最小化停机时间至关重要。可视化可用的更新策略有助于理解它们之间的差异，在这篇文章中，我们看到了如何使用 Kubernetes 的本地策略 *recreate* 和 *rolling updates* 来创建和销毁 pod，然后使用 Octopus 实现的 *blue/green* 策略。