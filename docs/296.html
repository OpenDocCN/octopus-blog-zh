<html>
<head>
<title>Introducing Google Cloud Platform integration for Octopus Deploy - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>介绍Octopus Deploy的Google云平台集成- Octopus Deploy</h1>
<blockquote>原文：<a href="https://octopus.com/blog/google-cloud-platform-integration#2021-11-10">https://octopus.com/blog/google-cloud-platform-integration#2021-11-10</a></blockquote>
                        <p>根据我们的<a href="https://octopus.com/company/roadmap">公开路线图</a>，我们引入了对<a href="https://cloud.google.com/" rel="nofollow">谷歌云平台(GCP) </a>的内置支持。</p>

<p>随着这一增加，Octopus现在为三大云提供商提供内置支持:</p>



<p>这满足了我们客户不断变化的需求，特别是那些拥有GCP Kubernetes集群并在GCP虚拟机上运行触角的客户。</p>

<p>Octopus与GCP的内置集成允许您:</p>

<ul>
<li>通过专用帐户类型连接到GCP并进行身份验证-这允许您集中和保护您的GCP身份验证，并在您的部署和操作手册中使用它</li>
<li>在现成的定制脚本中使用GCP命令行工具<a href="https://cloud.google.com/sdk/gcloud" rel="nofollow"> gcloud </a></li>
<li>用<a href="https://www.terraform.io/" rel="nofollow">地形</a>创建和拆除GCP的基础设施</li>
<li>访问由<a href="https://cloud.google.com/container-registry" rel="nofollow">谷歌容器注册中心(GCR) </a>托管的Docker图像</li>
<li>使用Octopus和Kubernetes在GCP部署、扩展和管理容器化应用程序</li>
</ul>

<p>GCP集成在Octopus Deploy 2021.2和更新版本中可用。Octopus Cloud客户已经在运行该版本，内部客户现在可以<a href="https://octopus.com/downloads">下载该版本</a>。</p>

<p>在我们的<a href="https://octopus.com/blog/octopus-release-2021-q3">发布公告</a>中了解更多关于Octopus 2021.2 (Q3)发布的信息。</p>

<h2 id="how-to-deploy-to-google-cloud">如何部署到谷歌云</h2>

<p>为了看到这种新的集成，这篇文章解释了如何在Octopus中添加一个新的Google Cloud帐户，并运行一个<code>gcloud</code>脚本来创建一个新的Kubernetes集群。</p>

<h3 id="google-cloud-accounts">谷歌云账户</h3>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-09/google-cloud-platform-integration/google-cloud-deployer.png" class="zoom" data-title=""><img src="../Images/d54ac9e5a323e01170af3ac2e300ccdc.png" class="img-fluid center" alt="Google Cloud deployer" data-original-src="https://i.octopus.com/blog/2021-09/google-cloud-platform-integration/google-cloud-deployer.png"/>T2】</a></p>

<p>要与GCP整合，首先要在Octopus中定义一个谷歌云账户。在<strong> <span class="path">基础设施➜账户</span> </strong>中这样做，以及你已经拥有的任何AWS或Azure账户。</p>

<p>Octopus管理Google Cloud steps使用的GCP凭证。这意味着您不需要担心部署过程或runbook中的认证，并且您可以运行预认证的<code>gcloud</code>脚本。</p>

<p>Google Cloud帐户受到JSON凭证密钥文件的保护，该文件可以从分配给执行部署的实例的服务帐户中检索到。</p>

<p>了解关于<a href="https://octopus.com/docs/infrastructure/accounts/google-cloud">创建谷歌云账户</a>的更多信息，并查看<a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys" rel="nofollow">谷歌云文档</a>以获取关于创建服务账户和下载密钥文件的说明。</p>

<h3 id="google-cloud-account-variable">Google云帐户变量</h3>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-09/google-cloud-platform-integration/google-cloud-variables.png" class="zoom" data-title=""><img src="../Images/11fa4e4b243c4e69b960587f135ca5c4.png" class="img-fluid center" alt="Octopus Google Cloud account" data-original-src="https://i.octopus.com/blog/2021-09/google-cloud-platform-integration/google-cloud-variables.png"/>T2】</a></p>

<p>创建Google Cloud帐户后，可以通过类型为<strong> Google Cloud Account </strong>的<a href="https://octopus.com/docs/projects/variables">项目变量</a>在项目中访问它们。项目变量可用于部署和运行手册流程。</p>

<p>在我们的文档中了解有关设置<a href="https://octopus.com/docs/projects/variables/google-cloud-account-variables"> Google Cloud帐户变量</a>的更多信息。</p>

<h4 id="running-gcloud-scripts">运行gcloud脚本</h4>

<p>Octopus Deploy帮助你用Google云平台在目标上运行脚本。在本例中，我们创建了一个新的Kubernetes集群。</p>

<p>这些脚本通常依赖于目标工作人员可用的工具，但是有几个选项可以快速启动:</p>

<ul>
<li>如果你用的是章鱼云，内置的“Windows 2016”<a href="https://octopus.com/docs/infrastructure/workers/dynamic-worker-pools">动态工人</a>已经预装了<code>gcloud</code>。</li>
<li>另一个选项是使用Octopus <a href="https://hub.docker.com/r/octopusdeploy/worker-tools" rel="nofollow"> <code>worker-tools</code> </a> Docker图像和用于workers 的<a href="https://octopus.com/docs/projects/steps/execution-containers-for-workers">执行容器。</a></li>
<li>一般来说，我们建议为您的员工提供您自己的工具。这使您可以控制工具版本，并可以确保它们与您试图执行的脚本兼容。</li>
</ul>

<p>工人将部署工作从Octopus服务器转移到工人池中运行的其他机器上。Octopus Cloud使用它们来执行定制脚本，它们也通常用于运行云平台和数据库部署的部署和运行手册工作。</p>
<p>阅读我们关于<a href="https://octopus.com/docs/infrastructure/workers" class="alert-link">工人</a>和<a href="https://octopus.com/docs/infrastructure/workers/worker-pools" class="alert-link">工人池</a>的文档来了解更多。</p>


<p>当对GCP执行脚本时，Octopus会自动使用您提供的Google Cloud帐户信息向目标实例验证您的身份。或者，您可以使用与目标实例关联的服务帐户。</p>

<p>【T2 <img src="../Images/2af2262100a16857bfd5528943d6b55f.png" class="img-fluid center" alt="Google Cloud script step" data-original-src="https://i.octopus.com/blog/2021-09/google-cloud-platform-integration/google-cloud-script-step.png"/></p>

<p>在本例中，您添加了一个新的<a href="https://octopus.com/docs/runbooks"> runbook </a>流程，以使用<code>gcloud</code>命令行界面创建一个新的Kubernetes集群。</p>

<p>为此，使用一个<code>gcloud container clusters create</code>命令将脚本中的<strong>Run g cloud</strong>步骤添加到您的自动化流程中。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-09/google-cloud-platform-integration/google-cloud-source-code.png" class="zoom" data-title=""><img src="../Images/c1262867767435e349e33fca53e51caa.png" class="img-fluid center" alt="Google Cloud source code" data-original-src="https://i.octopus.com/blog/2021-09/google-cloud-platform-integration/google-cloud-source-code.png"/>T2】</a></p>

<p>您需要根据自己的需要定制脚本，但它应该是这样的:</p>

<pre><code class="language-sh">echo "Create cluster"
gcloud container \
    --quiet \
    clusters create $(get_octopusvariable "Cluster Name") \
    --no-enable-basic-auth \
    --cluster-version "1.20.6-gke.1000" \
    --release-channel "regular" \
    --machine-type "e2-medium" \
    --image-type "COS" \
    --disk-type "pd-standard" \
    --disk-size "100" \
    --metadata disable-legacy-endpoints=true \
    --scopes "https://www.googleapis.com/auth/devstorage.read_only","https://www.googleapis.com/auth/logging.write","https://www.googleapis.com/auth/monitoring","https://www.googleapis.com/auth/servicecontrol","https://www.googleapis.com/auth/service.management.readonly","https://www.googleapis.com/auth/trace.append" \
    --num-nodes "3" \
    --enable-stackdriver-kubernetes \
    --enable-ip-alias \
    --network "projects/&lt;your project&gt;/global/networks/default" \
    --subnetwork "projects/&lt;your project&gt;/regions/australia-southeast1/subnetworks/default" \
    --default-max-pods-per-node "110" \
    --no-enable-master-authorized-networks \
    --addons HorizontalPodAutoscaling,HttpLoadBalancing,GcePersistentDiskCsiDriver \
    --enable-autoupgrade \
    --enable-autorepair \
    --max-surge-upgrade 1 \
    --max-unavailable-upgrade 0 \
    --enable-shielded-nodes
</code></pre>

<h2 id="conclusion">结论</h2>

<p>我们希望你喜欢在谷歌云平台上部署基础设施。</p>

<p>试试吧，让我们知道你的想法。如果您有任何问题或意见，我们很乐意倾听。请使用下面的评论区或加入<a href="https://octopus.com/slack">章鱼社区Slack </a>的对话。</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>