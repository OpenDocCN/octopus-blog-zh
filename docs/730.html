<html>
<head>
<title>Cleaning temporary ASP.NET files - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>清理临时ASP.NET文件- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/temporary-asp-net-files#2015-09-25">https://octopus.com/blog/temporary-asp-net-files#2015-09-25</a></blockquote>
                        <p>绝大多数的ASP.NET网站和网络应用程序都使用<a href="http://msdn.microsoft.com/en-us/library/vstudio/ms366723.aspx">动态编译</a>来编译应用程序的某些部分。通过动态编译为ASP.NET网站创建的程序集存储在<code>Temporary ASP.NET files</code>目录中。随着时间的推移，这些临时文件会越来越多，必须手动删除。作为<a href="http://msdn.microsoft.com/en-us/library/ms404279.aspx">影像复制</a>的一部分，网站bin目录的副本也存储在该文件夹中。Octopus Deploy的许多用户也比以前更频繁地使用持续集成或发布。这反过来意味着这些临时文件可以积累得相当快。</p>

<p>除了留给手动流程，我们还有一些方法可以在部署后清理。要清理这个目录，您可以使用来自<a href="https://library.octopusdeploy.com/"> Octopus Deploy库</a>的<a href="https://library.octopusdeploy.com/#!/step-template/actiontemplate-file-system-clean-asp-net-temp-files">文件系统-清理ASP.NET临时文件</a> PowerShell脚本模板。作为部署过程中的一个步骤，该脚本将允许您清理临时文件目录。</p>

<h2>如何使用脚本</h2>

<p>从库中导入步骤并将该步骤添加到项目中之后，您可以配置框架版本和要保留的天数。</p>

<p><img src="../Images/b6d870eb8eb1f67dfa0e2f3f73af93bf.png" alt="Step details" data-original-src="https://i.octopus.com/blog/migrated/Step-Clean-Temp_gcca98.png"/></p>

<p>该步骤只需要两个参数<code>Framework version</code>和<code>Days to keep</code>。默认情况下，它会清理网站目录下的<code>Temporary ASP.NET files</code>目录超过30天。</p>

<p><strong>框架版本</strong></p>

<p>指定<code>All</code>将清除每个已安装的框架版本的临时文件。如果需要针对特定版本，可以指定位和/或版本。</p>

<p>仅指定一个位值将匹配所有版本。在这里，您只能指定以下两个选项之一。</p>

<pre><code> - Framework
 - Framework64
</code></pre>

<p>仅指定一个版本将与该版本匹配，而不考虑位(32位和64位)。版本必须始终以<code>v</code>开头。</p>

<pre><code> - v1.1.4322
 - v2.0.50727
</code></pre>

<p>完全指定的框架版本将只匹配该路径。</p>

<pre><code> - Framework\v4.0.30319
 - Framework64\v4.0.30319
</code></pre>

<p><strong>保留天数</strong></p>

<p>如果网站目录的上次写入时间超过了指定的保留天数，它将被删除。该目录在应用程序启动时创建。</p>

<h2>脚本是如何工作的</h2>

<p><code>Temporary ASP.NET files</code>下的目录结构由映射到应用程序名的目录组成，应用程序名是虚拟路径名或根目录。在这个目录下，每个网站的每个<em>版本</em>都有一个代码生成目录。该脚本将只识别删除代码生成目录。代码生成目录也是<code>Days to keep</code>用来保留的。</p>

<p>删除临时ASP.NET文件是一项安全的操作，请记住，多个网站可以使用此文件夹，并且当前正在使用的网站可能会被回收。</p>

<p>您可以在部署之前或之后执行脚本。但是，建议您在部署之前运行该脚本，因为即使在部署完成后，以前的部署可能仍在使用中。任何包含锁定文件的代码生成目录都将被跳过。</p>

<h2>还有其他解决方法吗</h2>

<p>如果您有多个网站，或者需要尽可能避免停机配置，可以使用自定义编译目录来隔离每个网站的代码生成目录。您可以使用web.config中的<code>compilation</code>标签上的<code>tempDirectory</code>属性指定一个定制的临时文件目录</p>

<pre><code>&lt;configuration&gt; 
    &lt;system.web&gt;    
        &lt;compilation tempDirectory="C:\TempAspNetFiles\"&gt;
        &lt;/compilation&gt;
    &lt;/system.web&gt;
&lt;/configuration&gt; 
</code></pre>

<h2>什么时候该担心这个？</h2>

<p>如果您正在进行频繁的部署，或者您需要高度健壮的部署，您只需要担心这一点。其他要考虑的因素是您部署了多少站点、bin目录的大小、部署的频率以及您有多少磁盘空间。</p>

                    
                    
</body>
</html>