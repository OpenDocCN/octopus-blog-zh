<html>
<head>
<title>Installing Minikube on Windows - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Windows上安装Minikube-Octopus Deploy</h1>
<blockquote>原文：<a href="https://octopus.com/blog/minikube-on-windows#2021-08-12">https://octopus.com/blog/minikube-on-windows#2021-08-12</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/installing_minikube_on_windows.png" class="zoom" data-title=""><img src="../Images/a875af2e890d15ece8cd2dc050a6a176.png" class="img-fluid center" alt="Octopus driving a Kubernetes speedboat" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/installing_minikube_on_windows.png"/>T2】</a></p>

<p>多亏了<a href="https://kubernetes.io/docs/tasks/tools/install-minikube/" rel="nofollow"> Minikube项目</a>，开始测试Kubernetes集群变得更加容易。通过使用Windows 10中的HyperV功能，只需几分钟就可以创建一个测试Kubernetes集群。</p>

<p>在本文中，我们将介绍配置HyperV、安装<code>kubectl</code>和Minikube以及与测试Kubernetes集群交互的过程。</p>

<h2 id="create-an-external-switch">创建外部交换机</h2>

<p>Minikube需要一个外部HyperV开关来操作，你可能会发现你默认没有。</p>

<p>要查看开关列表，打开<code>HyperV Manager</code>并从动作列表中选择<code>Virtual Switch Manager...</code>:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/hyperv-actions-01.png" class="zoom" data-title=""><img src="../Images/faad06f87c137b5433d69292b9aed1c1.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/hyperv-actions-01.png"/>T2】</a></p>

<p><em>hyper v操作菜单。</em></p>

<p>在下面的屏幕截图中，您可以看到没有现有的外部交换机，因此我们需要通过选择<code>External</code>选项并单击<code>Create Virtual Switch</code>按钮来创建一个:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/create-virtual-switch.png" class="zoom" data-title=""><img src="../Images/a612fbfb7c4130daaaf35d13f0bc2616.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/create-virtual-switch.png"/>T2】</a></p>

<p><em>现有交换机列表。</em></p>

<p>将虚拟交换机连接到电脑的本地网络适配器(在本例中为无线网络适配器)。点击<code>OK</code>按钮创建开关:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/vswitch.png" class="zoom" data-title=""><img src="../Images/f39262e868207c0bb7e8f1e17930f2c2.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/vswitch.png"/>T2】</a></p>

<p><em>创建新的HyperV外部交换机。</em></p>

<p>您将收到网络连接将被中断的警告。点击<code>Yes</code>继续。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/warning-01.png" class="zoom" data-title=""><img src="../Images/fe6e2d58c0ee812fe6db92d3196f61e0.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/warning-01.png"/>T2】</a></p>

<p><em>创建新交换机导致网络中断的警告。</em></p>

<h2 id="install-kubectl">安装kubectl</h2>

<p>我们用来与Kubernetes交互的命令行工具叫做<code>kubectl</code>，我们将在配置Minikube之前安装它。<code>kubectl</code>有两种安装方式:</p>





<h2 id="install-minikube">安装Minikube</h2>

<p>我们现在准备安装Minikube。您可以通过两种方式安装Minikube:</p>

<ul>
<li>用<a href="https://chocolatey.org/packages/Minikube" rel="nofollow">巧克力</a>使用命令<code>choco install minikube</code>。</li>
<li>从<a href="https://github.com/kubernetes/minikube/releases/latest/download/minikube-installer.exe" rel="nofollow"> GitHub </a>下载并安装可执行文件。</li>
</ul>

<p>安装Minikube后，以管理员身份打开PowerShell终端:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/run-as-administrator.png" class="zoom" data-title=""><img src="../Images/633f5bb73240d9cd90bb2bf6fd506c22.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/run-as-administrator.png"/>T2】</a></p>

<p><em>以管理员身份启动终端。</em></p>

<p>然后，可以使用以下命令启动Minikube:</p>

<pre><code class="language-PowerShell">minikube start `
--vm-driver hyperv `
--hyperv-virtual-switch "External Switch"
</code></pre>

<p>将创建一个名为<code>minikube</code>的新虚拟机:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/minikube-vm.png" class="zoom" data-title=""><img src="../Images/6178d1f72f01043594f06d714d6c3a28.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/minikube-vm.png"/>T2】</a></p>

<p><em>运行Minikube start后创建的Minikube虚拟机。</em></p>

<p>安装完成后，我们可以通过<code>kubectl</code>与Minikube集群交互:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/minikube-start.png" class="zoom" data-title=""><img src="../Images/0947ffd4f082b42bd80b7778570fecd0.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/minikube-start.png"/>T2】</a></p>

<p><em>Minikube集群已成功启动。</em></p>

<h2 id="running-some-commands">运行一些命令</h2>

<p>Minikube安装将使用测试集群的详细信息更新<code>~/.kube/config</code>处的文件，即<code>kubectl</code>使用的配置文件:</p>

<pre><code class="language-PowerShell">PS C:\Users\Matthew&gt; cat ~/.kube/config
apiVersion: v1
clusters:
- cluster:
    certificate-authority: C:\Users\Matthew\.minikube\ca.crt
    server: https://10.1.1.122:8443
  name: minikube
contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
users:
- name: minikube
  user:
    client-certificate: C:\Users\Matthew\.minikube\client.crt
    client-key: C:\Users\Matthew\.minikube\client.key
</code></pre>

<p>我们可以通过列出节点来测试安装是否正常工作:</p>

<pre><code class="language-PowerShell">PS C:\Users\Matthew&gt; kubectl get nodes
NAME       STATUS   ROLES    AGE     VERSION
minikube   Ready    master   6m47s   v1.15.2
</code></pre>

<h2 id="connecting-octopus-to-minikube">将Octopus连接到Minikube</h2>

<p>要从Octopus使用Minikube，我们需要上传客户端证书。Minikube将证书和密钥分割成两个文件(由<code>~/.kube/config</code>文件中的<code>client-certificate</code>和<code>client-key</code>属性引用)，所以我们使用<a href="https://slproweb.com/products/Win32OpenSSL.html" rel="nofollow"> OpenSSL </a>将它们合并成一个PFX文件:</p>

<pre><code class="language-PowerShell">&amp; "C:\Program Files\OpenSSL-Win64\bin\openssl.exe" pkcs12 `
  -passout pass: `
  -export `
  -out certificateandkey.pfx `
  -in C:\Users\Matthew\.minikube\client.crt `
  -inkey C:\Users\Matthew\.minikube\client.key
</code></pre>

<p>生成的<code>certificateandkey.pfx</code>文件可以上传到Octopus:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/certificate.png" class="zoom" data-title=""><img src="../Images/67da47dd4979a577a6ea2f8f2af307b4.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/certificate.png"/>T2】</a></p>

<p><em>由Minikube创建并由OpenSSL组合的证书和密钥。</em></p>

<p>为了让Octopus与本地虚拟机通信，我们需要在本地PC上创建一个<a href="https://octopus.com/docs/infrastructure/workers"> Worker触手</a>:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/worker.png" class="zoom" data-title=""><img src="../Images/4524d64fdc76320f65f1e0966ac86eb1.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/worker.png"/>T2】</a></p>

<p><em>与Minikube集群运行在同一台机器上的轮询工作器触手。</em></p>

<p>我们现在可以创建一个指向Minikube集群的本地URL的Kubernetes目标，这可以从<code>~/.kube/config</code>文件中的这一行找到:</p>

<pre><code class="language-YAML">server: https://10.1.1.122:8443
</code></pre>

<p>Kubernetes目标将使用我们之前上传的证书进行身份验证，为了方便起见跳过TLS验证，默认使用本地的触手工作器。</p>

<p>您可以通过<code>~/.kube/config</code>文件中的<code>certificate-authority</code>属性上传证书引用，并将其设置为服务器证书。</p>


<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/k8s-target.png" class="zoom" data-title=""><img src="../Images/f122fa5e16b55266d0427b06b7b0ee56.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/k8s-target.png"/>T2】</a></p>

<p><em>一个Kubernetes目标，配置为使用本地Worker触手，与内部Minikube IP地址对话。</em></p>

<p>定义好目标后，我们可以使用<a href="https://octopus.com/docs/administration/managing-infrastructure/script-console"> Octopus脚本控制台</a>与之交互:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/script-console.png" class="zoom" data-title=""><img src="../Images/d8b7499ba0eeec3d66361ec62cf3478b.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/script-console.png"/>T2】</a></p>

<p><em>脚本控制台是运行临时脚本的便捷方式。</em></p>

<p>该命令将通过Worker Tentacle执行，以与本地Minikube集群进行交互:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/minikube-on-windows/script-result.png" class="zoom" data-title=""><img src="../Images/174514d668d914abfc9f693b1c6713a8.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/minikube-on-windows/script-result.png"/>T2】</a></p>

<p><em>脚本结果，它反映了在本地运行kubectl时的结果。</em></p>

<h2 id="conclusion">结论</h2>

<p>Minikube是测试Kubernetes集群启动和运行的简单方法。在Windows中，Minikube使用HyperV，并且需要外部开关来操作。一旦启动，Minikube配置<code>kubectl</code>，我们就可以开始对测试集群运行命令。</p>

<p>也可以从Octopus与Minikube集群进行交互。通过在Minikube VM所在的同一台PC上使用Worker触手，Kubernetes目标可以向集群的私有IP发出命令。</p>

<p>有关部署到Kubernetes的更多信息，请参见我们的文档。</p>

                    
                    
</body>
</html>