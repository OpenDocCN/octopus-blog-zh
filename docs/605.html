<html>
<head>
<title>Resetting RavenDB indexes - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>重置RavenDB索引- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/resetting-raven-indexes#2015-09-25">https://octopus.com/blog/resetting-raven-indexes#2015-09-25</a></blockquote>
                        <p>如果您运气不好，在升级您的Octopus Deploy服务器之后，或者在数据库恢复之后，您可能会注意到一些奇怪的行为:</p>

<ul>
<li>用户、项目或环境可能已经完全从UI中消失了</li>
<li>尝试导航可能会导致不断的错误，如“等待15，103毫秒，查询返回非过时的结果。”</li>
</ul>

<p>为什么会出现这些情况？Octopus建立在文档数据库RavenDB 之上。Raven中的数据被保存到<a href="http://en.wikipedia.org/wiki/Extensible_Storage_Engine"> ESENT </a>中，这是支持微软Exchange和Active Directory的相同数据库技术。但是Raven也在<a href="http://en.wikipedia.org/wiki/Lucene"> Lucene </a>中保存数据的索引，它在执行查询时会用到这些索引。</p>

<p>当这些Lucene索引出现问题时，通常会出现上述错误。我注意到客户升级Octopus或恢复备份，却发现数据丢失。但是如果你进入RavenDB管理工作室，你经常可以看到这些数据。它就在那里，只是没有索引。</p>

<h2>在Octopus中连接到RavenDB管理工作室</h2>

<p>一个可行的快速解决方案是重置索引，然后重启Octopus，以便重建所有索引。为此，首先需要连接到RavenDB management studio。</p>

<p>studio是在Silverlight中构建的，所以您需要确保无论您从哪台机器上安装了Silverlight浏览器插件(或者您可以安装它)。</p>

<p>RavenDB Management Studio通常位于Octopus服务器的10930端口上，因此浏览到<code>http://_your-octopus_:10930</code>通常是有效的。如果没有，并且您可以访问Octopus门户网站，请尝试:</p>

<ol>
<li>前往八达通门户网站</li>
<li>进入<strong>配置</strong>菜单，然后进入<strong>存储</strong>选项卡</li>
<li>按照页面上的链接访问Raven</li>
</ol>

<p>如果这不起作用，你需要确保防火墙规则不会阻止你在那个端口浏览Octopus。或者，您需要RDP到Octopus服务器并在本地浏览到它(即<code>http://localhost:10930</code>)。</p>

<p>最后，当您连接时，会要求您进行鉴定:</p>

<p><img src="../Images/7921dc8ea60db1fcebf9dae23340e1cd.png" alt="Authenticating with Raven as a Windows user" data-original-src="https://i.octopus.com/blog/migrated/auth-with-raven_vy9kms.png"/></p>

<p>您需要在这里提供的凭证<strong>不是您的八达通凭证</strong>。您需要作为分配给Octopus服务器上本地管理员组的Windows用户进行身份验证(例如，机器上的管理员帐户)。</p>

<h2>重置索引</h2>

<p>现在您已经在Raven中了，您可以转到<strong>索引</strong>选项卡并单击“删除所有索引”:</p>

<p><img src="../Images/92fa315f94a3abd5eea388f1d546789a.png" alt="Deleting all indexes in RavenDB" data-original-src="https://i.octopus.com/blog/migrated/delete-indexes_nt5psl.png"/></p>

<p>注意，这并没有删除任何<em>数据</em>；它只是删除了索引，这些索引将在下一步自动重建。</p>

<h2>重启章鱼</h2>

<p>要让Octopus重建索引，您需要重启它。</p>

<ol>
<li>RDP到你的八达通服务器</li>
<li>打开服务管理控制台，<strong> services.msc </strong></li>
<li>选择“八达通”服务</li>
<li>点击<strong>停止</strong>，等待停止</li>
<li>点击<strong>启动</strong>，并等待其启动</li>
</ol>

<p>您还需要重启Octopus web门户，这是一个IIS应用程序。</p>

<ol>
<li>打开IIS管理器，<strong>inetmgr.exe</strong></li>
<li>在树中，展开您的服务器，并转到<strong>应用程序池</strong></li>
<li>选择<strong>八达通门户</strong>应用池</li>
<li>执行<strong>停止</strong>和<strong>启动</strong></li>
</ol>

<p>给它一分钟左右的预热时间，然后通过你的浏览器进入Octopus门户网站，希望一切都正常。<a href="http://help.octopusdeploy.com/discussions">如果您仍有问题，请联系我们的支持表单</a>。</p>

                    
                    
</body>
</html>