<html>
<head>
<title>Deploying to Oracle with Octopus Deploy and Liquibase - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Octopus Deploy和Liquibase - Octopus Deploy部署到Oracle</h1>
<blockquote>原文：<a href="https://octopus.com/blog/octopus-oracle-liquibase#2022-07-07">https://octopus.com/blog/octopus-oracle-liquibase#2022-07-07</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/liquibase-octopus.png" class="zoom" data-title=""><img src="../Images/05106aff6869336a27aa568556808315.png" class="img-fluid center" alt="Deploying to Oracle with Octopus Deploy and Liquibase" data-original-src="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/liquibase-octopus.png"/>T2】</a></p>

<p>数据库部署通常是部署中最困难的部分。在本文中，我将向您展示如何使用Octopus Deploy通过Liquibase部署Oracle数据库。</p>

<h2 id="liquibase">液态碱</h2>

<p><a href="https://www.liquibase.org/" rel="nofollow"> Liquibase </a>是一个基于迁移的数据库部署工具，类似于<a href="https://flywaydb.org/" rel="nofollow"> Flyway </a>、<a href="https://dbup.readthedocs.io/en/latest/" rel="nofollow"> DbUp </a>和<a href="https://github.com/chucknorris/roundhouse" rel="nofollow"> RoundhousE </a>。Liquibase的独特之处在于您如何定义迁移。</p>

<p>Flyway、DbUp和RoundhousE依赖于用户自己编写SQL脚本，而Liquibase允许用户用XML、JSON、YAML以及所谓的<code>changelog</code>中的SQL来定义迁移。Liquibase会在部署过程中将changelog转换为SQL语句。</p>

<h3 id="sample-project-sakila">示例项目:Sakila</h3>

<p>Sakila是一个最初为MySQL开发的示例数据库。这个项目包含许多不同的数据库对象，包括表、视图、存储过程和函数。这使它成为一个全面的例子。</p>

<p>为了支持其他数据库技术，我在我们的<a href="https://bitbucket.org/octopussamples/sakila/src/master/" rel="nofollow"> Samples BitBucket实例</a>中创建了一个repo，它包含了许多不同数据库技术和方法的Sakila项目。</p>

<h3 id="changelog">变更日志</h3>

<p>Octopus Deploy中Liquibase 的<a href="https://library.octopus.com/step-templates/6a276a58-d082-425f-a77a-ff7b3979ce2e/actiontemplate-liquibase-apply-changeset" rel="nofollow">步骤模板以两种方式之一工作:</a></p>

<ul>
<li>包装中包含Liquibase。</li>
<li>只有变更日志文件。</li>
</ul>

<p>在这篇文章中，我们打包了changelog文件:</p>

<p><details> <summary> dbchangelog.xml </summary> </details></p>



<p>章鱼部署</p>

<h2 id="octopus-deploy">使用Octopus Deploy，您可以包含Liquibase步骤模板来自动部署到Oracle。这篇文章假设你已经熟悉了在Octopus Deploy中创建项目的<a href="https://octopus.com/docs/projects#add-a-project">,并且将涵盖Liquibase特有的步骤。</a></h2>

<p>Liquibase步骤模板</p>

<h3 id="liquibase-step-template">要添加Liquibase模板，请在Octopus项目的<strong>流程</strong>选项卡中单击<strong>添加步骤</strong>按钮:</h3>

<p>【T2 <img src="../Images/7d571c0c5a7119da1658f50994e74a86.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-project-add-step.png"/></p>

<p>然后按<code>liquibase</code>过滤。该模板将出现在<strong>社区贡献的步骤模板</strong>部分。点击<strong>安装并添加</strong>(或者<strong>添加</strong>如果已经安装):</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-liquibase-template.png" class="zoom" data-title=""><img src="../Images/b47ea06b1d51d75ab86187dcb7cc83e7.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-liquibase-template.png"/>T2】</a></p>

<p>Liquibase模板是专门为支持在能够下载运行所需的一切(包括Java)的工作人员上运行而设计的。添加模板后，填写模板的字段。</p>

<p>数据库类型</p>

<h4 id="database-type">选择要部署到的数据库类型。当前支持的类型有:</h4>

<p>MariaDB</p>

<ul>
<li>MongoDB</li>
<li>关系型数据库</li>
<li>神谕</li>
<li>一种数据库系统</li>
<li>SqlServer</li>
<li>Liquibase本身支持<a href="https://www.liquibase.org/get-started/databases" rel="nofollow">更多类型</a>，但是它们还没有包含在模板中。</li>
</ul>

<p>变更日志文件名</p>

<h4 id="changelog-file-name">这是changelog文件的名称和/或在包中的相对位置。例如:</h4>

<p>dbchangelog.xml</p>

<ul>
<li>/子文件夹/mychangelog。JSON</li>
<li>服务器名称</li>
</ul>

<h4 id="server-name">要部署到的服务器的名称、DNS或IP地址。</h4>

<p>服务器端口</p>

<h4 id="server-port">数据库服务器监听的端口号。</h4>

<p>数据库名称</p>

<h4 id="database-name">要部署到的数据库的名称。</h4>

<p>用户名</p>

<h4 id="username">有权访问数据库的帐户的用户名。</h4>

<p>密码</p>

<h4 id="password">有权访问数据库的帐户的密码。</h4>

<p>连接查询字符串参数</p>

<h4 id="connection-query-string-parameters">为连接字符串指定任何附加的查询字符串参数。比如:<code>?useUnicode=true</code>。</h4>

<p>数据库驱动程序路径</p>

<h4 id="database-driver-path">包中用于连接数据库服务器的数据库驱动程序jar文件的路径。勾选<strong>下载Liquibase </strong>选项时不使用。</h4>

<p>可执行文件路径</p>

<h4 id="executable-file-path">包中Liquibase可执行文件的路径。勾选<strong>下载Liquibase </strong>选项时不使用。</h4>

<p>仅报告？</p>

<h4 id="report-only">当您只想查看将用于部署的SQL时，使用此复选框。</h4>

<p>步骤模板将自动附加。sql文件作为部署的工件。当您需要有人在部署前检查更改时，这很有用。</p>

<p>下载Liquibase？</p>

<h4 id="download-liquibase">如果您的部署包中不包含Liquibase，请使用此选项。</h4>

<p>该选项将下载社区版本的Liquibase、Java和数据库类型。执行部署所需的jar文件。这篇文章使用了这个选项。</p>

<p>Liquibase版本</p>

<h4 id="liquibase-version">该选项仅用于<strong>下载Liquibase </strong>选项。</h4>

<p>这指定了要下载的Liquibase的版本。留空以使用最新版本。</p>

<p>变更集包</p>

<h4 id="changeset-package">这是用于部署的包选择器。</h4>

<p>完成后，它应该看起来像这样:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-step-liquibase-report.png" class="zoom" data-title=""><img src="../Images/f0cffeec363358caa6b1a6e07fa51614.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-step-liquibase-report.png"/>T2】</a></p>

<p>部署流程</p>

<h3 id="deployment-process">在这篇文章中，我添加了一些其他步骤来模拟真实世界的部署:</h3>

<p><strong>创建用户</strong>:如果数据库用户不存在，则创建该用户。</p>

<ul>
<li><strong>添加连接角色</strong>:为上述用户添加连接角色。</li>
<li><strong>添加资源角色</strong>:为上述用户添加资源角色。</li>
<li><strong>添加DBA角色</strong>:为上述用户添加DBA角色。</li>
<li><strong>生成更改脚本</strong>:仅检查报告的Liquibase步骤，以生成将要运行的内容。</li>
<li><strong> DBA批准</strong>:仅在生产中请求DBA批准。</li>
<li><strong>应用变更集</strong>:应用变更的Liquibase步骤。</li>
<li><a href="#" data-featherlight="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-project-deployment-process.png" class="zoom" data-title=""><img src="../Images/01579ecfccd95407a7baf6eec5d7b2c6.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-project-deployment-process.png"/>T2】</a></li>
</ul>

<p>部署</p>

<h3 id="the-deployment">执行时，部署结果将如下所示:</h3>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-deployment-complete.png" class="zoom" data-title=""><img src="../Images/fd6daac0982b277ce0031854bc1aeee0.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-deployment-complete.png"/>T2】</a></p>

<p>正如您所看到的，Report Only步骤将<code>ChangeSet.sql</code>文件作为工件附加，可以在批准之前进行审查。展开<code>Apply changeset</code>步骤显示:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-liquibase-step.png" class="zoom" data-title=""><img src="../Images/c1da9813823785dcb15b972437e0e4ef.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/octopus-liquibase-step.png"/>T2】</a></p>

<p>神谕</p>

<h3 id="oracle">如果我们登录Oracle，我们可以看到我们的数据库更新已被应用:</h3>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/oracle-sql-developer.png" class="zoom" data-title=""><img src="../Images/8ac7a29f83321f3de04702856ec1bff9.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2021-05/octopus-oracle-liquibase/oracle-sql-developer.png"/></a>T2】</p>

<p>结论</p>

<h2 id="conclusion">Octopus Deploy支持部署到许多数据库技术(Microsoft SQL Server、MariaDB、MySQL、Oracle、PostgreSQL等。)以及许多不同的部署方法(DACPAC、DbUp、Flyway、Liquibase、RoundhousE等。).我希望这篇文章能帮助您理解如何使用Octopus通过Liquibase部署到Oracle数据库。</h2>

<p>愉快的部署！</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>