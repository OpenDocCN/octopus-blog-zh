<html>
<head>
<title>Octopus Deploy comes to AppVeyor - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Octopus Deploy来到AppVeyor - Octopus Deploy</h1>
<blockquote>原文：<a href="https://octopus.com/blog/appveyor-integration#2022-07-20">https://octopus.com/blog/appveyor-integration#2022-07-20</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-03/appveyor-integration/blogimage-appveyor.png" class="zoom" data-title=""><img src="../Images/ad5db351525cfd33b901127de6c5f7a2.png" class="img-fluid center" alt="Continous Delivery in the cloud with Octopus and AppVeyor" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/blogimage-appveyor.png"/>T2】</a></p>

<p>AppVeyor 的优秀团队最近增加了对推送和部署项目的内置支持。NET、Java、JavaScript等)与Octopus一起部署。AppVeyor是一个云托管的持续集成工具，在开源项目中非常流行，尤其是在。净空间。从与您的源代码控制直接集成到部署插件，如他们的新Octopus Deploy产品，AppVeyor提供了一个简单的开箱即用的解决方案来构建您的应用程序，而不必管理您自己的构建基础设施。每个构建都有自己干净的环境，其中包含启动自动化CI解决方案所需的所有工具。现在有了新的Octopus集成，这个过程将变得更加容易。</p>

<p><strong>与我们即将推出的<a href="https://octopus.com/cloud"> Octopus Cloud </a>产品结合使用，您将很快能够创建一个基于云的、完全可扩展的持续部署管道，而无需自己管理一台机器。那是多么令人兴奋啊！</strong></p>

<p>让我们看一个如何充分利用这一新产品的示例。</p>

<h2 id="appveyor-octopus-plugin">appveyor章鱼外挂程式</h2>

<p>在一个简单的免费注册过程之后，我们可以开始创建一个新的AppVeyor项目，我已经添加了<code>OctopusSamples/RandomQuotes-aspmvc4</code> GitHub库作为源代码库。从BitBucket到VSTS，还有一系列其他存储库选项可供选择。公共的<a href="https://github.com/OctopusSamples/RandomQuotes-aspmvc4" rel="nofollow">OctopusSamples/RandomQuotes-aspmvc 4</a>存储库提供了一个基本的ASP.NET MVC应用程序来显示一串明智的报价。我们的目标是建立一个交付管道，将该网站部署到我们的IIS服务器上，用于试运行和生产环境。</p>

<h3 id="build-pack">构建和打包</h3>

<p>查看构建阶段，您应该注意到一个<code>Package Applications for Octopus Deployment</code>标志。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-03/appveyor-integration/appveyor_build_step.png" class="zoom" data-title=""><img src="../Images/a7efd48772cee0b2d6f13b255b60f396.png" class="img-fluid center" alt="AppVeyor Build Step" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/appveyor_build_step.png"/>T2】</a></p>

<p>这个标志确保构建完成后，内容被压缩到一个包中，这个包可以被推送到Octopus Deploy。虽然Octopus将接受任何NuGet、zip或tar包，但是这个标志将利用<code>octo.exe</code>到<a href="https://octopus.com/docs/packaging-applications/create-packages/">创建一个zip </a>，使用这个AppVeyor项目的应用程序名称和版本来命名。</p>

<h3 id="push">推</h3>

<p>在<code>Deployment</code>配置中，选择新的<code>Octopus Deploy</code>部署提供者。这个特性执行所有适当的调用，将包传递给Octopus，并创建一个相关的Octopus <a href="https://octopus.com/docs/releases"> Release </a>。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-03/appveyor-integration/appveyor_build_deployment.png" class="zoom" data-title=""><img src="../Images/bf4b02067df014f92dba13cdf2ea764c.png" class="img-fluid center" alt="AppVeyor Deployment Step" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/appveyor_build_deployment.png"/>T2】</a></p>

<p>添加您的Octopus服务器URL和API密钥后，勾选<code>Push Packages</code>选项，允许AppVeyor自动检测上一步构建的Octopus包。AppVeyor随后会将包裹推送到Octopus <a href="https://octopus.com/docs/octopus-rest-api/examples/feeds/push-package-to-builtin-feed/">内置的NuGet feed </a>。虽然Octopus支持在新的包可用时自动创建发布版本，但是在这个场景中，我们将通过AppVeyor来触发它。单击<code>Create Release</code>复选框并提供项目名称<code>RandomQuotes</code>，我们稍后将在Octopus中设置该项目，AppVeyor将通过编程触发该项目。</p>

<h4 id="source-controlled-configuration">源控制配置</h4>

<p>AppVeyor的另一个很棒的特性是能够通过一个<code>appveyor.yml</code>文件提供您的构建配置，该文件与您的代码共存，而不是通过web门户进行设置。这意味着该过程可以直接与源代码联系起来，这样可以简化版本管理，并且您的构建步骤可以与项目一起发展。阅读他们的<a href="https://www.appveyor.com/docs/build-configuration/#appveyoryml-and-ui-coexistence" rel="nofollow">文档</a>以获得更多关于这在实践中如何工作的信息。这种方法类似于我们Octopus正在开发的一个功能，允许您的CD管道的部署端通过源代码控制配置进行存储。<a href="https://github.com/OctopusDeploy/Specs/blob/master/ProcessAsCode/index.md" rel="nofollow">看看</a>关于我们如何实现“带代码的部署配置”的想法，让我们知道你的想法。</p>

<p>随着我们的AppVeyor构建管道的建立，现在让我们进入我们的Octopus服务器并部署这个网站。</p>

<h2 id="continuing-deployment-through-octopus">通过八达通继续部署</h2>

<p>为了与我们刚刚在AppVeyor中提供的配置相匹配，创建一个新项目，并将其命名为<code>RandomQuotes</code>。对于我们的简单部署场景，我们将首先转到<code>Process</code>部分，简单地添加一个新的IIS步骤。选择<code>Deploy to IIS</code>步骤后，我们将添加一些设置来提供Octopus信息，以便创建和配置IIS网站。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-03/appveyor-integration/octopus_iis_step.png" class="zoom" data-title=""><img src="../Images/193f00800079fd58bc92a9dc45fa7eee.png" class="img-fluid center" alt="Octopus Deploy IIS" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/octopus_iis_step.png"/>T2】</a></p>

<p>在提供了一个映射到目标的角色之后，我们将配置哪个包将用于这一步。使用内置的AppVeyor将推送至该feed ),我们可以提供PackageId <code>RandomQuotes</code>。</p>

<p>配置网站本身最简单的方法就是设置两个额外的值，<code>Website name</code>和<code>AppPool</code>。对于这个例子，我们将在同一台机器上同时托管<code>Staging</code>和<code>Production</code>(对于一个真实的项目来说，这不是一个好主意)，所以我们将根据正在部署的环境提供一个不同的网站名称。名称的<code>#{Octopus.Environment.Name}</code>部分将在部署时被替换为环境的名称。</p>

<p>除了<code>Website Name</code>之外，我们还决定在<code>Staging</code>和<code>Production</code>之间提供不同的绑定端口。这个值<code>#{CustomPort}</code>是在项目的<code>Variables</code>部分中设置的，可以根据不同的部署环境组合(如环境、机器或<a href="https://octopus.com/docs/tenants">租户</a>)来设定不同的值，这里仅举几个例子。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-03/appveyor-integration/octopus_variables.png" class="zoom" data-title=""><img src="../Images/fa9185d2dc6c8a902621126580db2335.png" class="img-fluid center" alt="Octopus Deploy variables" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/octopus_variables.png"/>T2】</a></p>

<p>一种常见的模式是在Octopus中为不同的环境定义变量，这些变量在应用程序运行时使用的配置文件中被替换。在部署过程中使用它们会带来大量高级场景。</p>

<p>对于我们的<code>RandomQuotes</code>项目，我们为每个环境都有一个配置转换文件。看起来像这样的<code>Web.Production.config</code>转换:</p>

<pre><code class="language-xml">&lt;?xml version="1.0"?&gt;
&lt;configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform"&gt;
  &lt;appSettings&gt;
    &lt;add key="ReleaseVersion" value="#{Octopus.Release.Number}" xdt:Transform="SetAttributes" xdt:Locator="Match(key)"/&gt;
    &lt;add key="EnvironmentName" value="#{Octopus.Environment.Name}" xdt:Transform="SetAttributes" xdt:Locator="Match(key)"/&gt;
    &lt;add key="BackgroundColor" value="#1e8822" xdt:Transform="SetAttributes" xdt:Locator="Match(key)"/&gt;
  &lt;/appSettings&gt;
  &lt;system.web&gt;
    &lt;compilation xdt:Transform="RemoveAttributes(debug)" /&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre>

<p>注意<code>ReleaseVersion</code>的值包含了部署期间提供的模板模式。(如果实在受不了悬念和什么来看看这是什么样子，就跳到这篇帖子的末尾)。</p>

<h2 id="commit-and-enjoy">承诺并享受</h2>

<p>现在，我们已经配置了自动化CI/CD渠道。当我们提交对项目的更改时，AppVeyor将自动检测并从GitHub中提取更改，构建项目，并将其推送到我们的Octopus服务器。从那时起，Octopus Deploy接管并将其部署到我们的<code>Staging</code>环境中。一旦我们对这个版本感到满意，我们可以通过点击一个按钮来部署到<code>Production</code>。已经过测试的同一个构建好的包将使用我们的变量提供的新值被推送到我们的生产环境中。</p>

<p>【T2 <img src="../Images/65e2a89f7be83a7afa6811cdfded209d.png" class="img-fluid center" alt="Logs Together" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/logs_together.png"/></p>

<p>当部署发生时，Octopus将在您的项目中应用任何web.config转换并执行变量替换，以便在每个环境中运行相同的构建工件，确保您测试的代码是您在生产中运行的代码。</p>

<p><strong>分期</strong></p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-03/appveyor-integration/app_staging.png" class="zoom" data-title=""><img src="../Images/3fb935164ddca82e073e809d23d07a80.png" class="img-fluid center" alt="Deployed Staging" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/app_staging.png"/>T2】</a></p>

<p>有了应用程序的试运行版本，我们就可以在开始生产部署之前对其进行检查和测试...</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-03/appveyor-integration/octopus_deploying.png" class="zoom" data-title=""><img src="../Images/df536dadc55bb1290081fa13eab75381.png" class="img-fluid center" alt="Running Deployment" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/octopus_deploying.png"/>T2】</a></p>

<p><strong>生产</strong></p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2018-03/appveyor-integration/app_production.png" class="zoom" data-title=""><img src="../Images/95c0fb432fc396b096778ec6228ec30f.png" class="img-fluid center" alt="Deployed Production" data-original-src="https://i.octopus.com/blog/2018-03/appveyor-integration/app_production.png"/>T2】</a></p>

<p>请注意转换是如何应用的，它改变了导航条的颜色，同时端口和其他变量也根据部署到的环境进行了更新。</p>

<p>有关这项新功能的更多信息，请务必阅读我们的<a href="https://octopus.com/docs/packaging-applications/build-servers/appveyor"> AppVeyordocs </a></p>

<h2 id="appveyor-octopus-deploy-any-time">AppVeyor + Octopus =随时部署</h2>

<p>AppVeyor与Octopus Deploy的结合提供了一种令人兴奋的新方法，以可重复、可靠的方式自动化您的连续交付渠道。向在周五下午5点崩溃的手工定制脚本解决方案说再见吧。今天用一个<a href="https://octopus.com/licenses/trial">免费八达通试用</a>来发挥AppVeyor新功能的威力。</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>