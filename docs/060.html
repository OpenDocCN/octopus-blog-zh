<html>
<head>
<title>Configuring Octopus Server High Availability using AWS FSx - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用AWS FSx - Octopus Deploy配置Octopus服务器高可用性</h1>
<blockquote>原文：<a href="https://octopus.com/blog/aws-fsx-ha#2021-08-12">https://octopus.com/blog/aws-fsx-ha#2021-08-12</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-ha-file-share.png" class="zoom" data-title=""><img src="../Images/13f6f3401f942a796bd5ecbc35881f3a.png" class="img-fluid center" alt="Configuring Octopus Server High Availability using AWS FSx" data-original-src="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-ha-file-share.png"/>T2】</a></p>

<p>当你为Octopus在AWS 上配置<a href="https://octopus.com/docs/administration/high-availability/configuring-octopus-for-high-availability#shared-storage-in-amazon-aws">高可用性时，你需要像微软DFS这样的共享存储(如文档所述)或者你可以使用亚马逊的FSx。在本文中，我演示了如何将FSx与安装在EC2实例上的Octopus Deploy一起使用。</a></p>

<h2 id="amazon-fsx">亚马逊FSx</h2>

<p>FSx是一种网络文件系统，有两种类型:</p>



<p>在这篇文章中，我们使用FSx的Windows文件服务器。</p>

<h2 id="configuring-fsx">配置FSx</h2>

<p>像许多其他亚马逊AWS产品一样，FSx附带了一个方便易用的配置向导。首先，打开您的<a href="https://aws.amazon.com/console" rel="nofollow"> AWS管理控制台</a>并点击位于存储类别下的FSx。</p>

<p>与AWS拥有的其他文件存储选项不同，用于Windows文件服务器的FSx<strong>需要</strong> Active Directory。如果您正在创建活动目录，请注意活动目录服务不是免费的，请参考他们的<a href="https://aws.amazon.com/directoryservice/pricing/" class="alert-link" rel="nofollow">定价</a>页面了解详情。</p>


<h3 id="step-1-select-file-system-type">步骤1:选择文件系统类型</h3>

<p>这个过程的第一步是选择您将要使用的文件系统类型。如前所述，您的选择是:</p>

<ul>
<li>用于Windows文件服务器的FSx</li>
<li>这篇文章使用的是Windows文件服务器的FSx。</li>
</ul>

<h3 id="step-2-specify-file-system-details">步骤2:指定文件系统详细信息</h3>

<p>接下来，您将定义由几个部分组成的文件系统细节。</p>

<h4 id="file-system-details">文件系统详细信息</h4>

<p>本节定义了以下内容:</p>

<ul>
<li>部署类型</li>
<li>存储类型<ul>
<li>（同solid-statedisk）固态（磁）盘</li>
<li>HDD(单AZ文件系统不支持)</li>
</ul>
</li>
<li>存储容量(最低32 GB)</li>
</ul>

<h4 id="network-security">网络与安全</h4>

<p>在本部分中，您将选择网络和安全组(防火墙)组件:</p>

<ul>
<li>VPC</li>
<li>VPC安全集团</li>
<li>子网络</li>
</ul>

<h4 id="windows-authentication">Windows身份验证</h4>

<p>对于此部分，您需要选择活动目录的详细信息。您可以选择:</p>

<ul>
<li>AWS管理的Microsoft Active Directory</li>
<li>自我管理的Microsoft Active Directory</li>
</ul>

<p>您还可以创建新的活动目录(如果使用AWS管理的Microsoft活动目录)。</p>

<h4 id="encryption">加密</h4>

<p>这是您定义加密密钥的部分，以便您的数据在静态时得到保护。您的选择是:</p>



<p>接下来的两个部分是可选的:</p>

<ul>
<li>备份和维护首选项</li>
<li>标签</li>
</ul>

<h3 id="step-3-review-and-create">步骤3:检查和创建</h3>

<p>该过程的最后一步是在创建之前检查您为文件服务器选择的选项。在此页面上，它将向您显示在创建文件系统后哪些选项可以更改，哪些不能编辑。当您对自己的选择感到满意时，点击<strong>创建文件系统</strong>。</p>

<h2 id="connecting-to-the-share">连接到共享</h2>

<p>创建FSx文件系统后，它将在Active Directory网络上可用。</p>

<h3 id="get-the-dns-name">获取DNS名称</h3>

<p>为了连接到共享，我们需要知道端点是什么。创建文件系统后，单击<code>Storage</code>类别下的<code>FSx</code>:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-storage-fsx.png" class="zoom" data-title=""><img src="../Images/0b04658470f84bacde5e59c87166c85b.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-storage-fsx.png"/>T2】</a></p>

<p>找到您创建的文件系统，然后单击名称链接:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-fsx-filesystem.png" class="zoom" data-title=""><img src="../Images/7b215ec8f8e6191f90c7d291bfce520a.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-fsx-filesystem.png"/>T2】</a></p>

<p>复制文件系统共享的DNS名称:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-fsx-dns.png" class="zoom" data-title=""><img src="../Images/fd56cad8c61939587deb4c9630fffb85.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-fsx-dns.png"/>T2】</a></p>

<h3 id="connect-to-fsx">连接到FSx</h3>

<p>现在我们有了FSx文件系统的DNS名称，我们可以使用该DNS名称连接到它。</p>

<p>RDP呼叫章鱼服务器。登录后，打开命令提示符，并确保通过pinging名称可以访问FSx文件系统:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-ec2-ping.png" class="zoom" data-title=""><img src="../Images/fc6a559494e78d39fc922511318f4eb5.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-09/aws-fsx-ha/aws-ec2-ping.png"/>T2】</a></p>

<p>根据您的安全组，ping命令可能会失败，但我们可以看到它解析到了正确的IP地址。现在我们知道EC2实例可以找到FSx文件系统，打开一个文件资源管理器窗口，UNC到FSx。FSx的默认共享名是简单的<code>share</code>，所以您的UNC命令将如下所示:</p>

<pre><code>\\fs-01d557023313c0f5a.octo.fsx\share
</code></pre>

<h2 id="configure-octopus-deploy-to-use-fsx">配置Octopus Deploy以使用FSx</h2>

<p>一旦配置完成，FSx就像一个文件服务器。这意味着您加入域的EC2实例可以通过UNC引用它。使用配置<a href="https://octopus.com/docs/administration/high-availability/configuring-octopus-for-high-availability">高可用性(HA) </a>共享存储的指导，我们可以将Octopus存储工件、任务日志、内置存储库和遥测数据的位置从EC2实例转移到FSx。配置共享存储有两个选项:</p>

<ul>
<li>设置根共享存储目录。</li>
<li>单独设置每个目录。</li>
</ul>

<p>要设置共享存储根目录，请执行以下操作:</p>

<pre><code>Octopus.Server.exe path --clusterShared \\fs-01d557023313c0f5a.octo.fsx\share
</code></pre>

<p>要单独设置每个文件夹:</p>

<pre><code>Octopus.Server.exe path --artifacts \\fs-01d557023313c0f5a.octo.fsx\share\Artifacts
Octopus.Server.exe path --taskLogs \\fs-01d557023313c0f5a.octo.fsx\share\TaskLogs
Octopus.Server.exe path --nugetRepository \\fs-01d557023313c0f5a.octo.fsx\share\Packages
Octopus.Server.exe path --telemetry \\fs-01d557023313c0f5a.octo.fsx\share\Telemetry
</code></pre>

<p>如果您的Octopus服务器不是一个全新的实例，您需要将工件、任务日志和包文件夹中的内容复制到新的位置，以便它们在Octopus中显示。</p>


<p>现在，您的Octopus服务器使用共享位置，您就可以添加新节点来配置HA了！</p>

<h2 id="conclusion">结论</h2>

<p>在这篇文章中，我向您展示了如何创建和配置AWS FSx，并将其与Octopus Deploy连接。愉快的部署！</p>

                    
                    
</body>
</html>