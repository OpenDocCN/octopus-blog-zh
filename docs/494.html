<html>
<head>
<title>Octopus Deploy on Docker quickstart - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Octopus部署在Docker quickstart上- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/octopus-deploy-on-docker#2021-08-12">https://octopus.com/blog/octopus-deploy-on-docker#2021-08-12</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/octopus-deploy-on-docker/octopus-docker.png" class="zoom" data-title=""><img src="../Images/bd79620b456be44c2c15807e28e105be.png" class="img-fluid center" alt="Octopus Deploy on Docker quickstart" data-original-src="https://i.octopus.com/blog/2020-12/octopus-deploy-on-docker/octopus-docker.png"/>T2】</a></p>

<p>您可以在内部运行Octopus，使用Octopus云实例，甚至在Docker中运行Octopus。您可以在Docker容器中为测试和生产环境运行Octopus Deploy。</p>

<p>在这篇博文中，您将了解如何在五分钟内在本地机器上启动并运行Docker容器。</p>

<h2 id="prerequisites">先决条件</h2>

<p>要跟进这篇博文，您需要以下内容:</p>

<ul>
<li>八达通部署知识</li>
<li>运行Windows或MacOS的计算机</li>
<li>Docker <a href="https://www.docker.com/products/docker-desktop" rel="nofollow">桌面</a>。</li>
<li>像VS Code这样的代码编辑器</li>
</ul>

<h2 id="configure-your-environment">配置您的环境</h2>

<p>创建本地容器化Octopus部署环境的第一步是建立一个<code>.env</code>配置文件。<code>.env</code>允许您为Docker Compose配置的某些值保存环境变量。这样，您可以设置变量而不是硬编码值。</p>

<ol>
<li>打开文本编辑器，创建一个名为<code>.env</code>的新文件</li>
<li>将以下代码添加到<code>.env</code>文件中。</li>
</ol>

<p>这种容器化的环境应该仅用于测试/开发目的，这就是为什么您会在<code>.env</code>配置文件中看到密码。对于基于生产的部署，不建议这样做。</p>

<pre><code class="language-bash">SA_PASSWORD=P@ssw0rd!
OCTOPUS_ADMIN_USERNAME=admin
OCTOPUS_ADMIN_PASSWORD=SecreTP@assw0rd
</code></pre>

<p>将值添加到<code>.env</code>文件后，您可以创建Docker合成文件。</p>

<h2 id="configure-docker-compose-to-run-octopus-containers">配置Docker Compose来运行Octopus容器</h2>

<p>下一步是创建一个Docker合成文件，它存储两个容器的配置。Docker Compose文件为Octopus部署环境创建一个运行容器，以便在本地机器上运行。合成文件包含两种配置:</p>

<ul>
<li>用于Octopus部署后端的SQL Docker映像</li>
<li>Octopus部署Docker图像</li>
</ul>

<ol>
<li>创建一个名为<code>docker-compose.yml</code>的新文件。确保它保存在与<code>.env</code>配置文件相同的目录中。这告诉Docker您正在使用一个合成文件来创建一个环境。</li>
<li>Docker Compose文件的第一部分为数据库设置配置。数据库配置使用Linux SQL映像，接受EULA并提供SA密码。之后，指定要使用的端口，并进行健康检查以确认数据库成功启动:</li>
</ol>

<pre><code class="language-yaml">version: '3'
services:
   db:
    image: mcr.microsoft.com/mssql/server
    environment:
      SA_PASSWORD: ${SA_PASSWORD}
      ACCEPT_EULA: 'Y'
    ports:
      - 1401:1433
    healthcheck:
      test: [ "CMD", "/opt/mssql-tools/bin/sqlcmd", "-U", "sa", "-P", "${SA_PASSWORD}", "-Q", "select 1"]
      interval: 10s
      retries: 10
</code></pre>

<ol start="3">
<li>Docker合成文件的第二部分配置Octopus Deploy。它使用官方的Octopus Deploy映像，环境设置为接受EULA，配置Octopus Deploy用户名、密码和到之前配置的SQL DB容器的数据库连接字符串。然后为Octopus Deploy指定端口，并且有一个<code>depends_on</code>开关来确保在Octopus Deploy容器运行之前配置好数据库。条件是确保数据库服务正常运行:</li>
</ol>

<pre><code class="language-yaml">octopus:
    image: octopusdeploy/octopusdeploy:latest
    environment:
       ACCEPT_EULA: "Y"
       OctopusAdminUsername: "${OCTOPUS_ADMIN_USERNAME}"
       OctopusAdminPassword: "${OCTOPUS_ADMIN_PASSWORD}"
       DB_CONNECTION_STRING: "Server=db,1433;Initial Catalog=Octopus;Persist Security Info=False;User=sa;Password=${SA_PASSWORD};MultipleActiveResultSets=False;Connection Timeout=30;"
    ports:
    - 1322:8080
    - 10943:10943
    depends_on:
      db:
        condition: service_healthy
    stdin_open: true
</code></pre>

<p>整个<code>docker-compose.yml</code>文件应该如下所示:</p>

<pre><code class="language-yaml">version: '3'
services:
   db:
    image: mcr.microsoft.com/mssql/server
    environment:
      SA_PASSWORD: ${SA_PASSWORD}
      ACCEPT_EULA: 'Y'
    ports:
      - 1401:1433
    healthcheck:
      test: [ "CMD", "/opt/mssql-tools/bin/sqlcmd", "-U", "sa", "-P", "${SA_PASSWORD}", "-Q", "select 1"]
      interval: 10s
      retries: 10

   octopus:
    image: octopusdeploy/octopusdeploy:latest
    environment:
       ACCEPT_EULA: "Y"
       ADMIN_USERNAME: "${OCTOPUS_ADMIN_USERNAME"
       ADMIN_PASSWORD: "${OCTOPUS_ADMIN_PASSWORD}"
       DB_CONNECTION_STRING: "Server=db,1433;Initial Catalog=Octopus;Persist Security Info=False;User=sa;Password=${SA_PASSWORD};MultipleActiveResultSets=False;Connection Timeout=30;"
    ports:
    - 1322:8080
    - 10943:10943
    depends_on:
      db:
        condition: service_healthy
    stdin_open: true
</code></pre>

<h2 id="run-the-docker-compose-file">运行Docker合成文件</h2>

<p>既然Docker Compose和环境配置已经设置好了，现在是运行Docker Compose文件的时候了。</p>

<p>从<code>.env</code>和<code>docker-compose.yml</code>文件所在的目录中，运行以下命令来创建Octopus Deploy和SQL容器:</p>

<pre><code class="language-bash">docker-compose up
</code></pre>

<p>您将看到Docker合成文件正在运行。</p>

<p>现在，打开一个web浏览器，转到下面的URL来访问本地Octopus Deploy实例。</p>

<pre><code class="language-bash">http://localhost:1322/
</code></pre>

<p>您将看到Octopus Deploy登录页面:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-12/octopus-deploy-on-docker/images/loginpage.png" class="zoom" data-title=""><img src="../Images/90a7ad8da9f6e318639e7446b7538eea.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2020-12/octopus-deploy-on-docker/images/loginpage.png"/>T2】</a></p>

<p>使用<code>.env</code>配置文件中指定的Octopus deploy用户名和密码登录。</p>

<p>您现在已成功登录Octopus Deploy，可以开始使用它了。</p>

<p>如果您想更进一步，您可以使用Matthew Casperson 的<a href="https://octopus.com/blog/introducing-linux-docker-image">博客来学习如何在Kubernetes上运行Octopus Deploy Linux容器。</a></p>

<p>这篇文章中的代码可以在<a href="https://github.com/OctopusSamples/OctopusDeploy-Local-Docker-Env" rel="nofollow"> GitHub </a>中找到</p>

                    
                    
</body>
</html>