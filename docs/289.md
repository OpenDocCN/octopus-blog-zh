# GitHub 行动中的秘密-章鱼部署

> 原文：<https://octopus.com/blog/githubactions-secrets>

简而言之,“秘密”是加密的隐藏数据，但在您的项目中仍然可用。秘密可能是关于您的业务或验证方法的敏感数据，例如用于连接管道中其他服务的 API 密钥。

GitHub 允许你在 3 个不同的级别存储秘密:

*   贮藏室ˌ仓库
*   环境
*   组织

在这篇文章中，我们来看看这三个层次，以及如何给它们添加秘密。我们还将看看如何在示例工作流中调用秘密。

## 仓库机密

GitHub 只将存储库秘密绑定到一个存储库。任何具有协作者角色的人都可以在操作中使用它们。

每个存储库可以存储 100 个秘密。

### 添加存储库密码

1.  在 GitHub 中打开你的项目库，点击顶部菜单中的**设置**。
2.  点击左侧菜单中的**秘密**。
3.  点击**新建存储库密码**。
4.  填写以下字段并点击**添加密码**:
    *   给你的秘密取一个合适的名字。除下划线外，不能使用空格或特殊字符。
    *   **值**——输入秘密，比如你的 API 密匙。

您可以随时更新您的秘密值。回到储存库菜单中的**秘密**，点击你需要更改的秘密上的**更新**。

## 环境秘密

与 Octopus 一样，您可以将 GitHub 设置为使用环境部署到管道的部署目标。

如果您的回购是公开的，或者您拥有企业许可证，则可以设置仅适用于该环境的特定于环境的秘密。

每个环境中可以存储 100 个秘密。

### 创建新环境时添加秘密

1.  在 GitHub 中打开你的项目库，点击顶部菜单中的**设置**。
2.  点击左侧菜单中的**环境**。
3.  点击**新环境**。
4.  为您的环境输入一个名称，然后点击**配置环境**。
5.  根据需要设置环境的保护规则和部署分支，然后点击 **Add secret** 。
6.  填写以下字段并点击**添加密码**:
    *   给你的秘密取一个合适的名字。除下划线外，不能使用空格或特殊字符。
    *   **值**——输入秘密，比如你的 API 密匙。

### 将机密添加到现有环境中

1.  在 GitHub 中打开你的项目库，点击顶部菜单中的**设置**。
2.  点击左侧菜单中的**环境**。
3.  选择需要设置密码的环境。
4.  点击页面底部的**添加密码**。
5.  填写以下字段并点击**添加密码**:
    *   给你的秘密取一个合适的名字。除下划线外，不能使用空格或特殊字符。
    *   **值**——输入秘密，比如你的 API 密匙。

## 组织机密

1.  在 GitHub 中打开您组织的页面，点击顶部菜单中的**设置**。
2.  点击左侧菜单中的**秘密**。
3.  点击**新建组织机密**。
4.  填写以下字段并点击**添加密码**:
    *   **名字**——给你的秘密取一个合适的名字。除下划线外，不能使用空格或特殊字符。
    *   **值** -输入秘密，例如您的 API 密钥。
    *   **存储库访问** -从下拉列表中选择一个策略。您可以限制使用公共或私人回购，或手动选择它们。

## 在 GitHub 动作工作流程中使用机密

您不能将机密用于分叉存储库中的工作流。

不要在日志文件中捕获秘密。如果包含，GitHub 会隐藏秘密，但完全不包含秘密更安全。

您使用`secrets`上下文在工作流中调用您的秘密数据。GitHub 使用上下文从各种来源提取信息，包括工作流、作业和步骤。有关上下文的完整列表，请参见 [GitHub 的文档。](https://docs.github.com/en/actions/learn-github-actions/contexts)

例如，如果您想将一个包发送到 Octopus 服务器，作为工作流的一部分进行部署，那么您可以使用 secrets 上下文以及 secrets 的名称将您的工作流连接到 Octopus。

```
- name: Push Package to Octopus
   uses: OctopusDeploy/push-package-action@v1.0.0
   with:
       api_key: ${{ secrets.OCTOPUS_TEST_API }}
       packages: ${{ steps.package.outputs.artifacts }}
       server: ${{ secrets.OCTOPUS_PACKAGE_STORE }} 
```

为了解释发生了什么，工作流程的这一部分:

1.  触发一个动作将包推给 Octopus。
2.  从您的 secrets store 获取 Octopus API 密钥，以允许 GitHub 向 Octopus 传递数据。
3.  根据您的操作步骤打包您的工件。
4.  从您的机密存储中获取隐藏的包目标。

在这里，工作流使用 API 和目的地，但是将它们隐藏起来。

## 结论

机密是一种很好的安全措施，它允许您保护数据和连接到服务，而不会泄露敏感信息。

## 下一步是什么？

我们建议您查看 GitHub 的文档:

如果你还没有看过，可以看看这个持续集成系列中的其他一些博客。

Octopus 还构建了一个有用的 [GitHub Actions 工作流生成器](https://githubactionworkflows.com/)来帮助你为 GitHub 构建 CI 管道。

[试用我们免费的 GitHub Actions 工作流工具](https://oc.to/GithubActionsWorkflowGenerator)，帮助您快速为 GitHub Actions 部署生成可定制的工作流。

## 观看我们的 GitHub 行动网络研讨会

[https://www.youtube.com/embed/gLkAs_Cy5t4](https://www.youtube.com/embed/gLkAs_Cy5t4)

VIDEO

阅读我们的[持续集成系列](https://octopus.com/blog/tag/CI%20Series)的其余部分。

愉快的部署！