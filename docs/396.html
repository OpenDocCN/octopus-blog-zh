<html>
<head>
<title>Kubernetes testing with KIND - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Kubernetes使用KIND - Octopus部署进行测试</h1>
<blockquote>原文：<a href="https://octopus.com/blog/kubernetes-with-kind#2021-08-12">https://octopus.com/blog/kubernetes-with-kind#2021-08-12</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2020-01/kubernetes-with-kind/kubernetes-in-docker.png" class="zoom" data-title=""><img src="../Images/a692da9cc4eac1e114ffd8a1893e839b.png" class="img-fluid center" alt="Kubernetes in Docker (KIND)" data-original-src="https://i.octopus.com/blog/2020-01/kubernetes-with-kind/kubernetes-in-docker.png"/>T2】</a></p>

<p>有许多创建本地测试Kubernetes环境的解决方案，如<a href="https://github.com/kubernetes/minikube" rel="nofollow"> minikube </a>或<a href="https://microk8s.io/" rel="nofollow"> MicroK8s </a>，但一个名为<a href="https://github.com/kubernetes-sigs/kind" rel="nofollow"> KIND </a>的新项目提供了一种可能会引起Kubernetes开发人员和管理员兴趣的新方法。</p>

<p>KIND在Docker中代表Kubernetes，顾名思义，它使用Docker创建一个Kubernetes集群来托管节点。这是一种新颖的方法，它利用Docker简单、独立的部署和清理来创建测试Kubernetes基础设施。</p>

<h2 id="kind-installation">实物安装</h2>

<p>确保已经安装了<a href="https://docs.docker.com/install/" rel="nofollow"> Docker </a>和<a href="https://golang.org/doc/install" rel="nofollow"> Go </a>，然后使用命令安装KIND:</p>

<pre><code>GO111MODULE="on" go get sigs.k8s.io/kind@v0.6.1
</code></pre>

<p>这将把<code>kind</code>可执行文件放在目录<code>$GOPATH/bin/kind</code>中，默认情况下这个目录是<code>~/go/bin/kind</code>。</p>

<p>假设Go <code>bin</code>目录在<code>PATH</code>中，使用以下命令构建一个测试集群:</p>

<pre><code>kind create cluster --name mycluster
</code></pre>

<p>第一个集群需要一点时间来下载KIND Docker映像，尽管后续集群的创建不到一分钟。</p>

<p>KIND会将新的集群细节作为上下文添加到您的<code>~/.kube/config</code>文件中，因此您可以使用以下命令测试集群是否启动并运行:</p>

<pre><code>kubectl cluster-info --context kind-mycluster
</code></pre>

<p>您可以使用以下命令将此上下文设置为默认上下文:</p>

<pre><code>kubectl config use-context kind-mycluster
</code></pre>

<h2 id="using-the-kind-kubernetes-cluster">使用Kubernetes星团</h2>

<p>我在使用KIND时遇到的最直接的问题是访问部署到集群的服务。</p>

<p>默认情况下，KIND只公开Kubernetes API服务器。这意味着<code>kubectl</code>将按预期工作。因此您可以部署到集群并查询资源，但是访问您的服务需要一些额外的工作。</p>

<p>一个解决方案是使用<code>kubectl</code>作为代理:</p>

<pre><code>kubectl proxy --port=8080
</code></pre>

<p>Kubernetes服务可以通过一个特殊的URL获得，比如http://localhost:8080/API/v1/namespaces/default/services/web server:http-web/proxy/。</p>

<p>Kubernetes文档有关于这些代理URL的更多细节:</p>

<blockquote class="blockquote">
<p>要创建包含服务端点、后缀和参数的代理URL，只需在服务的代理URL后面追加:http://kubernetes _ master _ address/API/v1/namespaces/namespace _ name/services/[https:]service _ name[:port _ name]/proxy</p>
</blockquote>

<p>端口转发消除了构建特殊URL的需要。使用如下命令启动端口转发:</p>

<pre><code>kubectl port-forward svc/webserver 8081:80
</code></pre>

<p>该服务现在在本地端口8081上可用，将流量定向到服务端口80。这意味着URL http://localhost:8081可以用来访问服务。</p>

<p>您也可以在入口控制器上使用端口转发:</p>

<pre><code>kubectl port-forward svc/nginx-release-nginx-ingress 8081:80
</code></pre>

<p>此命令允许您通过已配置的任何入口规则访问服务。</p>

<p>KIND文档还提供了一些关于如何<a href="https://kind.sigs.k8s.io/docs/user/ingress/" rel="nofollow">暴露入口控制器</a>的附加细节，以获得更持久的解决方案。</p>

<h2 id="first-impressions">第一印象</h2>

<p>一旦我解决了访问我的服务的问题，KIND在测试版中表现得非常好。Helm等外部工具运行良好，我可以向集群部署定制的仪表板。</p>

<p>我很欣赏这种类型如此独立的事实。因为所有东西都是Docker容器，所以创建集群很快，当它被清理后，系统上就没有任何东西在运行了。</p>

<h2 id="conclusion">结论</h2>

<p>如今，让Kubernetes集群在本地运行并不困难，但是KIND让创建集群变得特别容易。诚然，Kubernetes在Docker上运行来编排Docker有点弯脑子，但为了方便也不能打。</p>

<p>KIND的真正价值是能够将它作为自动化测试的一部分来运行。我个人没有这方面的用例，但我确信它会兑现承诺。</p>

<p>我会认真考虑从现在开始使用KIND over minikube进行本地测试。</p>

                    
                    
</body>
</html>