<html>
<head>
<title>What is CNAB? - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>什么是CNAB？-章鱼部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/what-is-cnab#2021-08-12">https://octopus.com/blog/what-is-cnab#2021-08-12</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/what-is-cnab/img-blog_whatis_cnab.png" class="zoom" data-title=""><img src="../Images/2ffc1c0676dd9fd707eb3fd93d41b64e.png" class="img-fluid center" alt="Docker Whale with a Cloud Native Application Bundle on its back" data-original-src="https://i.octopus.com/blog/2019-09/what-is-cnab/img-blog_whatis_cnab.png"/>T2】</a></p>

<p>使用云基础架构可能是一项艰巨的任务。每个云提供商都有自己的CLI工具和首选部署策略，跨平台工具(如Terraform、Ansible、Puppet和Chef)需要大量投资来学习，一旦您启动了基础架构，您可能会面临管理更多部署到Docker或Kubernetes等平台的任务。</p>

<p>可以肯定地说，如今云部署几乎总是需要多种工具和凭证，而云原生应用捆绑包(CNAB)规范是对部署和管理云基础架构日益增长的复杂性的回应。</p>

<p>在本帖中，我们将看看CNAB解决的问题，CNAB工具生态系统，以及今天使用CNAB的利与弊。</p>

<h2 id="what-problem-does-cnab-solve">CNAB解决了什么问题？</h2>

<p>为了理解CNAB解决的问题，我们可以看看我们在Octopus与<a href="https://github.com/OctopusDeploy/terraform-provider-octopusdeploy" rel="nofollow"> Terraform供应商</a>遇到的一个问题。</p>

<p>该提供者的目的是允许通过Terraform配置Octopus服务器，并且该功能作为一个定制的Terraform插件公开。但是，要使用该插件，您必须手动下载它，将其放在正确的目录中，并通过传递给Terraform的命令行参数引用它。虽然在Terraform社区中有很多关于分发插件的最佳方式的讨论，但是现在仍然是一个手动的过程。</p>

<p>因为这是一个手动过程，所以提供插件和记录其使用的负担就落在了我们身上。对于像Terraform这样的跨平台工具来说，这并不是一个微不足道的负担，因为这意味着这个过程在Windows、MacOS和Linux上得到了完美的记录和测试。如果我们可以将所有需要的工具和脚本捆绑到一个单独的、自包含的可部署工件中，这不是很好吗？</p>

<p>这正是CNAB被设计出来的场景。CNAB包实质上是Docker映像的集合，包含针对远程资源执行安装所需的一切。在本例中，CNAB包将包含Terraform可执行文件、插件、Terraform模板和执行所有操作所需的脚本。最终的包消除了最终用户下载和配置单个工具的需要，而是为他们提供了一个自包含的安装程序。</p>

<p>通过提供独立的安装包，CNAB解决了在自动化复杂部署时出现的许多常见问题，包括:</p>

<ul>
<li>凭证管理</li>
<li>离线安装</li>
<li>版本化安装程序</li>
<li>签名和可验证的安装人员</li>
<li>审计线索</li>
<li>卸载过程</li>
<li>指向并单击安装程序</li>
</ul>

<h2 id="how-do-you-use-cnab">你如何使用CNAB？</h2>

<p>CNAB本身只是一个规范，实现它取决于提供者。Duffle项目提供了CNAB规范的参考实现，我们将在博客的其余部分使用这个工具。</p>

<p>Duffle可执行文件可以从项目的<a href="https://github.com/deislabs/duffle/releases" rel="nofollow"> GitHub releases </a>页面下载。为Windows、Linux和MacOS提供了预编译的二进制文件。</p>

<p>Duffle用命令<code>duffle create &lt;bundle&gt;</code>创建了一个样例包项目。将创建一个目录，其中包含Duffle项目<code>duffle.json</code>文件、<code>Dockerfile</code>和将包含在Docker映像中的示例安装脚本。</p>

<p>为了将Duffle项目转换成CNAB包，我们执行<code>duffle build</code>。这将采用Duffle特定的<code>duffle.json</code>文件中的包配置，并构建Docker映像和CNAB包。</p>

<p>构建项目意味着现在可以安装这个包了。我们可以通过运行<code>duffle bundle list</code>看到这一点，它显示了可用的包。</p>

<p>要执行安装，运行命令<code>duffle install &lt;install name&gt; &lt;bundle&gt;:&lt;version&gt;</code>。这将从包中运行install命令，在示例应用程序中，它将<code>hey I am installing things over here</code>打印到屏幕上。</p>

<p>一旦安装完成，命令<code>duffle list</code>将列出安装的详细信息。</p>

<p>要卸载一个包，运行<code>duffle uninstall &lt;install name&gt;</code>。这将运行bundle卸载脚本，对于我们的示例，该脚本将<code>hey I am uninstalling things now</code>打印到屏幕上。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/what-is-cnab/demo.svg" class="zoom" data-title=""><img src="../Images/34a7762c0c1c4bee2288c427370416ab.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/what-is-cnab/demo.svg"/>T2】</a></p>

<p>这些包也可以使用<a href="https://github.com/deislabs/duffle-bag" rel="nofollow">行李包</a>项目打包成一个独立的安装程序。这为最终用户提供了与任何其他应用程序安装程序非常相似的体验。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/what-is-cnab/gui-installer.png" class="zoom" data-title=""><img src="../Images/1ab5d719d5d53c129fc03c149a8b0a53.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/what-is-cnab/gui-installer.png"/>T2】</a></p>

<h2 id="is-cnabduffle-ready-to-use-today">CNAB/达芙蕾今天可以使用了吗？</h2>

<p>如果您现在尝试使用CNAB，有几个问题需要解决。</p>

<p>实现CNAB规范的<a href="https://cnab.io/community-projects/" rel="nofollow">项目中没有1.0版本。</a><a href="https://duffle.sh/" rel="nofollow"> Duffle </a>、<a href="https://porter.sh" rel="nofollow"> Porter </a>和<a href="https://github.com/docker/app" rel="nofollow"> Docker App </a>都还在开发他们最初的零发布版本，这意味着随着它们的发展，你可以期待一些突破性的变化。</p>

<p>安装CNAB工具本身是一个手动过程。Duffle从他们的GitHub发布页面提供二进制文件，最终用户可以下载、重命名和安装它们。理想情况下，这些安装程序将通过主要的软件仓库或商店提供，以使安装和更新它们变得轻松，但最终用户今天必须自己管理这个过程。</p>

<p>CNAB规范的目标之一是允许将包保存在中央存储库中。像CNAB到OCI这样的项目正在研究这个问题，但是像大多数CNAB工具一样，它还处于早期阶段，所以你的运气可能会有所不同。</p>

<p>最后，对于面向操作人员的工具来说，创建独立的安装程序需要安装大量未记录的开发工具。您至少需要Node.js、Python和Visual Studio Tools之类的C++编译器，即使这样，您也可以在构建期间调试深奥的错误。CNAB还没有达到堆栈溢出帖子的临界质量，以使解决这些错误变得容易。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2019-09/what-is-cnab/build-errors.png" class="zoom" data-title=""><img src="../Images/1af9fb0271e33bd0b6a0b7764492dcbc.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2019-09/what-is-cnab/build-errors.png"/>T2】</a></p>

<p><em>即使作为一名开发者，这片红色的海洋也足以让你离开这个建筑。</em></p>

<p>尽管有这些挑战，我还是惊喜地发现Visual Studio代码插件是如此容易地与Duffle项目一起工作，在经历了一些最初的挫折后，我很高兴地构建并打包了我的CNAB包。我特别喜欢构建自包含和执行安装程序的能力，以及CNAB处理凭证的事实。</p>

<p>因此，尽管随着工具更新到1.0版本，开发过程中的粗糙边缘被消除，任何加入CNAB潮流的人都可以预期会有一些颠簸，但整体CNAB捆绑包是一种分发安装程序的便捷方式，它将合并多个工具的复杂部署自动化。</p>

                    
                    
</body>
</html>