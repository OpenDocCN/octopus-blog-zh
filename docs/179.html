<html>
<head>
<title>DeployFailed.ps1 support - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>部署失败。ps1支持- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/deployfailed#2015-09-17">https://octopus.com/blog/deployfailed#2015-09-17</a></blockquote>
                        <p>今天的Octopus Deploy版本包括对一个<code>DeployFailed.ps1</code>脚本的支持，这个特性我在最近的一篇关于Octopus如何处理回滚的博文<a href="http://octopusdeploy.com/blog/rollback">中提到过。</a></p>

<h3>背景</h3>

<p>在部署过程中，触手通常会运行以下步骤:</p>

<ol>
<li>从NuGet中提取包</li>
<li>运行<code>PreDeploy.ps1</code></li>
<li>运行XML配置转换</li>
<li>替换XML配置<code>appSettings</code>和<code>connectionStrings</code></li>
<li>运行<code>Deploy.ps1</code></li>
<li>配置iis网站</li>
<li>运行<code>PostDeploy.ps1</code></li>
</ol>

<p><em>(有关这些步骤的详细信息，请参见我们在<a href="http://octopusdeploy.com/documentation/features/xml-config"> XML配置</a>、<a href="http://octopusdeploy.com/documentation/features/powershell"> PowerShell脚本支持</a>和<a href="http://octopusdeploy.com/documentation/features/iis"> IIS网站</a>上的页面)</em></p>

<h3>部署失败. ps1</h3>

<p>如果第2-7步失败，那么现在触手将寻找一个<code>DeployFailed.ps1</code>脚本，并调用它。它将可以访问其他PowerShell脚本获得的相同的<a href="http://octopusdeploy.com/documentation/features/variables">变量</a>。这是一个放置恢复操作的好地方。</p>

<p>请注意，如果步骤1失败，则<code>DeployFailed.ps1</code> <strong>不会被调用</strong>。这有几个原因:</p>

<ol>
<li><code>DeployFailed.ps1</code>无论如何也不可能被提取</li>
<li>它所依赖的文件可能没有被提取</li>
<li>在安装包之前，触手会检查可用的磁盘空间，所以这种情况应该很少发生</li>
<li>解压软件包是一项独立的任务，所以首先没有什么要恢复的</li>
</ol>

<p>一个很好的特性是传递最后安装的包的路径，恢复脚本可以在回滚时使用它。触须还没有足够的信息来做到这一点，但当<a href="https://trello.com/card/auto-purge-tentacles/4e907de70880ba000079b75c/20">自动清除触须</a>实现时，它会做到，因为两者都需要保存一份以前安装的应用程序的列表。</p>

                    
                    
</body>
</html>