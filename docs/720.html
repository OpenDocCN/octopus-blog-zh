<html>
<head>
<title>Using Octopus Subscriptions - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用八达通订阅-八达通部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/subscriptions#2017-09-29">https://octopus.com/blog/subscriptions#2017-09-29</a></blockquote>
                        

<hr/>

<p>为了介绍新的<a href="http://g.octopushq.com/Subscriptions"> Octopus Subscriptions </a>特性，我们认为展示一个简单的例子是有用的，这个例子可以在Octopus内部发生重大事件时通知一个空闲通道。</p>

<p>为此，我们需要以下内容:</p>

<ul>
<li>一只章鱼3.5。*支持<a href="http://g.octopushq.com/Subscriptions">订阅</a>的实例</li>
<li>一个Zapier帐户，用于捕获Octopus的webhooks并通知我们的Slack频道</li>
<li>用于接收通知的备用帐户和通道</li>
</ul>

<p>我们将通过这些步骤来展示如何构建一个基本的订阅通知。</p>

<h2>松弛的</h2>

<p>在Octopus，我们喜欢Slack，当重要事情发生时，它是通知我们的最佳人选(因为我们几乎不再检查我们的电子邮件:)。</p>

<p>对于这个例子，我们设置了一个名为“critical-stuff”的通道，我们希望在这里接收我们的关键通知。</p>

<p><img src="../Images/7b1454c48a0cd764561705e79d80ca78.png" alt="Slack new channel" data-original-src="https://i.octopus.com/blog/201609-slack-new-channel-HE93.png"/></p>

<h2>扎皮尔</h2>

<p>我们将使用<a href="https://zapier.com/"> Zapier </a>为我们托管一个webhook。Zapier将包含一个触发器(webhook)，然后运行一个操作(通知Slack)。这个想法是，Octopus将调用这个webhook，无论何时发生关键事件，Slack都会得到通知。</p>

<p>注意:我们使用Zapier的试用帐户来说明我们的例子。你可以选择编写自己的webhook，自己集成Slack API，但是Zapier让这变得非常简单，可以快速启动并运行，节省了我们的时间。</p>

<p>要创建触发器，请执行以下操作:</p>

<ul>
<li>登录Zapier并创建一个新的Zap。</li>
<li>从内置应用列表中选择“Webhooks ”,然后创建一个等待新帖子的“Catch Hook”。</li>
<li>在webhook设置的最后一步，Zapier会给你一个webhook的URL。记住这个值以便以后使用！我们将在Octopus订阅中使用该值。它看起来会像这样:<code>https://hooks.zapier.com/hooks/catch/.../.../</code></li>
</ul>

<p>为了测试这个webhook的连接性和有效负载，您现在需要进入Octopus并设置您的第一个订阅。但是请确保您的Zapier屏幕保持打开，以便我们可以确认测试工作，并在稍后继续添加我们的Slack操作。</p>

<h2>章鱼3.5。*</h2>

<p>你可以从我们的<a href="https://octopus.com/downloads">下载页面</a>下载Octopus的最新版本。像往常一样，在升级之前确保你有一个<a href="http://docs.octopusdeploy.com/display/OD/Backup+and+restore">备份</a>。</p>

<p>一旦你安装了Octopus 3.5，你可以从<em>配置&gt;审计&gt;订阅</em>菜单访问<a href="http://g.octopushq.com/Subscriptions">订阅</a>。我们现在可以创建一个订阅，一旦事件可用，它就调用Zapier webhooks。</p>

<p>首先，我们将创建一个名为“通知我所有事情”的订阅，请务必粘贴您的Zapier webhook URL:</p>

<p><img src="../Images/e4fefe66c0661b1766996601c8440d4f.png" alt="New Octopus subscription" data-original-src="https://i.octopus.com/blog/201609-create-subscription-7PN7.png"/></p>

<p>一旦我们保存此记录，Octopus将记录一个订阅已创建的事件。Octopus中的订阅调度程序将处理这个事件并触发Zapier webhook。</p>

<p>如果您现在跳回Zapier屏幕(最多等待30秒，让Octopus进行处理)，您的Zapier测试应该已经成功接收到来自Octopus的有效载荷:</p>

<p><img src="../Images/442d3df413045e17e2e4a5dd68fbf779.png" alt="Zapier successful test" data-original-src="https://i.octopus.com/blog/201609-zaiper-test-succeeded-MNF3.png"/></p>

<h2>回到扎皮尔整合我们的懈怠行动</h2>

<p>现在Octopus已经成功地通过我们的webhook与Zapier进行了对话，我们可以集成Slack操作了。</p>

<p>现在，您可以继续设置您的操作:</p>

<ul>
<li>在Zapier的侧边菜单中添加一个动作。</li>
<li>从流行应用列表中选择“Slack”(或使用搜索功能查找Slack)。</li>
<li>从操作列表中选择“发送频道消息”。</li>
<li>将您的Slack帐户连接到Zapier(按照提示操作)。</li>
<li>到达编辑步骤屏幕后，您可以选择想要接收通知的松弛通道。在本例中，我们选择了之前创建的“关键材料”通道。</li>
</ul>

<p>现在最酷的部分来了:我们将向Slack发送的消息:)</p>

<p>Zapier知道Octopus将在其webhook中发送的有效负载(因为我们之前发送了一个测试)，所以我们可以为消息插入一个字段，并从Octopus为每个事件交付的有效负载对象中进行选择。例如:</p>

<p><img src="../Images/23ceb34a2822683112b9acfa58a01940.png" alt="Zapier insert a field from payload" data-original-src="https://i.octopus.com/blog/201609-zapier-message-fields-UNKK.png"/></p>

<p>在我们的例子中，我们想知道“有效负载事件消息”。</p>

<p>我们现在可以继续保存Zapier操作，并继续进行测试，就像这样，当Octopus发生活动时，我们现在会在Slack中收到通知:</p>

<p><img src="../Images/98af66ab2e416ab2f282b9f453e7a0a9.png" alt="Slack notifications" data-original-src="https://i.octopus.com/blog/201609-slack-notification-3QRF.png"/></p>

<p>记住保存我们的Zap并给它一个名字(确保它已启用)，我们现在可以返回到Octopus并修改我们的订阅，以便只根据某些标准通知我们。</p>

<h2>回到Octopus(完成我们的订阅)</h2>

<p>在这种情况下，我们只想知道关键事件，如部署失败或自动部署被阻止。我们可以很容易地修改我们之前所做的订阅来实现这一点:</p>

<ul>
<li>用八达通开通我们的订阅。</li>
<li>选择“通知我所有事情！”我们之前做的订阅。</li>
<li>将订阅的名称编辑为“关键事件通知”。</li>
<li>使用事件组过滤器仅选择关键事件。</li>
<li>保存。</li>
</ul>

<p><img src="../Images/f280d58ffcd6e176333a66dad7d2132b.png" alt="Critical events notifications" data-original-src="https://i.octopus.com/blog/201609-subscription-critical-Y8EB.png"/></p>

<p>现在，只要Octopus内部发生重大事件，Octopus就会通知我们的Slack频道(通过我们的Zapier webhook)</p>

<p>您可以在我们的<a href="http://g.octopushq.com/Subscriptions">订阅</a>文档中了解更多关于订阅的信息，包括向特定团队发送电子邮件和确定订阅范围。</p>

                    
                    
</body>
</html>