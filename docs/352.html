<html>
<head>
<title>Introduction to HCL and HCL tooling - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>HCL和HCL工具简介- Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/introduction-to-hcl-and-hcl-tooling#2021-08-23">https://octopus.com/blog/introduction-to-hcl-and-hcl-tooling#2021-08-23</a></blockquote>
                        <p><a href="#" data-featherlight="https://i.octopus.com/blog/2021-07/introduction-to-hcl-and-hcl-tooling/blogimage-config-as-code-explanation_2020.png" class="zoom" data-title=""><img src="../Images/a6098e741b1052b05b31f3c8e78f3f16.png" class="img-fluid center" alt="A laptop screen displaying analytics data that is peeled up on one corner showing the code behind it" data-original-src="https://i.octopus.com/blog/2021-07/introduction-to-hcl-and-hcl-tooling/blogimage-config-as-code-explanation_2020.png"/>T2】</a></p>

<p><a href="https://www.terraform.io/docs/configuration/index.html" rel="nofollow"> HashiCorp配置语言(HCL) </a>是一种独特的配置语言。它被设计用于HashiCorp工具，特别是Terraform，但是HCL已经扩展为一种更通用的配置语言。它在视觉上类似于JSON，并内置了额外的数据结构和功能。</p>

<p>HCL由三个子语言组成:</p>

<ul>
<li>结构的</li>
<li>表示</li>
<li>模板</li>
</ul>

<p>当组合起来时，这些子语言形成了一个结构良好的HCL配置文件。这种结构有助于准确、轻松地描述Terraform工具所需的环境配置。</p>

<p>最近，HCL已经放弃使用该语言的版本1，转而使用版本2。这篇文章假设我们谈论的是HCL2而不是HCL1。</p>

<p>HCL2是HCL和HashiCorp插值语言(HIL)的组合。HIL增加了字符串插值和更强的在变量声明中使用函数的能力。</p>

<p>除了Terraform之外，HCL还可以用于其他工具。随着时间的推移，不同的解析器变得可用，比如Go、Java和Python。在这篇文章中，我将讨论如何开始使用HCL，以及哪些工具可以利用它的独特特性。</p>

<h2 id="the-hcl-language-and-features">HCL语言和特性</h2>

<p>HCL是一种JSON兼容语言，它增加了一些功能来帮助您最大限度地使用Terraform工具。这些特性使HCL成为一种强大的配置语言，并解决了JSON的一些缺点。</p>

<ul>
<li>注释有单行和多行两种形式:<ul>
<li>单线:<code>#</code>或<code>//</code>。</li>
<li>多行:<code>/* */</code>(无块注释嵌套)。</li>
</ul>
</li>
<li>变量赋值使用<code>key = value</code>结构，其中空格无关紧要，值可以是一个原语，比如字符串、数字、布尔值、对象或列表。</li>
<li>字符串用引号括起来，可以包含任何UTF-8字符。</li>
<li>数字可以用多种不同的方式书写和解析:<ul>
<li>十进制数是默认值。</li>
<li>十六进制:用<code>0x</code>作为数字的前缀。</li>
<li>八进制:在数字前加一个<code>0</code>。</li>
<li>科学数字:使用符号，如<code>1e10</code>。</li>
</ul>
</li>
<li>使用<code>[]</code>创建数组和<code>{ key = value }</code>创建列表很容易。</li>
</ul>

<p>这个概述只是触及了HCL的皮毛。通过研究一个示例配置文件并分析其工作原理，可以更容易地了解HCL的工作原理。</p>

<h2 id="creating-a-simple-hcl-configuration-file">创建简单的HCL配置文件</h2>

<p>为了了解HCL配置的实际情况，让我们创建一个简单的配置，演示一些可用的功能:</p>

<pre><code class="language-bash">/*
Define the default configuration values here
*/
default_address = "127.0.0.1"
default_message = upper("Incident: ${incident}")
default_options = {
  priority: "High",
  color: "Red"
}

incident_rules {
    # Rule number 1
    rule "down_server" "infrastructure" {
        incident = 100
        options  = var.override_options ? var.override_options : var.default_options
        server   = default_address
        message  = default_message
    }
}
</code></pre>

<p>你可能注意到我们对<code>default_message</code>变量使用了函数调用和字符串插值。<code>upper()</code>函数将使字符串大写，而<code>${}</code>构造用给定字符串中的值替换其中的变量。</p>

<p>与其他配置语言相比，另一个突出的特性是<code>rule "down_server" "infrastructure"</code>格式。这是一个<code>type label label</code>格式。在这个例子中，我们定义了应用程序中使用的规则类型和规则类别。</p>

<p>你也可以看到我们为<code>options</code>变量使用了一个三元条件。如果<code>override_options</code>变量存在，我们就使用那个值，否则我们就使用<code>default_options</code>。这种配置展示了HCL利用逻辑、字符串插值和语言内部操作的强大能力。</p>

<h2 id="editing-hcl-configurations-easily">轻松编辑HCL配置</h2>

<p>Visual Studio Code  (VS Code)是目前最流行的编辑器之一，由微软免费提供。VS代码有扩展，为基本编辑器增加了额外的功能。其中包括:</p>

<ul>
<li>一个<a href="https://marketplace.visualstudio.com/items?itemName=wholroyd.HCL" rel="nofollow"> HCL扩展</a>来提供适当的语言着色。</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=4ops.terraform" rel="nofollow"> Terraform扩展</a>也增加了HCL支持，尽管是以HashiCorp工具之一命名的。这个扩展提供了语法突出显示和基本验证。</li>
</ul>

<p>Atom编辑器是VS代码的替代编辑器，也很受欢迎。它还提供了一个<a href="https://atom.io/packages/language-hcl" rel="nofollow"> HCL语法高亮</a>包。</p>



<p>到目前为止，我已经讨论了在HashiCorp工具的上下文中使用HCL，但是还有其他工具使用HCL文件用于不同的应用程序。</p>

<p>一个例子是<a href="https://hclq.sh/" rel="nofollow"> hclq命令行处理器</a>。这个命令行处理器提供了以下功能:</p>

<ul>
<li>配置的检查和验证。</li>
<li>用<code>grep</code>或<code>sed</code>解析文件的替代方法。</li>
<li>值插值的预处理。</li>
</ul>

<p>请注意，该工具目前没有HCL2支持，但它是计划中的。</p>


<p>许多组织现在使用Go编程语言，因此在Go程序中使用HCL可能是一个有吸引力的选择。有一个<a href="https://godoc.org/github.com/hashicorp/hcl" rel="nofollow"> Go包</a>可以把HCL解码成可用的Go结构。</p>

<p>该模块使用HCL配置，并将输入解码为抽象语法树(AST ),从而可以在Go中轻松操作配置。将HCL2集成到服务器端Go程序中，可以让你使用简单易懂的复杂配置。</p>

<p>对于Python来说，有一个<a href="https://pypi.org/project/python-hcl2/" rel="nofollow"> HCL2解析器</a>不支持HCL1，但是对于大多数项目来说这是不必要的。Python HCL2使用解析工具包Lark构建，使得将HCL2配置集成到任何Python项目中变得容易。</p>

<h2 id="conclusion">结论</h2>

<p>HashiCorp配置语言最初是特定于HashiCorp的，但已经发展到在各种项目中变得更有吸引力。</p>

<p>最近的HCL2重写进一步合并了字符串插值和附加函数。这增加了已经很灵活的语言的可用性。易于理解的内置模板化的配置语言的强大功能，正在迅速使HCL2成为复杂配置的首选语言。</p>

<p>愉快的部署！</p>

<hr/>

<p>Adam Bertram拥有20多年的IT经验，是一名经验丰富的在线商务专家。他是多家科技公司的顾问、微软MVP、博客作者、培训师、出版作家和内容营销人员。在adamtheautomator.com的<a href="http://adamtheautomator.com/" rel="nofollow">网站</a>上关注亚当的文章，在LinkedIn的<a href="https://www.linkedin.com/in/adbertram" rel="nofollow">网站</a>上联系，或者在Twitter的<a href="https://twitter.com/adbertram" rel="nofollow"> @adbertram </a>上关注他。</p>

                    
                    
</body>
</html>