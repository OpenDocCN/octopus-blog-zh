<html>
<head>
<title>Configuring a GitHub NuGet registry as an external feed - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>将GitHub NuGet注册表配置为外部feed - Octopus部署</h1>
<blockquote>原文：<a href="https://octopus.com/blog/github-nuget-external-feed#2022-07-21">https://octopus.com/blog/github-nuget-external-feed#2022-07-21</a></blockquote>
                        <p>GitHub已经不仅仅是一个源代码库。GitHub的人们已经开发了一些功能，比如他们的构建服务器产品、GitHub操作和问题跟踪。他们甚至开发了GitHub包，这是一个与Docker容器、npm、Maven、NuGet包和RubyGems兼容的注册表。</p>

<p>在这篇文章中，我将向您展示如何配置GitHub Actions作业来将. NET核心NuGet包推入注册表，并将注册表连接到Octopus Deploy，作为一个<a href="https://octopus.com/docs/packaging-applications/package-repositories">外部提要</a>。</p>

<h2 id="configuring-the.net-core-application">正在配置。网络核心应用</h2>

<p>要将包推送到GitHub包，需要在<code>.csproj</code>文件中指定<code>RepositoryUrl</code>元素。当打包并将包推送到注册表时，<code>dotnet</code>命令会使用这些信息。以下是OctoPetShop数据库项目的一个示例:</p>

<p>八分之一样本。OctoPetShop.Database.csproj </p>

<pre><code class="language-xml">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;

  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;netcoreapp2.1&lt;/TargetFramework&gt;
    &lt;RuntimeIdentifiers&gt;win-x64;linux-x64&lt;/RuntimeIdentifiers&gt;
    &lt;TargetLatestRuntimePatch&gt;true&lt;/TargetLatestRuntimePatch&gt;
    &lt;RepositoryUrl&gt;https://github.com/OctopusSamples/OctoPetShop.git&lt;/RepositoryUrl&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include="dbup" Version="4.2.0" /&gt;
  &lt;/ItemGroup&gt;

  &lt;ItemGroup&gt;
    &lt;EmbeddedResource Include="scripts/*.sql" /&gt;
  &lt;/ItemGroup&gt;

  &lt;ItemGroup&gt;
    &lt;None Update="deploy.sh" CopyToOutputDirectory="PreserveNewest" /&gt;
    &lt;None Update="deploy.ps1" CopyToOutputDirectory="PreserveNewest" /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;
</code></pre>

<h2 id="configuring-github-actions-build">配置GitHub操作构建</h2>

<p>除了构建应用程序，GitHub Actions作业还需要执行以下活动:</p>

<ul>
<li>将应用程序组件打包到NuGet包中</li>
<li>添加NuGet存储库源</li>
<li>将包推入包注册表</li>
</ul>

<p>所有这些命令都可以在。NET CLI。</p>

<h3 id="packaging-the-application-into-a-nuget-package">将应用程序打包到NuGet包中</h3>

<p>您可以通过多种方式将应用程序打包到NuGet包中。这篇文章使用了内置在。NET CLI。</p>

<p>要设置包版本，请使用MSBuild语法<code>-p:PackageVersion $PACKAGE_VERSION</code>。变量<code>$PACKAGE_VERSION</code>在之前的GitHub Actions YAML中已经声明过了(参见<a href="https://github.com/OctopusSamples/OctoPetShop/blob/master/.github/workflows/dotnet-core-nuget.yml" rel="nofollow">我们的OctoPetShop示例</a>了解整个过程)。以下是显示OctoPetShop数据库项目打包的构建摘录:</p>

<pre><code class="language-yaml">    - name: Pack OctoPetShopDatabase
      run: |
        dotnet pack OctopusSamples.OctoPetShop.Database/OctopusSamples.OctoPetShop.Database.csproj --configuration Release --output "$GITHUB_WORKSPACE/artifacts/OctopusSamples.OctoPetShop.Database" -p:PackageVersion=$PACKAGE_VERSION
</code></pre>

<h3 id="adding-the-nuget-repository-source">添加NuGet存储库源</h3>

<p>要定位GitHub包注册表，您需要添加注册表作为源。<code>source</code> URL的格式如下:<code>https://nuget.pkg.github.com/YourGitHubUsernameOrOrganizationName/index.json</code>。</p>

<p>您还需要指定具有足够权限的凭据，以便将包推送到注册表。您可以创建个人访问令牌(PAT)或使用GitHub Actions<code>GITHUB_TOKEN</code>中的内置密码。</p>

<pre><code class="language-yaml">    - name: Add source
      run: |
        dotnet nuget add source "https://nuget.pkg.github.com/OctopusSamples/index.json" --username OctopusSamples --password ${{ secrets.GITHUB_TOKEN }} --store-password-in-clear-text --name github 
</code></pre>

<h3 id="pushing-the-package-into-the-package-registry">将包推入包注册表</h3>

<p>您还需要为<code>push</code>命令指定凭证，并且您还可以使用<code>GITHUB_TOKEN</code>作为<code>--api-key</code>参数:</p>

<pre><code class="language-yaml">    - name: Push packages to GitHub Packages NuGet feed
      run: |
        dotnet nuget push "$GITHUB_WORKSPACE/artifacts/OctopusSamples.OctoPetShop.Database/OctopusSamples.OctoPetShop.Database.$PACKAGE_VERSION.nupkg"  --api-key ${{ secrets.GITHUB_TOKEN }} --source "github"
</code></pre>

<p>推送完包后，它们应该出现在GitHub项目的<strong>包</strong>部分。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-packages.png" class="zoom" data-title=""><img src="../Images/331005ef663ec37c94ddacd877dbf296.png" class="img-fluid center" alt="GitHub project with Packages section highlighted" data-original-src="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-packages.png"/>T2】</a></p>

<h2 id="configuring-github-package-registry-as-an-external-feed">将GitHub包注册表配置为外部提要</h2>

<p>GitHub包注册中心需要认证来拉包。在配置提要之前，首先需要在GitHub中创建一个PAT。</p>

<h3 id="creating-a-pat-in-github">在GitHub中创建PAT</h3>

<p>创建PAT相对简单。首先，点击右上角的个人资料，然后选择<strong>设置</strong>。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-profile-settings.png" class="zoom" data-title=""><img src="../Images/deab6f7980962192c3eff4d830900d6a.png" class="img-fluid center" alt="GitHub project with Settings highlighted" data-original-src="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-profile-settings.png"/>T2】</a></p>

<p>滚动至左侧菜单底部，点击<strong>开发者设置</strong>。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-developer-settings.png" class="zoom" data-title=""><img src="../Images/ebf34efe9efa52a85b16089dfc60025a.png" class="img-fluid center" alt="GitHub project with Developer Settings highlighted" data-original-src="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-developer-settings.png"/>T2】</a></p>

<p>点击<strong>个人访问令牌</strong>，然后<strong>生成新令牌</strong>。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-generate-token.png" class="zoom" data-title=""><img src="../Images/5480207996c83e35630b0b921fbbb770.png" class="img-fluid center" alt="GitHub project with Personal access tokens and Generate new token highlighted" data-original-src="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-generate-token.png"/>T2】</a></p>

<p>给令牌一个描述，选择一个到期时间，并分配<code>read:packages</code>权限。点击<strong>生成令牌</strong>。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-new-token.png" class="zoom" data-title=""><img src="../Images/d027c2d378f0cdf44500d6b9c2d9d6ea.png" class="img-fluid center" alt="New personal access token screen" data-original-src="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/github-new-token.png"/>T2】</a></p>

<p>复制新令牌并将其保存在安全的位置。</p>

<h3 id="creating-an-external-feed">创建外部源</h3>

<p>要创建外部进给，点击<strong>库</strong>，然后点击<strong>外部进给</strong>，然后点击<strong>添加进给</strong>。</p>

<p>【T2 <img src="../Images/81e7d028a6bc196d7c97da7212b4390a.png" class="img-fluid center" alt="Octopus dashboard with External Feeds highlighted" data-original-src="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/octopus-add-feed.png"/></p>

<p>填写饲料表格:</p>

<ul>
<li><strong>进给类型</strong> : <code>NuGet Feed</code></li>
<li><strong>名称</strong>:输入描述性名称</li>
<li><strong>网址</strong> : <code>https://nuget.pkg.github.com/YourGitHubUsernameOrOrganizationName/index.json</code></li>
<li><strong>凭证</strong>          <ul>
<li><strong>用户名</strong>:令牌的用户名</li>
<li><strong>密码</strong>:您之前生成的PAT</li>
</ul>
</li>
</ul>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/octopus-new-feed.png" class="zoom" data-title=""><img src="../Images/2f025fd48440027d1a6f7329778b95e4.png" class="img-fluid center" alt="External Feeds in Octopus Deploy" data-original-src="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/octopus-new-feed.png"/>T2】</a></p>

<p>点击<strong>保存并测试</strong>。输入您用自己的版本创建的包的部分名称，以确保feed正常工作。</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/octopus-test-feed.png" class="zoom" data-title=""><img src="../Images/f3654c94b1e57dad5c6669fb611a25c6.png" class="img-fluid center" alt="" data-original-src="https://i.octopus.com/blog/2022-08/github-nuget-external-feed/octopus-test-feed.png"/>T2】</a></p>

<h2 id="conclusion">结论</h2>

<p>在这篇文章中，我演示了如何使用。NET CLI在GitHub Actions中，并将包推送到GitHub Packages注册表中。然后，我向您展示了如何在Octopus Deploy中将注册中心配置为外部提要。</p>

<p>你可能也会对我关于使用GitLab feeds和Octopus Deploy 的帖子感兴趣。</p>

<p>愉快的部署！</p>

                    
                    
</body>
</html>