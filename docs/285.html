<html>
<head>
<title>New in GitHub Actions for Octopus Deploy v3 - Octopus Deploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Octopus Deploy v3 - Octopus Deployçš„GitHubåŠ¨ä½œä¸­çš„æ–°åŠŸèƒ½</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://octopus.com/blog/github-actions-for-octopus-deploy-v3#2022-12-16">https://octopus.com/blog/github-actions-for-octopus-deploy-v3#2022-12-16</a></blockquote>
                        <p>æˆ‘ä»¬åœ¨2021å¹´6æœˆå‘GitHubå¸‚åœºå‘å¸ƒäº†ç¬¬ä¸€ç»„<a href="https://octopus.com/blog/github-actions-for-octopus-deploy"> GitHubè¡ŒåŠ¨ã€‚ç„¶ååœ¨2022å¹´9æœˆï¼Œ</a><a href="https://octopus.com/blog/new-in-github-actions">æˆ‘ä»¬æ›´æ–°äº†æˆ‘ä»¬çš„è¡ŒåŠ¨ï¼ŒåŠ å…¥äº†è®¸å¤šæ–°åŠŸèƒ½</a>ã€‚</p>

<p>ä½œä¸ºæˆ‘ä»¬é’ˆå¯¹Octopus Deployçš„GitHubåŠ¨ä½œçš„ç¬¬ä¸‰æ¬¡è¿­ä»£çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬åšäº†è¿›ä¸€æ­¥çš„æ”¹è¿›ï¼Œå¹¶æ·»åŠ äº†5ä¸ªæ–°åŠ¨ä½œã€‚</p>

<p>äº®ç‚¹åŒ…æ‹¬:</p>

<ul>
<li>æˆ‘ä»¬æ¶ˆé™¤äº†å¯¹Octopus CLIçš„ä¾èµ–ï¼Œè¿™ä¹Ÿæ„å‘³ç€æ ‡å‡†çš„ç¯å¢ƒå˜é‡åå·²ç»æ”¹å˜</li>
<li><a href="https://github.com/marketplace/actions/install-octopus-cli" rel="nofollow">install-octopus-CLI-action</a>ç°åœ¨å®‰è£…<a href="https://github.com/OctopusDeploy/cli" rel="nofollow">æˆ‘ä»¬åŸºäºGoçš„CLI ( <code>octopus</code> ) </a></li>
<li>éƒ¨ç½²ç‰ˆæœ¬å’Œæ‰§è¡Œæ“ä½œæ‰‹å†Œæœ‰äº†æ–°çš„æ“ä½œ:</li>
<li>åˆ›å»ºZipå’ŒNuGetåŒ…æœ‰æ–°çš„æ“ä½œ:</li>
<li>é“¾æ¥æ“ä½œæ˜¯ä¸€é¡¹å†…ç½®åŠŸèƒ½</li>
</ul>

<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»æŠ€æœ¯ä¸Šæ·±å…¥æ¢è®¨äº†è¿™æ¬¡è¿­ä»£çš„å…³é”®å˜åŒ–ï¼Œå¹¶å‘æ‚¨å±•ç¤ºäº†ä½¿ç”¨æ–°åŠ¨ä½œçš„ç¤ºä¾‹ã€‚</p>

<h2 id="octopus-cli-is-no-longer-required">ä¸å†éœ€è¦Octopus CLI</h2>

<p>æ¶ˆé™¤å¯¹Octopus CLIçš„ä¾èµ–æ˜¯GitHubæ“ä½œçš„æœ€å¤§æ¶æ„å˜åŒ–ã€‚</p>

<p>æˆ‘ä»¬çš„æ“ä½œä¸å†ä½¿ç”¨Octopus CLIæ¥æ‰§è¡Œå·¥ä½œã€‚ç›¸åï¼Œå®ƒä»¬ç›´æ¥ä»TypeScriptä¸Octopus APIäº¤äº’ã€‚è¿™æ„å‘³ç€æ‚¨çš„å·¥ä½œæµå¯åŠ¨å’Œæ‰§è¡Œé€Ÿåº¦æ¯”ä»¥å‰å¿«å¾—å¤šã€‚</p>

<p>æ‚¨ä»ç„¶å¯ä»¥ä½¿ç”¨Octopus CLIï¼Œä½†æ˜¯å¦‚æœæ‚¨åªéœ€è¦ä½¿ç”¨æˆ‘ä»¬çš„å…¶ä»–æ“ä½œï¼Œåˆ™ä¸å†éœ€è¦å°†<strong>install-Octopus-CLI-action</strong>åŒ…å«åœ¨æ‚¨çš„å·¥ä½œæµä¸­ã€‚</p>
<p>å¦‚æœæ‚¨æœ‰è‡ªå·±éœ€è¦çš„è„šæœ¬ï¼Œé‚£ä¹ˆ<strong>install-octopus-CLI-action</strong>ä»ç„¶å¯ä¾›æ‚¨ä½¿ç”¨ã€‚</p>


<h2 id="install-octopus-cli-action-now-installs-the-go-based-cli">å®‰è£…Octopus CLIæ“ä½œç°åœ¨å®‰è£…åŸºäºGoçš„CLI</h2>

<p>æˆ‘ä»¬æœ€è¿‘å°†CLIå®ç°ä»C#è½¬ç§»åˆ°äº†Go(å…³äºåŸå› çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://octopus.com/blog/building-octopus-cli-vnext">æ„å»ºOctopus CLI vNext </a>)ã€‚Octopus CLI ( <code>octo</code>)å°†ç»§ç»­å¾—åˆ°æ”¯æŒï¼Œç›´åˆ°2023å¹´å¹´ä¸­ã€‚å®é™…ä¸Šï¼Œ<strong>install-Octopus-CLI-action</strong>çš„v1ä¼šç»§ç»­å®‰è£…Octopus CLI ( <code>octo</code>)ã€‚å¦‚æœæ‚¨æœ‰ä½¿ç”¨åŸºäºC#çš„CLIçš„ç°æœ‰å·¥ä½œæµï¼Œæ‚¨å¯ä»¥ç»§ç»­ä½¿ç”¨æ­¤æ“ä½œçš„v1ã€‚</p>

<p><strong>install-octopus-CLI-action</strong>v3(æˆ–æ›´é«˜ç‰ˆæœ¬)åªä¼šå®‰è£…æ–°çš„åŸºäºGoçš„CLI ( <code>octopus</code>)ã€‚å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™æ–°çš„å·¥ä½œæµï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨v3ã€‚åŸºäºGoçš„CLI ( <code>octopus</code>)å…·æœ‰åŸºäºC#çš„CLIæ‰€æ²¡æœ‰çš„æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œä½†æ˜¯ï¼Œä¹Ÿæœ‰ä¸€äº›å¾®å°çš„å·®å¼‚ã€‚å¦‚æœ‰å¿…è¦ï¼Œè¿™äº›CLIå¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚</p>

<h2 id="environment-variable-names">ç¯å¢ƒå˜é‡å</h2>

<p>ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬æå€¡åœ¨æ“ä½œä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œè€Œä¸æ˜¯CLIå‚æ•°ã€‚</p>

<p>æˆ‘ä»¬ä»ç„¶é¼“åŠ±æ‚¨ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥è®¾ç½®æ•æ„Ÿå€¼(å³APIé”®)ï¼Œä½†æ˜¯åœ¨æ–°ç‰ˆæœ¬çš„æ“ä½œä¸­ï¼Œåç§°å·²ç»æ”¹å˜ï¼Œå› ä¸ºä¸å†æ˜¯Octopus CLIæ¥é€‰æ‹©å®ƒä»¬ã€‚</p>

<table class="table">
<thead>
<tr>
<th>ä»·å€¼</th>
<th>æ—§å˜é‡</th>
<th>æ–°å˜é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>OctopusæœåŠ¡å™¨URL</td>
<td><code>OCTOPUS_CLI_SERVER</code></td>
<td><code>OCTOPUS_URL</code></td>
</tr>
<tr>
<td>Octopus APIå¯†é’¥</td>
<td><code>OCTOPUS_CLI_API_KEY</code></td>
<td><code>OCTOPUS_API_KEY</code></td>
</tr>
<tr>
<td>ç« é±¼ç©ºé—´åç§°</td>
<td/>
<td><code>OCTOPUS_SPACE</code></td>
</tr>
</tbody>
</table>

<h2 id="deployment-and-runbook-run-actions">éƒ¨ç½²å’Œè¿è¡Œæ‰‹å†Œè¿è¡Œæ“ä½œ</h2>

<p>GitHub Actions for Octopus Deploy v3ä¸ºéƒ¨ç½²å’Œrunbookè¿è¡Œå¼•å…¥äº†3é¡¹æ–°æ“ä½œ:</p>



<p>åœ¨<strong>åˆ›å»º-é‡Šæ”¾-åŠ¨ä½œ</strong>çš„v1ä¸­ï¼Œæˆ‘ä»¬æ”¯æŒæ¥è‡ªOctopus CLI ( <code>octo</code>)çš„æ—§çš„<code>deploy-to</code>å‚æ•°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™å¸¦æ¥äº†Octopus CLI ( <code>octo</code>)æ”¯æŒçš„æ‰€æœ‰å…¶ä»–ä¸éƒ¨ç½²ç›¸å…³çš„å¼€å…³ã€‚è¿™å¢åŠ äº†åŠ¨ä½œå‚æ•°ï¼Œä½¿å®ƒä»¬å˜å¾—å¤æ‚å’Œæ··ä¹±ã€‚</p>

<p>ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œ<code>--variable</code>å‚æ•°ç»å¸¸è®©äººå‡ºé”™ã€‚å®ƒåªé€‚ç”¨äºä¸ºéƒ¨ç½²è®¾ç½®æç¤ºå˜é‡çš„å€¼ï¼Œä½†æ˜¯çœ‹èµ·æ¥å®ƒå¯ä»¥ç”¨äºåœ¨å‘å¸ƒåˆ›å»ºæœŸé—´è®¾ç½®é¡¹ç›®å˜é‡å€¼ã€‚</p>

<p>åŸºäºè¿™äº›å‚æ•°ç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨Octopus Deploy v2çš„GitHub Actionsä¸­åˆ é™¤äº†å®ƒä»¬ï¼Œä»¥æ¶ˆé™¤æ··æ·†ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æˆ‘ä»¬ç°åœ¨åœ¨v3ä¸­æ‹¥æœ‰çš„ï¼Œç”¨äºæ’é˜Ÿéƒ¨ç½²(å’Œrunbooksè¿è¡Œ)çš„ç‹¬ç«‹åŠ¨ä½œã€‚</p>

<p>Octopus CLI ( <code>octo</code>)ä¹Ÿå°†æ˜¯å¦ç­‰å¾…éƒ¨ç½²å®Œæˆçš„æ¦‚å¿µæ†ç»‘åˆ°åŒä¸€ä¸ªå‘½ä»¤ä¸­ã€‚æˆ‘ä»¬ä¹ŸæŠŠå®ƒåˆ†æˆäº†è‡ªå·±çš„åŠ¨ä½œã€‚ä¹ä¸€çœ‹è¿™ä¼¼ä¹æœ‰äº›è¿‡åˆ†ï¼Œä½†æ˜¯å½“ä¸GitHubåŠ¨ä½œçš„å…¶ä»–ç‰¹æ€§ç»“åˆä½¿ç”¨æ—¶ï¼Œå®ƒå…è®¸æ›´å¤§çš„çµæ´»æ€§ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­è¯¦ç»†è®¨è®ºè¿™ä¸€ç‚¹ã€‚</p>

<p>ç§Ÿèµéƒ¨ç½²ä¸â€œæ ‡å‡†â€éƒ¨ç½²å…·æœ‰ä¸åŒçš„è¯­ä¹‰ã€‚é¦–å…ˆï¼Œå®ƒä»¬æ”¯æŒæ‚¨å¯ä»¥éƒ¨ç½²åˆ°çš„ç¯å¢ƒçš„ä¸åŒå¤šæ ·æ€§(æ ‡å‡†ç‰ˆå¯ä»¥éƒ¨ç½²åˆ°å¤šä¸ªç¯å¢ƒï¼Œç§Ÿç”¨ç‰ˆåªèƒ½éƒ¨ç½²åˆ°ä¸€ä¸ªç¯å¢ƒ)ã€‚ä¸ºäº†åœ¨åŠ¨ä½œå¥‘çº¦ä¸­æ˜ç¡®è¿™ä¸€ç‚¹ï¼Œ<strong>éƒ¨ç½²-é‡Šæ”¾-ç§Ÿèµ-åŠ¨ä½œ</strong>ä¸<strong>éƒ¨ç½²-é‡Šæ”¾-åŠ¨ä½œ</strong>æ˜¯åˆ†å¼€çš„ã€‚</p>


<p>è™½ç„¶è¿™æ˜¯è¿™äº›åŠ¨ä½œçš„åˆå§‹ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬å†³å®šå°†å®ƒä»¬å‘å¸ƒä¸ºv3ï¼Œä»¥ä¾¿æ›´å®¹æ˜“å°†è¿™äº›æ–°åŠ¨ä½œä½œä¸ºåŒ¹é…é›†è¿›è¡Œæ¨ç†ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç‰ˆæœ¬ä¼šå†æ¬¡å‡ºç°åˆ†æ­§ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šå•ç‹¬å¯¹åŠ¨ä½œè¿›è¡Œä¿®è¡¥å’Œæ›´æ–°ã€‚</p>


<h2 id="actions-for-creating-zip-and-nuget-packages">åˆ›å»ºZipå’ŒNuGetåŒ…çš„æ“ä½œ</h2>

<p>GitHub Actions for Octopus Deploy v3å¼•å…¥äº†2ä¸ªæ–°çš„åŒ…åˆ›å»ºæ“ä½œ:</p>



<p>Zipå’ŒNuGetåŒ…æ˜¯ç”¨äºåˆ†å‘å’Œéƒ¨ç½²è½¯ä»¶åº”ç”¨ç¨‹åºçš„å½’æ¡£æ–‡ä»¶ã€‚</p>

<ul>
<li>Zipæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å½’æ¡£æ ¼å¼ï¼Œå¯ä»¥ç”±è®¸å¤šä¸åŒçš„åº”ç”¨ç¨‹åºæ‰“å¼€ã€‚</li>
<li>NuGetåŒ…æ˜¯ä¸“é—¨ä¸ºä¸Microsoftå¼€å‘å¹³å°ä¸€èµ·ä½¿ç”¨è€Œè®¾è®¡çš„ï¼Œç”¨äºåˆ†å‘å¯ä»¥è½»æ¾é›†æˆåˆ°ä¸­çš„åº“å’Œå…¶ä»–èµ„æºã€‚NETåº”ç”¨ç¨‹åºã€‚</li>
</ul>

<p>Zipå’ŒNuGetåŒ…é€šå¸¸ç”¨äºåˆ†å‘è½¯ä»¶ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†ä¸€ç§æ–¹ä¾¿æœ‰æ•ˆçš„æ–¹å¼æ¥æ‰“åŒ…å’Œåˆ†å‘å¤§é‡æ–‡ä»¶ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬è§‚å¯Ÿå®¢æˆ·ä½¿ç”¨Octopus CLI ( <code>octo</code>)é€šè¿‡<code>pack</code>å‘½ä»¤ç”ŸæˆåŒ…ã€‚è¿™äº›åŠ¨ä½œæ¶ˆé™¤äº†è¿™ç§éœ€æ±‚ï¼ŒåŒæ—¶é€šè¿‡GitHubåŠ¨ä½œæä¾›äº†é›†æˆçš„ä½“éªŒã€‚</p>

<h2 id="chaining-is-a-built-in-feature">é“¾æ¥æ˜¯ä¸€ç§å†…ç½®åŠŸèƒ½</h2>

<p>è®¸å¤šåŠ¨ä½œäº§ç”Ÿè¾“å‡ºï¼Œä»¥å®ç°åŠ¨ä½œçš„é“¾æ¥ã€‚è¾“å‡ºå¦‚ä¸‹:</p>

<table class="table">
<thead>
<tr>
<th>è¡Œä¸º</th>
<th>è¾“å‡º</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create-release-action</code></td>
<td><code>release_number</code></td>
<td>åˆ›å»ºçš„å‘å¸ƒå·(ç‰ˆæœ¬)</td>
</tr>
<tr>
<td><code>deploy-release-action</code></td>
<td><code>server_tasks</code></td>
<td>å¸¦æœ‰<code>serverTaskId</code>å’Œ<code>environmentName</code>çš„JSONå¯¹è±¡æ•°ç»„</td>
</tr>
<tr>
<td><code>deploy-release-tenanted-action</code></td>
<td><code>server_tasks</code></td>
<td>å¸¦æœ‰<code>serverTaskId</code>å’Œ<code>tenantName</code>çš„JSONå¯¹è±¡æ•°ç»„</td>
</tr>
<tr>
<td><code>run-runbook-action</code></td>
<td><code>server_tasks</code></td>
<td>å¸¦æœ‰<code>serverTaskId</code>ã€<code>environmentName</code>å’Œ<code>tenantName</code>çš„å¯¹è±¡çš„JSONæ•°ç»„</td>
</tr>
<tr>
<td><code>await-task-action</code></td>
<td><code>completed_successfully</code></td>
<td>æ— è®ºä»»åŠ¡æ˜¯å¦æˆåŠŸå®Œæˆ</td>
</tr>
</tbody>
</table>

<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°å±•ç¤ºå¦‚ä½•ä½¿ç”¨JSONæ•°ç»„ã€‚</p>

<p>åœ¨<code>await-task-action</code>çš„è¾“å‡ºä¸­ï¼Œè¯·æ³¨æ„å¦‚æœä»»åŠ¡æ²¡æœ‰æˆåŠŸå®Œæˆï¼Œæ“ä½œå°†å¤±è´¥ã€‚ç„¶åï¼Œå¦‚æœæ‚¨æƒ³æ ¹æ®éƒ¨ç½²/è¿è¡Œæ˜¯å¦å¤±è´¥å’Œå…¶ä»–å¤±è´¥(æ¯”å¦‚å¤±å»ä¸Octopuså®ä¾‹çš„é€šä¿¡)åœ¨å·¥ä½œæµä¸­é‡‡å–ä¸åŒçš„è¡ŒåŠ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="https://docs.github.com/en/actions/learn-github-actions/contexts#steps-context" rel="nofollow">æ­¥éª¤çš„ç»“æœ</a>å’Œ<code>completed_successfully</code>ã€‚</p>

<h2 id="common-workflow-patterns">å¸¸è§å·¥ä½œæµæ¨¡å¼</h2>

<h3 id="all-in-one">å¤šåˆä¸€</h3>

<p>ä¸€ä½“å¼æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ä½¿ç”¨æœ€å¹¿æ³›çš„æ¨¡å¼ï¼Œç”±CLIé¼“åŠ±æ‚¨åšäº‹æƒ…çš„æ–¹å¼é©±åŠ¨ã€‚æ‰€æœ‰è¡ŒåŠ¨éƒ½æ˜¯ä¸€é¡¹å·¥ä½œä¸­çš„æ­¥éª¤:</p>

<pre><code class="language-yaml">- name: Create Zip package ğŸ™
  id: package
  uses: OctopusDeploy/create-zip-package-action@v3
  with:
    package_id: DemoNetCoreWebAppGHASingleJob
    version: ${{ steps.build.outputs.version }}
    base_path: ${{ steps.build.outputs.output_folder }}
    files: "**/*"
    output_folder: packaged

- uses: actions/upload-artifact@v3
  with:
  name: ${{ steps.package.outputs.package_filename }}
  path: ${{ steps.package.outputs.package_file_path }}

- name: Push a package to Octopus Deploy ğŸ™
  uses: OctopusDeploy/push-package-action@v3
  with:
    packages: ${{ steps.package.outputs.package_file_path }}

- name: Push build information to Octopus Deploy ğŸ™
  uses: OctopusDeploy/push-build-information-action@v3
  with:
    version: ${{ steps.build.outputs.version }}
    packages: MyPackage

- name: Create a release in Octopus Deploy ğŸ™
  uses: OctopusDeploy/create-release-action@v3
  id: "create_release"
  with:
    project: "Pet Shop"
    package_version: ${{ steps.build.outputs.version }}

- name: Deploy the release in Octopus Deploy ğŸ™
  uses: OctopusDeploy/deploy-release-action@v3
  id: "queue_deployments"
  with:
    project: "Pet Shop"
    release_number: ${{ steps.create_release.outputs.release_number }}
    environments: |
      Development
      Integration

- name: Waiting for 1st deployment in Octopus Deploy ğŸ™
  uses: OctopusDeploy/await-task-action@v3
  with:
    server_task_id: ${{ fromJson(steps.queue_deployments.outputs.server_tasks)[0].serverTaskId }}

- name: Waiting for 2nd deployment in Octopus Deploy ğŸ™
  uses: OctopusDeploy/await-task-action@v3
  with:
    server_task_id: ${{ fromJson(steps.queue_deployments.outputs.server_tasks)[1].serverTaskId }}
</code></pre>

<p>GitHubæ“ä½œä¸­è¿è¡Œçš„å·¥ä½œæµçš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤º:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-12/github-actions-for-octopus-deploy-v3/single-job-example.png" class="zoom" data-title=""><img src="../Images/f1c976d41d6f1ba4e3a31e6e9cb8b2d2.png" class="img-fluid center" alt="Single Job" data-original-src="https://i.octopus.com/blog/2022-12/github-actions-for-octopus-deploy-v3/single-job-example.png"/>T2ã€‘</a></p>

<p>ä½¿ç”¨è¿™ç§æ¨¡å¼æœ‰ä»¥ä¸‹å¥½å¤„:</p>

<ul>
<li>åœ¨å·¥ä½œæµæ–‡ä»¶ä¸­ï¼Œæ­¥éª¤ç›¸å¯¹å®¹æ˜“é“¾æ¥åœ¨ä¸€èµ·(ä¸æ‚¨åœ¨ä¸‹ä¸€ä¸ªç¤ºä¾‹ä¸­çœ‹åˆ°çš„ç›¸æ¯”)</li>
<li>é€‚åˆéƒ¨ç½²åˆ°å•ä¸ªç¯å¢ƒ/ç§Ÿæˆ·</li>
</ul>

<p>è¿™ç§æ¨¡å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹:</p>

<ul>
<li>åœ¨æœ‰å¤šä¸ªä¹‹åï¼Œä½ ä¸èƒ½ä¿è¯å®ƒä»¬æ’é˜Ÿçš„é¡ºåº</li>
<li>æ‚¨æ— æ³•ä¸€çœ¼çœ‹å‡ºå“ªä¸ªä»»åŠ¡é€‚ç”¨äºå“ªä¸ªç¯å¢ƒ</li>
<li>æ­¥éª¤æ˜¯è¿ç»­æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ç›´åˆ°ç¬¬ä¸€æ¬¡éƒ¨ç½²çš„ç­‰å¾…å®Œæˆåï¼Œç¬¬äºŒæ¬¡éƒ¨ç½²çš„ç­‰å¾…æ‰å¼€å§‹</li>
</ul>

<h3 id="separate-the-actions-into-multiple-jobs">å°†æ“ä½œåˆ†æˆå¤šä¸ªä½œä¸š</h3>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ªä½¿ç”¨å¤šä¸ªä½œä¸šæ¥åè°ƒæ“ä½œçš„å·¥ä½œæµã€‚å®ƒæ—¢ä½¿ç”¨äº†ä½œä¸šï¼Œä¹Ÿä½¿ç”¨äº†GitHubåŠ¨ä½œä¸­ä¸€ä¸ªåä¸º<a href="https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs" rel="nofollow">çŸ©é˜µ</a>çš„ç‰¹æ€§:</p>

<pre><code class="language-yaml">jobs:
  build:
    name: Build and unit test code
    runs-on: ubuntu-latest

    outputs:
      version: ${{ steps.build.outputs.version }}
      artifact_name: ${{ steps.package.outputs.package_filename }}

    steps:
      - uses: actions/checkout@v3

      - name: Setup .NET
        uses: actions/setup-dotnet@v2
        with:
          dotnet-version: 6.0.x

      - name: Run Build ğŸ—
        id: build
        run: |
          # do whatever you do to build your package. Assume this outputs a version variable and the folder where it produced output

      - name: Create Zip package ğŸ™
        id: package
        uses: OctopusDeploy/create-zip-package-action@v3
        with:
          package_id: MyPackage
          version: ${{ steps.build.outputs.version }}
          base_path: ${{ steps.build.outputs.output_folder }}
          files: "**/*"
          output_folder: packaged

      - uses: actions/upload-artifact@v3
        with:
          name: ${{ steps.package.outputs.package_filename }}
          path: ${{ steps.package.outputs.package_file_path }}

  push:
    name: Push information to Octopus
    needs: build
    runs-on: ubuntu-latest

    env:
      OCTOPUS_URL: ${{ secrets.OCTOPUS_URL }}
      OCTOPUS_API_KEY: ${{ secrets.OCTOPUS_API_KEY }}
      OCTOPUS_SPACE: "Galaxy"

    steps:
      - uses: actions/download-artifact@v3
        with:
          name: MyPackage.${{ needs.build.outputs.version }}
          path: package

      - name: Push a package to Octopus Deploy ğŸ™
        uses: OctopusDeploy/push-package-action@v3
        with:
          packages: package/MyPackage.${{ needs.build.outputs.version }}.zip

      - name: Push build information to Octopus Deploy ğŸ™
        uses: OctopusDeploy/push-build-information-action@v3
        with:
          version: ${{ needs.build.outputs.version }}
          packages: MyPackage

  snapshot:
    name: Snapshot information in Octopus
    needs: [build, push]
    runs-on: ubuntu-latest

    outputs:
      release_number: ${{ steps.create_release.outputs.release_number }}

    env:
      OCTOPUS_URL: ${{ secrets.OCTOPUS_URL }}
      OCTOPUS_API_KEY: ${{ secrets.OCTOPUS_API_KEY }}
      OCTOPUS_SPACE: "Galaxy"

    steps:
      - name: Create a release in Octopus Deploy ğŸ™
        id: "create_release"
        uses: OctopusDeploy/create-release-action@v3
        with:
          project: "Rockets"
          package_version: ${{ needs.build.outputs.version }}

  deploy:
    name: Deploy snapshot using Octopus
    needs: [build, snapshot]
    runs-on: ubuntu-latest

    env:
      OCTOPUS_URL: ${{ secrets.OCTOPUS_URL }}
      OCTOPUS_API_KEY: ${{ secrets.OCTOPUS_API_KEY }}
      OCTOPUS_SPACE: "Galaxy"

    outputs:
      server_tasks: ${{ steps.queue_deployments.outputs.server_tasks }}

    steps:
      - name: Deploy the release in Octopus Deploy ğŸ™
        uses: OctopusDeploy/deploy-release-tenanted-action@v3
        id: "queue_deployments"
        with:
          project: "Rockets"
          release_number: ${{ needs.snapshot.outputs.release_number }}
          environment: Development
          tenants: Mars
          tenant_tags: |
            planets/gas giants

  wait:
    needs: deploy
    runs-on: ubuntu-latest
    name: ${{ matrix.deployment.tenantName }}

    env:
      OCTOPUS_URL: ${{ secrets.OCTOPUS_URL }}
      OCTOPUS_API_KEY: ${{ secrets.OCTOPUS_API_KEY }}
      OCTOPUS_SPACE: "Galaxy"

    strategy:
      matrix:
        deployment: ${{ fromJson(needs.deploy.outputs.server_tasks) }}

    steps:
      - name: Waiting for deployment in Octopus Deploy ğŸ™
        uses: OctopusDeploy/await-task-action@v3
        with:
          server_task_id: ${{ matrix.deployment.serverTaskId }}
</code></pre>

<p>GitHubæ“ä½œä¸­è¿è¡Œçš„å·¥ä½œæµçš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤º:</p>

<p><a href="#" data-featherlight="https://i.octopus.com/blog/2022-12/github-actions-for-octopus-deploy-v3/multiple-jobs-example.png" class="zoom" data-title=""><img src="../Images/ddbf53b102169eb823ad8a1c139d7331.png" class="img-fluid center" alt="Multiple Jobs" data-original-src="https://i.octopus.com/blog/2022-12/github-actions-for-octopus-deploy-v3/multiple-jobs-example.png"/>T2ã€‘</a></p>

<p>ä½¿ç”¨è¿™ç§æ¨¡å¼æœ‰ä»¥ä¸‹å¥½å¤„:</p>

<ul>
<li>å½“æœ‰å¤šä¸ªéƒ¨ç½²æ—¶ï¼Œå¾ˆå®¹æ˜“ç¡®å®šå“ªä¸ªæ˜¯å“ªä¸ª</li>
<li>ç­‰å¾…ä»»åŠ¡å¹¶è¡Œå‘ç”Ÿ(è¿™æ˜¯GitHubåŠ¨ä½œä¸­çŸ©é˜µç‰¹æ€§å‘æŒ¥ä½œç”¨çš„æ—¶å€™)</li>
<li>ä»»åŠ¡å‡ºç°åœ¨å›¾è¡¨çš„å¯æ‰©å±•éƒ¨åˆ†ï¼Œä½†ä¹Ÿä½œä¸ºå•ç‹¬çš„æ¡ç›®å‡ºç°åœ¨å·¦ä¾§çš„æ‘˜è¦ä¸­(åŒæ ·ä½¿ç”¨çŸ©é˜µ)</li>
<li>å·¥ä½œæµä¸­çš„å•ä¸ªä½œä¸šå¦‚æœå¤±è´¥ï¼Œå¯ä»¥é‡æ–°è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ„å»ºäº†åŒ…å¹¶æ¨é€åˆ°Octopusï¼Œä½†æ˜¯ç”±äºOctopusä¸­çš„é…ç½®é”™è¯¯ï¼Œå‘å¸ƒåˆ›å»ºå¤±è´¥äº†ã€‚å¦‚æœæ‚¨æ›´æ­£äº†é…ç½®ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä»åŒä¸€ç‚¹é‡æ–°è¿è¡Œå·¥ä½œæµï¼Œè€Œä¸å¿…é‡æ–°æ„å»ºåŒ…å¹¶å†æ¬¡æ¨é€å®ƒä»¬(è¿™ä¸¤ç§æ“ä½œéƒ½å¯èƒ½æ˜¯å¼€é”€å¾ˆå¤§çš„æ“ä½œ)</li>
</ul>

<p>è¿™ç§æ¨¡å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹:</p>

<ul>
<li>å·¥ä½œæµçš„è®¾ç½®æ›´åŠ å¤æ‚â€”â€”å°†æ­¥éª¤çš„è¾“å‡ºä¼ é€’åˆ°ä½œä¸šè¾¹ç•Œéœ€è¦åœ¨YAMLä¸­åšæ›´å¤šçš„å·¥ä½œ</li>
<li>å¦‚æœåªæœ‰ä¸€æ¬¡éƒ¨ç½²ï¼ŒçŸ©é˜µå¯èƒ½ä¼šæ„Ÿè§‰è´Ÿæ‹…è¿‡é‡</li>
</ul>

<h3 id="runbook-runs">Runbookè¿è¡Œ</h3>

<p>æ‰§è¡Œæ“ä½œæ‰‹å†Œç±»ä¼¼äºéƒ¨ç½²ç‰ˆæœ¬ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œæä¾›ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³æŒ‡å‡ºactionæä¾›çš„è¾“å‡ºæ•°æ®çš„ä¸€ä¸ªç‰¹å®šæ–¹é¢ï¼Œä»¥åŠå®ƒå¯¹çŸ©é˜µé…ç½®çš„æ„ä¹‰ã€‚</p>

<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯¥æ¡ç›®å°†çŸ©é˜µä½œä¸šçš„åç§°ç»‘å®šåˆ°æ¥è‡ªJSONè¾“å‡ºæ•°æ®çš„ç§Ÿæˆ·åç§°:</p>

<pre><code class="language-yaml">name: ${{ matrix.deployment.tenantName }}
</code></pre>

<p>ä½¿ç”¨runbookè¿è¡Œæ—¶ï¼Œè¾“å‡ºæ•°æ®åŒ…å«<code>tenantName</code>å’Œ<code>environmentName</code>ï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨ä¸€æ¬¡è¯·æ±‚å¤šä¸ªè¿™ä¸¤ä¸ªå€¼ï¼Œå¹¶ä¸ºä»»ä½•ä¸ç»™å®šç¯å¢ƒçš„ç»™å®šé¡¹ç›®æœ‰å…³è”çš„åŒ¹é…ç§Ÿæˆ·æ‰§è¡Œã€‚è¿™æ„å‘³ç€æ‚¨çš„çŸ©é˜µåç§°å¯ä»¥è¿™æ ·åšï¼Œè¿™å–å†³äºå“ªä¸ªå€¼å¯¹æ‚¨æ›´é‡è¦:</p>

<pre><code class="language-yaml">name: ${{ matrix.deployment.tenantName }} - ${{ matrix.deployment.environmentName }}
</code></pre>

<p>æˆ–è€…</p>

<pre><code class="language-yaml">name: ${{ matrix.deployment.environmentName }} - ${{ matrix.deployment.tenantName }}
</code></pre>

<p>è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºåœ¨æ‘˜è¦è§†å›¾ä¸­ï¼ŒGitHub Actions UIä¼šæˆªæ–­é•¿å€¼ã€‚å°†æœ€é‡è¦çš„ä¿¡æ¯æ”¾åœ¨æœ€å‰é¢ä¼šè®©ä½ ä¸€çœ¼å°±èƒ½æ‰¾åˆ°(é’»å–åä½ æ€»èƒ½çœ‹åˆ°å®Œæ•´çš„ç»†èŠ‚ï¼Œåªéœ€è¦é¢å¤–çš„ç‚¹å‡»)ã€‚</p>

<h2 id="conclusion">ç»“è®º</h2>

<p>GitHub Actions for Octopus Deploy v3å¯¹v2è¿›è¡Œäº†é‡å¤§æ”¹è¿›ï¼Œé˜µå®¹ä¸­å¢åŠ äº†<a href="https://github.com/marketplace?query=octopus&amp;type=actions&amp;verification=verified_creator" rel="nofollow"> 5ä¸ªæ–°åŠ¨ä½œ</a>ã€‚è¿™äº›æ–°æ“ä½œå¢å¼ºäº†è‡ªåŠ¨åŒ–éƒ¨ç½²è¿‡ç¨‹ã€æ‰§è¡Œä»»åŠ¡å’Œåˆ›å»ºåŒ…çš„èƒ½åŠ›ã€‚å®ƒä»¬è¿˜æå¤§åœ°æ”¹å–„äº†æ•´ä½“ç”¨æˆ·ä½“éªŒã€‚</p>

<p>æˆ‘ä»¬è‡ªå·±ä¹Ÿåœ¨ä½¿ç”¨è¿™äº›è¡ŒåŠ¨ï¼Œè¿™è¯æ˜äº†å®ƒä»¬çš„æœ‰æ•ˆæ€§å’Œå¯é æ€§ã€‚æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªæœ€æ–°ç‰ˆæœ¬é€šè¿‡æä¾›å¼ºå¤§çš„ã€ç”¨æˆ·å‹å¥½çš„æ“ä½œæ¥ç®¡ç†æ‚¨çš„GitHubéƒ¨ç½²ï¼Œä»è€Œå¸®åŠ©æ‚¨ã€‚</p>

<p>æ„‰å¿«çš„éƒ¨ç½²ï¼</p>

                    
                    
</body>
</html>